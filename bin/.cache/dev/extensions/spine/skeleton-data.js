
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/extensions/spine/skeleton-data.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/

/**
 * @module sp
 */
var SkeletonCache = !CC_JSB && require('./skeleton-cache').sharedCache;
/**
 * !#en The skeleton data of spine.
 * !#zh Spine 的 骨骼数据。
 * @class SkeletonData
 * @extends Asset
 */


var SkeletonData = cc.Class({
  name: 'sp.SkeletonData',
  "extends": cc.Asset,
  ctor: function ctor() {
    this.reset();
  },
  properties: {
    _skeletonJson: null,
    // use by jsb
    skeletonJsonStr: {
      get: function get() {
        if (this._skeletonJson) {
          return JSON.stringify(this._skeletonJson);
        } else {
          return "";
        }
      }
    },

    /**
     * !#en See http://en.esotericsoftware.com/spine-json-format
     * !#zh 可查看 Spine 官方文档 http://zh.esotericsoftware.com/spine-json-format
     * @property {Object} skeletonJson
     */
    skeletonJson: {
      get: function get() {
        return this._skeletonJson;
      },
      set: function set(value) {
        this.reset();

        if (typeof value == "string") {
          this._skeletonJson = JSON.parse(value);
        } else {
          this._skeletonJson = value;
        } // If create by manual, uuid is empty.


        if (!this._uuid && value.skeleton) {
          this._uuid = value.skeleton.hash;
        }
      }
    },
    _atlasText: "",

    /**
     * @property {String} atlasText
     */
    atlasText: {
      get: function get() {
        return this._atlasText;
      },
      set: function set(value) {
        this._atlasText = value;
        this.reset();
      }
    },

    /**
     * @property {Texture2D[]} textures
     */
    textures: {
      "default": [],
      type: [cc.Texture2D]
    },

    /**
     * @property {String[]} textureNames
     * @private
     */
    textureNames: {
      "default": [],
      type: [cc.String]
    },

    /**
     * !#en
     * A scale can be specified on the JSON or binary loader which will scale the bone positions,
     * image sizes, and animation translations.
     * This can be useful when using different sized images than were used when designing the skeleton
     * in Spine. For example, if using images that are half the size than were used in Spine,
     * a scale of 0.5 can be used. This is commonly used for games that can run with either low or high
     * resolution texture atlases.
     * see http://en.esotericsoftware.com/spine-using-runtimes#Scaling
     * !#zh 可查看 Spine 官方文档： http://zh.esotericsoftware.com/spine-using-runtimes#Scaling
     * @property {Number} scale
     */
    scale: 1,
    _nativeAsset: {
      get: function get() {
        return this._buffer;
      },
      set: function set(bin) {
        this._buffer = bin.buffer || bin;
        this.reset();
      },
      override: true
    }
  },
  statics: {
    preventDeferredLoadDependents: true
  },
  // PUBLIC
  createNode: CC_EDITOR && function (callback) {
    var node = new cc.Node(this.name);
    var skeleton = node.addComponent(sp.Skeleton);
    skeleton.skeletonData = this;
    return callback(null, node);
  },
  reset: function reset() {
    /**
     * @property {sp.spine.SkeletonData} _skeletonData
     * @private
     */
    this._skeletonCache = null;
    /**
     * @property {sp.spine.Atlas} _atlasCache
     * @private
     */

    this._atlasCache = null;

    if (CC_EDITOR) {
      this._skinsEnum = null;
      this._animsEnum = null;
    }
  },
  ensureTexturesLoaded: function ensureTexturesLoaded(loaded, caller) {
    var textures = this.textures;
    var texsLen = textures.length;

    if (texsLen == 0) {
      loaded.call(caller, false);
      return;
    }

    var loadedCount = 0;

    var loadedItem = function loadedItem() {
      loadedCount++;

      if (loadedCount >= texsLen) {
        loaded && loaded.call(caller, true);
        loaded = null;
      }
    };

    for (var i = 0; i < texsLen; i++) {
      var tex = textures[i];

      if (tex.loaded) {
        loadedItem();
      } else {
        tex.once('load', loadedItem);
      }
    }
  },
  isTexturesLoaded: function isTexturesLoaded() {
    var textures = this.textures;
    var texsLen = textures.length;

    for (var i = 0; i < texsLen; i++) {
      var tex = textures[i];

      if (!tex.loaded) {
        return false;
      }
    }

    return true;
  },

  /**
   * !#en Get the included SkeletonData used in spine runtime.<br>
   * Returns a {{#crossLinkModule "sp.spine"}}sp.spine{{/crossLinkModule}}.SkeletonData object.
   * !#zh 获取 Spine Runtime 使用的 SkeletonData。<br>
   * 返回一个 {{#crossLinkModule "sp.spine"}}sp.spine{{/crossLinkModule}}.SkeletonData 对象。
   * @method getRuntimeData
   * @param {Boolean} [quiet=false]
   * @return {sp.spine.SkeletonData}
   */
  getRuntimeData: function getRuntimeData(quiet) {
    if (this._skeletonCache) {
      return this._skeletonCache;
    }

    if (!(this.textures && this.textures.length > 0) && this.textureNames && this.textureNames.length > 0) {
      if (!quiet) {
        cc.errorID(7507, this.name);
      }

      return null;
    }

    var atlas = this._getAtlas(quiet);

    if (!atlas) {
      return null;
    }

    var attachmentLoader = new sp.spine.AtlasAttachmentLoader(atlas);
    var resData = null;
    var reader = null;

    if (this.skeletonJson) {
      reader = new sp.spine.SkeletonJson(attachmentLoader);
      resData = this.skeletonJson;
    } else {
      reader = new sp.spine.SkeletonBinary(attachmentLoader);
      resData = new Uint8Array(this._nativeAsset);
    }

    reader.scale = this.scale;
    this._skeletonCache = reader.readSkeletonData(resData);
    atlas.dispose();
    return this._skeletonCache;
  },
  // EDITOR
  getSkinsEnum: CC_EDITOR && function () {
    if (this._skinsEnum) {
      return this._skinsEnum;
    }

    var sd = this.getRuntimeData(true);

    if (sd) {
      var skins = sd.skins;
      var enumDef = {};

      for (var i = 0; i < skins.length; i++) {
        var name = skins[i].name;
        enumDef[name] = i;
      }

      return this._skinsEnum = cc.Enum(enumDef);
    }

    return null;
  },
  getAnimsEnum: CC_EDITOR && function () {
    if (this._animsEnum) {
      return this._animsEnum;
    }

    var sd = this.getRuntimeData(true);

    if (sd) {
      var enumDef = {
        '<None>': 0
      };
      var anims = sd.animations;

      for (var i = 0; i < anims.length; i++) {
        var name = anims[i].name;
        enumDef[name] = i + 1;
      }

      return this._animsEnum = cc.Enum(enumDef);
    }

    return null;
  },
  // PRIVATE
  _getTexture: function _getTexture(line) {
    var names = this.textureNames;

    for (var i = 0; i < names.length; i++) {
      if (names[i] === line) {
        var texture = this.textures[i];
        var tex = new sp.SkeletonTexture({
          width: texture.width,
          height: texture.height
        });
        tex.setRealTexture(texture);
        return tex;
      }
    }

    cc.errorID(7506, line);
    return null;
  },

  /**
   * @method _getAtlas
   * @param {boolean} [quiet=false]
   * @return {sp.spine.Atlas}
   * @private
   */
  _getAtlas: function _getAtlas(quiet) {
    if (this._atlasCache) {
      return this._atlasCache;
    }

    if (!this.atlasText) {
      if (!quiet) {
        cc.errorID(7508, this.name);
      }

      return null;
    }

    return this._atlasCache = new sp.spine.TextureAtlas(this.atlasText, this._getTexture.bind(this));
  },
  destroy: function destroy() {
    SkeletonCache.removeSkeleton(this._uuid);

    this._super();
  }
});
sp.SkeletonData = module.exports = SkeletonData;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvZXh0ZW5zaW9ucy9zcGluZS9za2VsZXRvbi1kYXRhLmpzIl0sIm5hbWVzIjpbIlNrZWxldG9uQ2FjaGUiLCJDQ19KU0IiLCJyZXF1aXJlIiwic2hhcmVkQ2FjaGUiLCJTa2VsZXRvbkRhdGEiLCJjYyIsIkNsYXNzIiwibmFtZSIsIkFzc2V0IiwiY3RvciIsInJlc2V0IiwicHJvcGVydGllcyIsIl9za2VsZXRvbkpzb24iLCJza2VsZXRvbkpzb25TdHIiLCJnZXQiLCJKU09OIiwic3RyaW5naWZ5Iiwic2tlbGV0b25Kc29uIiwic2V0IiwidmFsdWUiLCJwYXJzZSIsIl91dWlkIiwic2tlbGV0b24iLCJoYXNoIiwiX2F0bGFzVGV4dCIsImF0bGFzVGV4dCIsInRleHR1cmVzIiwidHlwZSIsIlRleHR1cmUyRCIsInRleHR1cmVOYW1lcyIsIlN0cmluZyIsInNjYWxlIiwiX25hdGl2ZUFzc2V0IiwiX2J1ZmZlciIsImJpbiIsImJ1ZmZlciIsIm92ZXJyaWRlIiwic3RhdGljcyIsInByZXZlbnREZWZlcnJlZExvYWREZXBlbmRlbnRzIiwiY3JlYXRlTm9kZSIsIkNDX0VESVRPUiIsImNhbGxiYWNrIiwibm9kZSIsIk5vZGUiLCJhZGRDb21wb25lbnQiLCJzcCIsIlNrZWxldG9uIiwic2tlbGV0b25EYXRhIiwiX3NrZWxldG9uQ2FjaGUiLCJfYXRsYXNDYWNoZSIsIl9za2luc0VudW0iLCJfYW5pbXNFbnVtIiwiZW5zdXJlVGV4dHVyZXNMb2FkZWQiLCJsb2FkZWQiLCJjYWxsZXIiLCJ0ZXhzTGVuIiwibGVuZ3RoIiwiY2FsbCIsImxvYWRlZENvdW50IiwibG9hZGVkSXRlbSIsImkiLCJ0ZXgiLCJvbmNlIiwiaXNUZXh0dXJlc0xvYWRlZCIsImdldFJ1bnRpbWVEYXRhIiwicXVpZXQiLCJlcnJvcklEIiwiYXRsYXMiLCJfZ2V0QXRsYXMiLCJhdHRhY2htZW50TG9hZGVyIiwic3BpbmUiLCJBdGxhc0F0dGFjaG1lbnRMb2FkZXIiLCJyZXNEYXRhIiwicmVhZGVyIiwiU2tlbGV0b25Kc29uIiwiU2tlbGV0b25CaW5hcnkiLCJVaW50OEFycmF5IiwicmVhZFNrZWxldG9uRGF0YSIsImRpc3Bvc2UiLCJnZXRTa2luc0VudW0iLCJzZCIsInNraW5zIiwiZW51bURlZiIsIkVudW0iLCJnZXRBbmltc0VudW0iLCJhbmltcyIsImFuaW1hdGlvbnMiLCJfZ2V0VGV4dHVyZSIsImxpbmUiLCJuYW1lcyIsInRleHR1cmUiLCJTa2VsZXRvblRleHR1cmUiLCJ3aWR0aCIsImhlaWdodCIsInNldFJlYWxUZXh0dXJlIiwiVGV4dHVyZUF0bGFzIiwiYmluZCIsImRlc3Ryb3kiLCJyZW1vdmVTa2VsZXRvbiIsIl9zdXBlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSUEsYUFBYSxHQUFHLENBQUNDLE1BQUQsSUFBV0MsT0FBTyxDQUFDLGtCQUFELENBQVAsQ0FBNEJDLFdBQTNEO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQSxJQUFJQyxZQUFZLEdBQUdDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ3hCQyxFQUFBQSxJQUFJLEVBQUUsaUJBRGtCO0FBRXhCLGFBQVNGLEVBQUUsQ0FBQ0csS0FGWTtBQUl4QkMsRUFBQUEsSUFBSSxFQUFFLGdCQUFZO0FBQ2QsU0FBS0MsS0FBTDtBQUNILEdBTnVCO0FBUXhCQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsYUFBYSxFQUFFLElBRFA7QUFHUjtBQUNBQyxJQUFBQSxlQUFlLEVBQUU7QUFDYkMsTUFBQUEsR0FBRyxFQUFFLGVBQVk7QUFDYixZQUFJLEtBQUtGLGFBQVQsRUFBd0I7QUFDcEIsaUJBQU9HLElBQUksQ0FBQ0MsU0FBTCxDQUFlLEtBQUtKLGFBQXBCLENBQVA7QUFDSCxTQUZELE1BRU87QUFDSCxpQkFBTyxFQUFQO0FBQ0g7QUFDSjtBQVBZLEtBSlQ7O0FBY1I7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNRSyxJQUFBQSxZQUFZLEVBQUU7QUFDVkgsTUFBQUEsR0FBRyxFQUFFLGVBQVk7QUFDYixlQUFPLEtBQUtGLGFBQVo7QUFDSCxPQUhTO0FBSVZNLE1BQUFBLEdBQUcsRUFBRSxhQUFVQyxLQUFWLEVBQWlCO0FBQ2xCLGFBQUtULEtBQUw7O0FBQ0EsWUFBSSxPQUFPUyxLQUFQLElBQWlCLFFBQXJCLEVBQStCO0FBQzNCLGVBQUtQLGFBQUwsR0FBcUJHLElBQUksQ0FBQ0ssS0FBTCxDQUFXRCxLQUFYLENBQXJCO0FBQ0gsU0FGRCxNQUVPO0FBQ0gsZUFBS1AsYUFBTCxHQUFxQk8sS0FBckI7QUFDSCxTQU5pQixDQU9sQjs7O0FBQ0EsWUFBSSxDQUFDLEtBQUtFLEtBQU4sSUFBZUYsS0FBSyxDQUFDRyxRQUF6QixFQUFtQztBQUMvQixlQUFLRCxLQUFMLEdBQWFGLEtBQUssQ0FBQ0csUUFBTixDQUFlQyxJQUE1QjtBQUNIO0FBQ0o7QUFmUyxLQW5CTjtBQXFDUkMsSUFBQUEsVUFBVSxFQUFFLEVBckNKOztBQXVDUjtBQUNSO0FBQ0E7QUFDUUMsSUFBQUEsU0FBUyxFQUFFO0FBQ1BYLE1BQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsZUFBTyxLQUFLVSxVQUFaO0FBQ0gsT0FITTtBQUlQTixNQUFBQSxHQUFHLEVBQUUsYUFBVUMsS0FBVixFQUFpQjtBQUNsQixhQUFLSyxVQUFMLEdBQWtCTCxLQUFsQjtBQUNBLGFBQUtULEtBQUw7QUFDSDtBQVBNLEtBMUNIOztBQW9EUjtBQUNSO0FBQ0E7QUFDUWdCLElBQUFBLFFBQVEsRUFBRTtBQUNOLGlCQUFTLEVBREg7QUFFTkMsTUFBQUEsSUFBSSxFQUFFLENBQUN0QixFQUFFLENBQUN1QixTQUFKO0FBRkEsS0F2REY7O0FBNERSO0FBQ1I7QUFDQTtBQUNBO0FBQ1FDLElBQUFBLFlBQVksRUFBRTtBQUNWLGlCQUFTLEVBREM7QUFFVkYsTUFBQUEsSUFBSSxFQUFFLENBQUN0QixFQUFFLENBQUN5QixNQUFKO0FBRkksS0FoRU47O0FBcUVSO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNRQyxJQUFBQSxLQUFLLEVBQUUsQ0FqRkM7QUFtRlJDLElBQUFBLFlBQVksRUFBRTtBQUNWbEIsTUFBQUEsR0FEVSxpQkFDSDtBQUNILGVBQU8sS0FBS21CLE9BQVo7QUFDSCxPQUhTO0FBSVZmLE1BQUFBLEdBSlUsZUFJTGdCLEdBSkssRUFJQTtBQUNOLGFBQUtELE9BQUwsR0FBZUMsR0FBRyxDQUFDQyxNQUFKLElBQWNELEdBQTdCO0FBQ0EsYUFBS3hCLEtBQUw7QUFDSCxPQVBTO0FBUVYwQixNQUFBQSxRQUFRLEVBQUU7QUFSQTtBQW5GTixHQVJZO0FBdUd4QkMsRUFBQUEsT0FBTyxFQUFFO0FBQ0xDLElBQUFBLDZCQUE2QixFQUFFO0FBRDFCLEdBdkdlO0FBMkd4QjtBQUVBQyxFQUFBQSxVQUFVLEVBQUVDLFNBQVMsSUFBSSxVQUFVQyxRQUFWLEVBQW9CO0FBQ3pDLFFBQUlDLElBQUksR0FBRyxJQUFJckMsRUFBRSxDQUFDc0MsSUFBUCxDQUFZLEtBQUtwQyxJQUFqQixDQUFYO0FBQ0EsUUFBSWUsUUFBUSxHQUFHb0IsSUFBSSxDQUFDRSxZQUFMLENBQWtCQyxFQUFFLENBQUNDLFFBQXJCLENBQWY7QUFDQXhCLElBQUFBLFFBQVEsQ0FBQ3lCLFlBQVQsR0FBd0IsSUFBeEI7QUFFQSxXQUFPTixRQUFRLENBQUMsSUFBRCxFQUFPQyxJQUFQLENBQWY7QUFDSCxHQW5IdUI7QUFxSHhCaEMsRUFBQUEsS0FBSyxFQUFFLGlCQUFZO0FBQ2Y7QUFDUjtBQUNBO0FBQ0E7QUFDUSxTQUFLc0MsY0FBTCxHQUFzQixJQUF0QjtBQUNBO0FBQ1I7QUFDQTtBQUNBOztBQUNRLFNBQUtDLFdBQUwsR0FBbUIsSUFBbkI7O0FBQ0EsUUFBSVQsU0FBSixFQUFlO0FBQ1gsV0FBS1UsVUFBTCxHQUFrQixJQUFsQjtBQUNBLFdBQUtDLFVBQUwsR0FBa0IsSUFBbEI7QUFDSDtBQUNKLEdBcEl1QjtBQXNJeEJDLEVBQUFBLG9CQXRJd0IsZ0NBc0lGQyxNQXRJRSxFQXNJTUMsTUF0SU4sRUFzSWM7QUFDbEMsUUFBSTVCLFFBQVEsR0FBRyxLQUFLQSxRQUFwQjtBQUNBLFFBQUk2QixPQUFPLEdBQUc3QixRQUFRLENBQUM4QixNQUF2Qjs7QUFDQSxRQUFJRCxPQUFPLElBQUksQ0FBZixFQUFrQjtBQUNkRixNQUFBQSxNQUFNLENBQUNJLElBQVAsQ0FBWUgsTUFBWixFQUFvQixLQUFwQjtBQUNBO0FBQ0g7O0FBQ0QsUUFBSUksV0FBVyxHQUFHLENBQWxCOztBQUNBLFFBQUlDLFVBQVUsR0FBRyxTQUFiQSxVQUFhLEdBQVk7QUFDekJELE1BQUFBLFdBQVc7O0FBQ1gsVUFBSUEsV0FBVyxJQUFJSCxPQUFuQixFQUE0QjtBQUN4QkYsUUFBQUEsTUFBTSxJQUFJQSxNQUFNLENBQUNJLElBQVAsQ0FBWUgsTUFBWixFQUFvQixJQUFwQixDQUFWO0FBQ0FELFFBQUFBLE1BQU0sR0FBRyxJQUFUO0FBQ0g7QUFDSixLQU5EOztBQU9BLFNBQUssSUFBSU8sQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0wsT0FBcEIsRUFBNkJLLENBQUMsRUFBOUIsRUFBa0M7QUFDOUIsVUFBSUMsR0FBRyxHQUFHbkMsUUFBUSxDQUFDa0MsQ0FBRCxDQUFsQjs7QUFDQSxVQUFJQyxHQUFHLENBQUNSLE1BQVIsRUFBZ0I7QUFDWk0sUUFBQUEsVUFBVTtBQUNiLE9BRkQsTUFFTztBQUNIRSxRQUFBQSxHQUFHLENBQUNDLElBQUosQ0FBUyxNQUFULEVBQWlCSCxVQUFqQjtBQUNIO0FBQ0o7QUFDSixHQTdKdUI7QUErSnhCSSxFQUFBQSxnQkEvSndCLDhCQStKSjtBQUNoQixRQUFJckMsUUFBUSxHQUFHLEtBQUtBLFFBQXBCO0FBQ0EsUUFBSTZCLE9BQU8sR0FBRzdCLFFBQVEsQ0FBQzhCLE1BQXZCOztBQUNBLFNBQUssSUFBSUksQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR0wsT0FBcEIsRUFBNkJLLENBQUMsRUFBOUIsRUFBa0M7QUFDOUIsVUFBSUMsR0FBRyxHQUFHbkMsUUFBUSxDQUFDa0MsQ0FBRCxDQUFsQjs7QUFDQSxVQUFJLENBQUNDLEdBQUcsQ0FBQ1IsTUFBVCxFQUFpQjtBQUNiLGVBQU8sS0FBUDtBQUNIO0FBQ0o7O0FBQ0QsV0FBTyxJQUFQO0FBQ0gsR0F6S3VCOztBQTJLeEI7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0lXLEVBQUFBLGNBQWMsRUFBRSx3QkFBVUMsS0FBVixFQUFpQjtBQUM3QixRQUFJLEtBQUtqQixjQUFULEVBQXlCO0FBQ3JCLGFBQU8sS0FBS0EsY0FBWjtBQUNIOztBQUVELFFBQUssRUFBRSxLQUFLdEIsUUFBTCxJQUFpQixLQUFLQSxRQUFMLENBQWM4QixNQUFkLEdBQXVCLENBQTFDLEtBQWdELEtBQUszQixZQUFyRCxJQUFxRSxLQUFLQSxZQUFMLENBQWtCMkIsTUFBbEIsR0FBMkIsQ0FBckcsRUFBeUc7QUFDckcsVUFBSyxDQUFDUyxLQUFOLEVBQWM7QUFDVjVELFFBQUFBLEVBQUUsQ0FBQzZELE9BQUgsQ0FBVyxJQUFYLEVBQWlCLEtBQUszRCxJQUF0QjtBQUNIOztBQUNELGFBQU8sSUFBUDtBQUNIOztBQUVELFFBQUk0RCxLQUFLLEdBQUcsS0FBS0MsU0FBTCxDQUFlSCxLQUFmLENBQVo7O0FBQ0EsUUFBSSxDQUFFRSxLQUFOLEVBQWE7QUFDVCxhQUFPLElBQVA7QUFDSDs7QUFDRCxRQUFJRSxnQkFBZ0IsR0FBRyxJQUFJeEIsRUFBRSxDQUFDeUIsS0FBSCxDQUFTQyxxQkFBYixDQUFtQ0osS0FBbkMsQ0FBdkI7QUFFQSxRQUFJSyxPQUFPLEdBQUcsSUFBZDtBQUNBLFFBQUlDLE1BQU0sR0FBRyxJQUFiOztBQUNBLFFBQUksS0FBS3hELFlBQVQsRUFBdUI7QUFDbkJ3RCxNQUFBQSxNQUFNLEdBQUcsSUFBSTVCLEVBQUUsQ0FBQ3lCLEtBQUgsQ0FBU0ksWUFBYixDQUEwQkwsZ0JBQTFCLENBQVQ7QUFDQUcsTUFBQUEsT0FBTyxHQUFHLEtBQUt2RCxZQUFmO0FBQ0gsS0FIRCxNQUdPO0FBQ0h3RCxNQUFBQSxNQUFNLEdBQUcsSUFBSTVCLEVBQUUsQ0FBQ3lCLEtBQUgsQ0FBU0ssY0FBYixDQUE0Qk4sZ0JBQTVCLENBQVQ7QUFDQUcsTUFBQUEsT0FBTyxHQUFHLElBQUlJLFVBQUosQ0FBZSxLQUFLNUMsWUFBcEIsQ0FBVjtBQUNIOztBQUVEeUMsSUFBQUEsTUFBTSxDQUFDMUMsS0FBUCxHQUFlLEtBQUtBLEtBQXBCO0FBQ0EsU0FBS2lCLGNBQUwsR0FBc0J5QixNQUFNLENBQUNJLGdCQUFQLENBQXdCTCxPQUF4QixDQUF0QjtBQUNBTCxJQUFBQSxLQUFLLENBQUNXLE9BQU47QUFFQSxXQUFPLEtBQUs5QixjQUFaO0FBQ0gsR0FyTnVCO0FBdU54QjtBQUVBK0IsRUFBQUEsWUFBWSxFQUFFdkMsU0FBUyxJQUFJLFlBQVk7QUFDbkMsUUFBSSxLQUFLVSxVQUFULEVBQXFCO0FBQ2pCLGFBQU8sS0FBS0EsVUFBWjtBQUNIOztBQUNELFFBQUk4QixFQUFFLEdBQUcsS0FBS2hCLGNBQUwsQ0FBb0IsSUFBcEIsQ0FBVDs7QUFDQSxRQUFJZ0IsRUFBSixFQUFRO0FBQ0osVUFBSUMsS0FBSyxHQUFHRCxFQUFFLENBQUNDLEtBQWY7QUFDQSxVQUFJQyxPQUFPLEdBQUcsRUFBZDs7QUFDQSxXQUFLLElBQUl0QixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHcUIsS0FBSyxDQUFDekIsTUFBMUIsRUFBa0NJLENBQUMsRUFBbkMsRUFBdUM7QUFDbkMsWUFBSXJELElBQUksR0FBRzBFLEtBQUssQ0FBQ3JCLENBQUQsQ0FBTCxDQUFTckQsSUFBcEI7QUFDQTJFLFFBQUFBLE9BQU8sQ0FBQzNFLElBQUQsQ0FBUCxHQUFnQnFELENBQWhCO0FBQ0g7O0FBQ0QsYUFBTyxLQUFLVixVQUFMLEdBQWtCN0MsRUFBRSxDQUFDOEUsSUFBSCxDQUFRRCxPQUFSLENBQXpCO0FBQ0g7O0FBQ0QsV0FBTyxJQUFQO0FBQ0gsR0F4T3VCO0FBME94QkUsRUFBQUEsWUFBWSxFQUFFNUMsU0FBUyxJQUFJLFlBQVk7QUFDbkMsUUFBSSxLQUFLVyxVQUFULEVBQXFCO0FBQ2pCLGFBQU8sS0FBS0EsVUFBWjtBQUNIOztBQUNELFFBQUk2QixFQUFFLEdBQUcsS0FBS2hCLGNBQUwsQ0FBb0IsSUFBcEIsQ0FBVDs7QUFDQSxRQUFJZ0IsRUFBSixFQUFRO0FBQ0osVUFBSUUsT0FBTyxHQUFHO0FBQUUsa0JBQVU7QUFBWixPQUFkO0FBQ0EsVUFBSUcsS0FBSyxHQUFHTCxFQUFFLENBQUNNLFVBQWY7O0FBQ0EsV0FBSyxJQUFJMUIsQ0FBQyxHQUFHLENBQWIsRUFBZ0JBLENBQUMsR0FBR3lCLEtBQUssQ0FBQzdCLE1BQTFCLEVBQWtDSSxDQUFDLEVBQW5DLEVBQXVDO0FBQ25DLFlBQUlyRCxJQUFJLEdBQUc4RSxLQUFLLENBQUN6QixDQUFELENBQUwsQ0FBU3JELElBQXBCO0FBQ0EyRSxRQUFBQSxPQUFPLENBQUMzRSxJQUFELENBQVAsR0FBZ0JxRCxDQUFDLEdBQUcsQ0FBcEI7QUFDSDs7QUFDRCxhQUFPLEtBQUtULFVBQUwsR0FBa0I5QyxFQUFFLENBQUM4RSxJQUFILENBQVFELE9BQVIsQ0FBekI7QUFDSDs7QUFDRCxXQUFPLElBQVA7QUFDSCxHQXpQdUI7QUEyUHhCO0FBRUFLLEVBQUFBLFdBQVcsRUFBRSxxQkFBVUMsSUFBVixFQUFnQjtBQUN6QixRQUFJQyxLQUFLLEdBQUcsS0FBSzVELFlBQWpCOztBQUNBLFNBQUssSUFBSStCLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUc2QixLQUFLLENBQUNqQyxNQUExQixFQUFrQ0ksQ0FBQyxFQUFuQyxFQUF1QztBQUNuQyxVQUFJNkIsS0FBSyxDQUFDN0IsQ0FBRCxDQUFMLEtBQWE0QixJQUFqQixFQUF1QjtBQUNuQixZQUFJRSxPQUFPLEdBQUcsS0FBS2hFLFFBQUwsQ0FBY2tDLENBQWQsQ0FBZDtBQUNBLFlBQUlDLEdBQUcsR0FBRyxJQUFJaEIsRUFBRSxDQUFDOEMsZUFBUCxDQUF1QjtBQUFFQyxVQUFBQSxLQUFLLEVBQUVGLE9BQU8sQ0FBQ0UsS0FBakI7QUFBd0JDLFVBQUFBLE1BQU0sRUFBRUgsT0FBTyxDQUFDRztBQUF4QyxTQUF2QixDQUFWO0FBQ0FoQyxRQUFBQSxHQUFHLENBQUNpQyxjQUFKLENBQW1CSixPQUFuQjtBQUNBLGVBQU83QixHQUFQO0FBQ0g7QUFDSjs7QUFDRHhELElBQUFBLEVBQUUsQ0FBQzZELE9BQUgsQ0FBVyxJQUFYLEVBQWlCc0IsSUFBakI7QUFDQSxXQUFPLElBQVA7QUFDSCxHQXpRdUI7O0FBMlF4QjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDSXBCLEVBQUFBLFNBQVMsRUFBRSxtQkFBVUgsS0FBVixFQUFpQjtBQUN4QixRQUFJLEtBQUtoQixXQUFULEVBQXNCO0FBQ2xCLGFBQU8sS0FBS0EsV0FBWjtBQUNIOztBQUVELFFBQUssQ0FBQyxLQUFLeEIsU0FBWCxFQUF1QjtBQUNuQixVQUFLLENBQUN3QyxLQUFOLEVBQWM7QUFDVjVELFFBQUFBLEVBQUUsQ0FBQzZELE9BQUgsQ0FBVyxJQUFYLEVBQWlCLEtBQUszRCxJQUF0QjtBQUNIOztBQUNELGFBQU8sSUFBUDtBQUNIOztBQUVELFdBQU8sS0FBSzBDLFdBQUwsR0FBbUIsSUFBSUosRUFBRSxDQUFDeUIsS0FBSCxDQUFTeUIsWUFBYixDQUEwQixLQUFLdEUsU0FBL0IsRUFBMEMsS0FBSzhELFdBQUwsQ0FBaUJTLElBQWpCLENBQXNCLElBQXRCLENBQTFDLENBQTFCO0FBQ0gsR0E5UnVCO0FBZ1N4QkMsRUFBQUEsT0FoU3dCLHFCQWdTYjtBQUNQakcsSUFBQUEsYUFBYSxDQUFDa0csY0FBZCxDQUE2QixLQUFLN0UsS0FBbEM7O0FBQ0EsU0FBSzhFLE1BQUw7QUFDSDtBQW5TdUIsQ0FBVCxDQUFuQjtBQXNTQXRELEVBQUUsQ0FBQ3pDLFlBQUgsR0FBa0JnRyxNQUFNLENBQUNDLE9BQVAsR0FBaUJqRyxZQUFuQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbi8qKlxuICogQG1vZHVsZSBzcFxuICovXG5sZXQgU2tlbGV0b25DYWNoZSA9ICFDQ19KU0IgJiYgcmVxdWlyZSgnLi9za2VsZXRvbi1jYWNoZScpLnNoYXJlZENhY2hlO1xuXG4vKipcbiAqICEjZW4gVGhlIHNrZWxldG9uIGRhdGEgb2Ygc3BpbmUuXG4gKiAhI3poIFNwaW5lIOeahCDpqqjpqrzmlbDmja7jgIJcbiAqIEBjbGFzcyBTa2VsZXRvbkRhdGFcbiAqIEBleHRlbmRzIEFzc2V0XG4gKi9cbmxldCBTa2VsZXRvbkRhdGEgPSBjYy5DbGFzcyh7XG4gICAgbmFtZTogJ3NwLlNrZWxldG9uRGF0YScsXG4gICAgZXh0ZW5kczogY2MuQXNzZXQsXG5cbiAgICBjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBfc2tlbGV0b25Kc29uOiBudWxsLFxuXG4gICAgICAgIC8vIHVzZSBieSBqc2JcbiAgICAgICAgc2tlbGV0b25Kc29uU3RyOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2tlbGV0b25Kc29uKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeSh0aGlzLl9za2VsZXRvbkpzb24pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogISNlbiBTZWUgaHR0cDovL2VuLmVzb3Rlcmljc29mdHdhcmUuY29tL3NwaW5lLWpzb24tZm9ybWF0XG4gICAgICAgICAqICEjemgg5Y+v5p+l55yLIFNwaW5lIOWumOaWueaWh+ahoyBodHRwOi8vemguZXNvdGVyaWNzb2Z0d2FyZS5jb20vc3BpbmUtanNvbi1mb3JtYXRcbiAgICAgICAgICogQHByb3BlcnR5IHtPYmplY3R9IHNrZWxldG9uSnNvblxuICAgICAgICAgKi9cbiAgICAgICAgc2tlbGV0b25Kc29uOiB7XG4gICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2tlbGV0b25Kc29uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YodmFsdWUpID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tlbGV0b25Kc29uID0gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2tlbGV0b25Kc29uID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIElmIGNyZWF0ZSBieSBtYW51YWwsIHV1aWQgaXMgZW1wdHkuXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLl91dWlkICYmIHZhbHVlLnNrZWxldG9uKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3V1aWQgPSB2YWx1ZS5za2VsZXRvbi5oYXNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBfYXRsYXNUZXh0OiBcIlwiLFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJvcGVydHkge1N0cmluZ30gYXRsYXNUZXh0XG4gICAgICAgICAqL1xuICAgICAgICBhdGxhc1RleHQ6IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hdGxhc1RleHQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hdGxhc1RleHQgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBwcm9wZXJ0eSB7VGV4dHVyZTJEW119IHRleHR1cmVzXG4gICAgICAgICAqL1xuICAgICAgICB0ZXh0dXJlczoge1xuICAgICAgICAgICAgZGVmYXVsdDogW10sXG4gICAgICAgICAgICB0eXBlOiBbY2MuVGV4dHVyZTJEXVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJvcGVydHkge1N0cmluZ1tdfSB0ZXh0dXJlTmFtZXNcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIHRleHR1cmVOYW1lczoge1xuICAgICAgICAgICAgZGVmYXVsdDogW10sXG4gICAgICAgICAgICB0eXBlOiBbY2MuU3RyaW5nXVxuICAgICAgICB9LFxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiAhI2VuXG4gICAgICAgICAqIEEgc2NhbGUgY2FuIGJlIHNwZWNpZmllZCBvbiB0aGUgSlNPTiBvciBiaW5hcnkgbG9hZGVyIHdoaWNoIHdpbGwgc2NhbGUgdGhlIGJvbmUgcG9zaXRpb25zLFxuICAgICAgICAgKiBpbWFnZSBzaXplcywgYW5kIGFuaW1hdGlvbiB0cmFuc2xhdGlvbnMuXG4gICAgICAgICAqIFRoaXMgY2FuIGJlIHVzZWZ1bCB3aGVuIHVzaW5nIGRpZmZlcmVudCBzaXplZCBpbWFnZXMgdGhhbiB3ZXJlIHVzZWQgd2hlbiBkZXNpZ25pbmcgdGhlIHNrZWxldG9uXG4gICAgICAgICAqIGluIFNwaW5lLiBGb3IgZXhhbXBsZSwgaWYgdXNpbmcgaW1hZ2VzIHRoYXQgYXJlIGhhbGYgdGhlIHNpemUgdGhhbiB3ZXJlIHVzZWQgaW4gU3BpbmUsXG4gICAgICAgICAqIGEgc2NhbGUgb2YgMC41IGNhbiBiZSB1c2VkLiBUaGlzIGlzIGNvbW1vbmx5IHVzZWQgZm9yIGdhbWVzIHRoYXQgY2FuIHJ1biB3aXRoIGVpdGhlciBsb3cgb3IgaGlnaFxuICAgICAgICAgKiByZXNvbHV0aW9uIHRleHR1cmUgYXRsYXNlcy5cbiAgICAgICAgICogc2VlIGh0dHA6Ly9lbi5lc290ZXJpY3NvZnR3YXJlLmNvbS9zcGluZS11c2luZy1ydW50aW1lcyNTY2FsaW5nXG4gICAgICAgICAqICEjemgg5Y+v5p+l55yLIFNwaW5lIOWumOaWueaWh+aho++8miBodHRwOi8vemguZXNvdGVyaWNzb2Z0d2FyZS5jb20vc3BpbmUtdXNpbmctcnVudGltZXMjU2NhbGluZ1xuICAgICAgICAgKiBAcHJvcGVydHkge051bWJlcn0gc2NhbGVcbiAgICAgICAgICovXG4gICAgICAgIHNjYWxlOiAxLFxuXG4gICAgICAgIF9uYXRpdmVBc3NldDoge1xuICAgICAgICAgICAgZ2V0ICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYnVmZmVyO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldCAoYmluKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYnVmZmVyID0gYmluLmJ1ZmZlciB8fCBiaW47XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG92ZXJyaWRlOiB0cnVlXG4gICAgICAgIH0sXG4gICAgfSxcblxuICAgIHN0YXRpY3M6IHtcbiAgICAgICAgcHJldmVudERlZmVycmVkTG9hZERlcGVuZGVudHM6IHRydWUsXG4gICAgfSxcblxuICAgIC8vIFBVQkxJQ1xuXG4gICAgY3JlYXRlTm9kZTogQ0NfRURJVE9SICYmIGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICBsZXQgbm9kZSA9IG5ldyBjYy5Ob2RlKHRoaXMubmFtZSk7XG4gICAgICAgIGxldCBza2VsZXRvbiA9IG5vZGUuYWRkQ29tcG9uZW50KHNwLlNrZWxldG9uKTtcbiAgICAgICAgc2tlbGV0b24uc2tlbGV0b25EYXRhID0gdGhpcztcblxuICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgbm9kZSk7XG4gICAgfSxcblxuICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJvcGVydHkge3NwLnNwaW5lLlNrZWxldG9uRGF0YX0gX3NrZWxldG9uRGF0YVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fc2tlbGV0b25DYWNoZSA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJvcGVydHkge3NwLnNwaW5lLkF0bGFzfSBfYXRsYXNDYWNoZVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fYXRsYXNDYWNoZSA9IG51bGw7XG4gICAgICAgIGlmIChDQ19FRElUT1IpIHtcbiAgICAgICAgICAgIHRoaXMuX3NraW5zRW51bSA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLl9hbmltc0VudW0gPSBudWxsO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGVuc3VyZVRleHR1cmVzTG9hZGVkIChsb2FkZWQsIGNhbGxlcikge1xuICAgICAgICBsZXQgdGV4dHVyZXMgPSB0aGlzLnRleHR1cmVzOyBcbiAgICAgICAgbGV0IHRleHNMZW4gPSB0ZXh0dXJlcy5sZW5ndGg7XG4gICAgICAgIGlmICh0ZXhzTGVuID09IDApIHtcbiAgICAgICAgICAgIGxvYWRlZC5jYWxsKGNhbGxlciwgZmFsc2UpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGxldCBsb2FkZWRDb3VudCA9IDA7XG4gICAgICAgIGxldCBsb2FkZWRJdGVtID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgbG9hZGVkQ291bnQrKztcbiAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudCA+PSB0ZXhzTGVuKSB7XG4gICAgICAgICAgICAgICAgbG9hZGVkICYmIGxvYWRlZC5jYWxsKGNhbGxlciwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgbG9hZGVkID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRleHNMZW47IGkrKykge1xuICAgICAgICAgICAgbGV0IHRleCA9IHRleHR1cmVzW2ldO1xuICAgICAgICAgICAgaWYgKHRleC5sb2FkZWQpIHtcbiAgICAgICAgICAgICAgICBsb2FkZWRJdGVtKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRleC5vbmNlKCdsb2FkJywgbG9hZGVkSXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgaXNUZXh0dXJlc0xvYWRlZCAoKSB7XG4gICAgICAgIGxldCB0ZXh0dXJlcyA9IHRoaXMudGV4dHVyZXM7IFxuICAgICAgICBsZXQgdGV4c0xlbiA9IHRleHR1cmVzLmxlbmd0aDtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXhzTGVuOyBpKyspIHtcbiAgICAgICAgICAgIGxldCB0ZXggPSB0ZXh0dXJlc1tpXTtcbiAgICAgICAgICAgIGlmICghdGV4LmxvYWRlZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogISNlbiBHZXQgdGhlIGluY2x1ZGVkIFNrZWxldG9uRGF0YSB1c2VkIGluIHNwaW5lIHJ1bnRpbWUuPGJyPlxuICAgICAqIFJldHVybnMgYSB7eyNjcm9zc0xpbmtNb2R1bGUgXCJzcC5zcGluZVwifX1zcC5zcGluZXt7L2Nyb3NzTGlua01vZHVsZX19LlNrZWxldG9uRGF0YSBvYmplY3QuXG4gICAgICogISN6aCDojrflj5YgU3BpbmUgUnVudGltZSDkvb/nlKjnmoQgU2tlbGV0b25EYXRh44CCPGJyPlxuICAgICAqIOi/lOWbnuS4gOS4qiB7eyNjcm9zc0xpbmtNb2R1bGUgXCJzcC5zcGluZVwifX1zcC5zcGluZXt7L2Nyb3NzTGlua01vZHVsZX19LlNrZWxldG9uRGF0YSDlr7nosaHjgIJcbiAgICAgKiBAbWV0aG9kIGdldFJ1bnRpbWVEYXRhXG4gICAgICogQHBhcmFtIHtCb29sZWFufSBbcXVpZXQ9ZmFsc2VdXG4gICAgICogQHJldHVybiB7c3Auc3BpbmUuU2tlbGV0b25EYXRhfVxuICAgICAqL1xuICAgIGdldFJ1bnRpbWVEYXRhOiBmdW5jdGlvbiAocXVpZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NrZWxldG9uQ2FjaGUpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9za2VsZXRvbkNhY2hlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCAhKHRoaXMudGV4dHVyZXMgJiYgdGhpcy50ZXh0dXJlcy5sZW5ndGggPiAwKSAmJiB0aGlzLnRleHR1cmVOYW1lcyAmJiB0aGlzLnRleHR1cmVOYW1lcy5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgaWYgKCAhcXVpZXQgKSB7XG4gICAgICAgICAgICAgICAgY2MuZXJyb3JJRCg3NTA3LCB0aGlzLm5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgYXRsYXMgPSB0aGlzLl9nZXRBdGxhcyhxdWlldCk7XG4gICAgICAgIGlmICghIGF0bGFzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBsZXQgYXR0YWNobWVudExvYWRlciA9IG5ldyBzcC5zcGluZS5BdGxhc0F0dGFjaG1lbnRMb2FkZXIoYXRsYXMpO1xuXG4gICAgICAgIGxldCByZXNEYXRhID0gbnVsbDtcbiAgICAgICAgbGV0IHJlYWRlciA9IG51bGw7XG4gICAgICAgIGlmICh0aGlzLnNrZWxldG9uSnNvbikge1xuICAgICAgICAgICAgcmVhZGVyID0gbmV3IHNwLnNwaW5lLlNrZWxldG9uSnNvbihhdHRhY2htZW50TG9hZGVyKTtcbiAgICAgICAgICAgIHJlc0RhdGEgPSB0aGlzLnNrZWxldG9uSnNvbjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlYWRlciA9IG5ldyBzcC5zcGluZS5Ta2VsZXRvbkJpbmFyeShhdHRhY2htZW50TG9hZGVyKTtcbiAgICAgICAgICAgIHJlc0RhdGEgPSBuZXcgVWludDhBcnJheSh0aGlzLl9uYXRpdmVBc3NldCk7XG4gICAgICAgIH1cblxuICAgICAgICByZWFkZXIuc2NhbGUgPSB0aGlzLnNjYWxlO1xuICAgICAgICB0aGlzLl9za2VsZXRvbkNhY2hlID0gcmVhZGVyLnJlYWRTa2VsZXRvbkRhdGEocmVzRGF0YSk7XG4gICAgICAgIGF0bGFzLmRpc3Bvc2UoKTtcblxuICAgICAgICByZXR1cm4gdGhpcy5fc2tlbGV0b25DYWNoZTtcbiAgICB9LFxuXG4gICAgLy8gRURJVE9SXG5cbiAgICBnZXRTa2luc0VudW06IENDX0VESVRPUiAmJiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9za2luc0VudW0pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9za2luc0VudW07XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHNkID0gdGhpcy5nZXRSdW50aW1lRGF0YSh0cnVlKTtcbiAgICAgICAgaWYgKHNkKSB7XG4gICAgICAgICAgICBsZXQgc2tpbnMgPSBzZC5za2lucztcbiAgICAgICAgICAgIGxldCBlbnVtRGVmID0ge307XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNraW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBza2luc1tpXS5uYW1lO1xuICAgICAgICAgICAgICAgIGVudW1EZWZbbmFtZV0gPSBpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NraW5zRW51bSA9IGNjLkVudW0oZW51bURlZik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIGdldEFuaW1zRW51bTogQ0NfRURJVE9SICYmIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2FuaW1zRW51bSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1zRW51bTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2QgPSB0aGlzLmdldFJ1bnRpbWVEYXRhKHRydWUpO1xuICAgICAgICBpZiAoc2QpIHtcbiAgICAgICAgICAgIGxldCBlbnVtRGVmID0geyAnPE5vbmU+JzogMCB9O1xuICAgICAgICAgICAgbGV0IGFuaW1zID0gc2QuYW5pbWF0aW9ucztcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYW5pbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IGFuaW1zW2ldLm5hbWU7XG4gICAgICAgICAgICAgICAgZW51bURlZltuYW1lXSA9IGkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FuaW1zRW51bSA9IGNjLkVudW0oZW51bURlZik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8vIFBSSVZBVEVcblxuICAgIF9nZXRUZXh0dXJlOiBmdW5jdGlvbiAobGluZSkge1xuICAgICAgICBsZXQgbmFtZXMgPSB0aGlzLnRleHR1cmVOYW1lcztcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuYW1lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG5hbWVzW2ldID09PSBsaW5lKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRleHR1cmUgPSB0aGlzLnRleHR1cmVzW2ldO1xuICAgICAgICAgICAgICAgIGxldCB0ZXggPSBuZXcgc3AuU2tlbGV0b25UZXh0dXJlKHsgd2lkdGg6IHRleHR1cmUud2lkdGgsIGhlaWdodDogdGV4dHVyZS5oZWlnaHQgfSk7XG4gICAgICAgICAgICAgICAgdGV4LnNldFJlYWxUZXh0dXJlKHRleHR1cmUpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2MuZXJyb3JJRCg3NTA2LCBsaW5lKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgX2dldEF0bGFzXG4gICAgICogQHBhcmFtIHtib29sZWFufSBbcXVpZXQ9ZmFsc2VdXG4gICAgICogQHJldHVybiB7c3Auc3BpbmUuQXRsYXN9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfZ2V0QXRsYXM6IGZ1bmN0aW9uIChxdWlldCkge1xuICAgICAgICBpZiAodGhpcy5fYXRsYXNDYWNoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2F0bGFzQ2FjaGU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoICF0aGlzLmF0bGFzVGV4dCApIHtcbiAgICAgICAgICAgIGlmICggIXF1aWV0ICkge1xuICAgICAgICAgICAgICAgIGNjLmVycm9ySUQoNzUwOCwgdGhpcy5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX2F0bGFzQ2FjaGUgPSBuZXcgc3Auc3BpbmUuVGV4dHVyZUF0bGFzKHRoaXMuYXRsYXNUZXh0LCB0aGlzLl9nZXRUZXh0dXJlLmJpbmQodGhpcykpO1xuICAgIH0sXG5cbiAgICBkZXN0cm95ICgpIHtcbiAgICAgICAgU2tlbGV0b25DYWNoZS5yZW1vdmVTa2VsZXRvbih0aGlzLl91dWlkKTtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxufSk7XG5cbnNwLlNrZWxldG9uRGF0YSA9IG1vZHVsZS5leHBvcnRzID0gU2tlbGV0b25EYXRhO1xuIl0sInNvdXJjZVJvb3QiOiIvIn0=