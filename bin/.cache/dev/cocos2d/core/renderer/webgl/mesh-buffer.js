
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/renderer/webgl/mesh-buffer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _gfx = _interopRequireDefault(require("../../../renderer/gfx"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var FIX_IOS14_BUFFER = (cc.sys.os === cc.sys.OS_IOS || cc.sys.os === cc.sys.OS_OSX) && cc.sys.isBrowser && /(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent);
var MeshBuffer = cc.Class({
  name: 'cc.MeshBuffer',
  ctor: function ctor(batcher, vertexFormat) {
    this.init(batcher, vertexFormat);
  },
  init: function init(batcher, vertexFormat) {
    this.byteOffset = 0;
    this.indiceOffset = 0;
    this.vertexOffset = 0;
    this.indiceStart = 0;
    this._dirty = false;
    this._vertexFormat = vertexFormat;
    this._vertexBytes = this._vertexFormat._bytes;
    this._arrOffset = 0;
    this._vbArr = [];
    this._vb = new _gfx["default"].VertexBuffer(batcher._device, vertexFormat, _gfx["default"].USAGE_DYNAMIC, new ArrayBuffer(), 0);
    this._vbArr[0] = this._vb;
    this._ibArr = [];
    this._ib = new _gfx["default"].IndexBuffer(batcher._device, _gfx["default"].INDEX_FMT_UINT16, _gfx["default"].USAGE_STATIC, new ArrayBuffer(), 0);
    this._ibArr[0] = this._ib;
    this._vData = null;
    this._uintVData = null;
    this._iData = null;
    this._batcher = batcher;
    this._initVDataCount = 256 * vertexFormat._bytes; // actually 256 * 4 * (vertexFormat._bytes / 4)

    this._initIDataCount = 256 * 6;
    this._offsetInfo = {
      byteOffset: 0,
      vertexOffset: 0,
      indiceOffset: 0
    };

    this._reallocBuffer();
  },
  uploadData: function uploadData() {
    if (this.byteOffset === 0 || !this._dirty) {
      return;
    } // update vertext data


    var vertexsData = new Float32Array(this._vData.buffer, 0, this.byteOffset >> 2);
    var indicesData = new Uint16Array(this._iData.buffer, 0, this.indiceOffset);
    var vb = this._vb;
    vb.update(0, vertexsData);
    var ib = this._ib;
    ib.update(0, indicesData);
    this._dirty = false;
  },
  switchBuffer: function switchBuffer() {
    var offset = ++this._arrOffset;
    this.byteOffset = 0;
    this.vertexOffset = 0;
    this.indiceOffset = 0;
    this.indiceStart = 0;

    if (offset < this._vbArr.length) {
      this._vb = this._vbArr[offset];
      this._ib = this._ibArr[offset];
    } else {
      this._vb = new _gfx["default"].VertexBuffer(this._batcher._device, this._vertexFormat, _gfx["default"].USAGE_DYNAMIC, new ArrayBuffer(), 0);
      this._vbArr[offset] = this._vb;
      this._ib = new _gfx["default"].IndexBuffer(this._batcher._device, _gfx["default"].INDEX_FMT_UINT16, _gfx["default"].USAGE_STATIC, new ArrayBuffer(), 0);
      this._ibArr[offset] = this._ib;
    }
  },
  checkAndSwitchBuffer: function checkAndSwitchBuffer(vertexCount) {
    if (this.vertexOffset + vertexCount > 65535) {
      this.uploadData();

      this._batcher._flush();

      this.switchBuffer();
    }
  },
  requestStatic: function requestStatic(vertexCount, indiceCount) {
    this.checkAndSwitchBuffer(vertexCount);
    var byteOffset = this.byteOffset + vertexCount * this._vertexBytes;
    var indiceOffset = this.indiceOffset + indiceCount;
    var byteLength = this._vData.byteLength;
    var indiceLength = this._iData.length;

    if (byteOffset > byteLength || indiceOffset > indiceLength) {
      while (byteLength < byteOffset || indiceLength < indiceOffset) {
        this._initVDataCount *= 2;
        this._initIDataCount *= 2;
        byteLength = this._initVDataCount * 4;
        indiceLength = this._initIDataCount;
      }

      this._reallocBuffer();
    }

    this._updateOffset(vertexCount, indiceCount, byteOffset);
  },
  _updateOffset: function _updateOffset(vertexCount, indiceCount, byteOffset) {
    var offsetInfo = this._offsetInfo;
    offsetInfo.vertexOffset = this.vertexOffset;
    this.vertexOffset += vertexCount;
    offsetInfo.indiceOffset = this.indiceOffset;
    this.indiceOffset += indiceCount;
    offsetInfo.byteOffset = this.byteOffset;
    this.byteOffset = byteOffset;
    this._dirty = true;
  },
  request: function request(vertexCount, indiceCount) {
    if (this._batcher._buffer !== this) {
      this._batcher._flush();

      this._batcher._buffer = this;
    }

    this.requestStatic(vertexCount, indiceCount);
    return this._offsetInfo;
  },
  _reallocBuffer: function _reallocBuffer() {
    this._reallocVData(true);

    this._reallocIData(true);
  },
  _reallocVData: function _reallocVData(copyOldData) {
    var oldVData;

    if (this._vData) {
      oldVData = new Uint8Array(this._vData.buffer);
    }

    this._vData = new Float32Array(this._initVDataCount);
    this._uintVData = new Uint32Array(this._vData.buffer);
    var newData = new Uint8Array(this._uintVData.buffer);

    if (oldVData && copyOldData) {
      for (var i = 0, l = oldVData.length; i < l; i++) {
        newData[i] = oldVData[i];
      }
    }
  },
  _reallocIData: function _reallocIData(copyOldData) {
    var oldIData = this._iData;
    this._iData = new Uint16Array(this._initIDataCount);

    if (oldIData && copyOldData) {
      var iData = this._iData;

      for (var i = 0, l = oldIData.length; i < l; i++) {
        iData[i] = oldIData[i];
      }
    }
  },
  reset: function reset() {
    this._arrOffset = 0;
    this._vb = this._vbArr[0];
    this._ib = this._ibArr[0];
    this.byteOffset = 0;
    this.indiceOffset = 0;
    this.vertexOffset = 0;
    this.indiceStart = 0;
    this._dirty = false;
  },
  destroy: function destroy() {
    this.reset();

    for (var i = 0; i < this._vbArr.length; i++) {
      var vb = this._vbArr[i];
      vb.destroy();
    }

    this._vbArr = null;

    for (var _i = 0; _i < this._ibArr.length; _i++) {
      var ib = this._ibArr[_i];
      ib.destroy();
    }

    this._ibArr = null;
    this._ib = null;
    this._vb = null;
  },
  forwardIndiceStartToOffset: function forwardIndiceStartToOffset() {
    this.indiceStart = this.indiceOffset;
  }
}); // Should not share vb and id between multiple drawcalls on iOS14, it will cost a lot of time.
// TODO: maybe remove it after iOS14 fix it?

if (FIX_IOS14_BUFFER) {
  MeshBuffer.prototype.checkAndSwitchBuffer = function (vertexCount) {
    if (this.vertexOffset + vertexCount > 65535) {
      this.uploadData();

      this._batcher._flush();
    }
  };

  MeshBuffer.prototype.forwardIndiceStartToOffset = function () {
    this.uploadData();
    this.switchBuffer();
  };
}

cc.MeshBuffer = module.exports = MeshBuffer;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3JlbmRlcmVyL3dlYmdsL21lc2gtYnVmZmVyLmpzIl0sIm5hbWVzIjpbIkZJWF9JT1MxNF9CVUZGRVIiLCJjYyIsInN5cyIsIm9zIiwiT1NfSU9TIiwiT1NfT1NYIiwiaXNCcm93c2VyIiwidGVzdCIsIndpbmRvdyIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsIk1lc2hCdWZmZXIiLCJDbGFzcyIsIm5hbWUiLCJjdG9yIiwiYmF0Y2hlciIsInZlcnRleEZvcm1hdCIsImluaXQiLCJieXRlT2Zmc2V0IiwiaW5kaWNlT2Zmc2V0IiwidmVydGV4T2Zmc2V0IiwiaW5kaWNlU3RhcnQiLCJfZGlydHkiLCJfdmVydGV4Rm9ybWF0IiwiX3ZlcnRleEJ5dGVzIiwiX2J5dGVzIiwiX2Fyck9mZnNldCIsIl92YkFyciIsIl92YiIsImdmeCIsIlZlcnRleEJ1ZmZlciIsIl9kZXZpY2UiLCJVU0FHRV9EWU5BTUlDIiwiQXJyYXlCdWZmZXIiLCJfaWJBcnIiLCJfaWIiLCJJbmRleEJ1ZmZlciIsIklOREVYX0ZNVF9VSU5UMTYiLCJVU0FHRV9TVEFUSUMiLCJfdkRhdGEiLCJfdWludFZEYXRhIiwiX2lEYXRhIiwiX2JhdGNoZXIiLCJfaW5pdFZEYXRhQ291bnQiLCJfaW5pdElEYXRhQ291bnQiLCJfb2Zmc2V0SW5mbyIsIl9yZWFsbG9jQnVmZmVyIiwidXBsb2FkRGF0YSIsInZlcnRleHNEYXRhIiwiRmxvYXQzMkFycmF5IiwiYnVmZmVyIiwiaW5kaWNlc0RhdGEiLCJVaW50MTZBcnJheSIsInZiIiwidXBkYXRlIiwiaWIiLCJzd2l0Y2hCdWZmZXIiLCJvZmZzZXQiLCJsZW5ndGgiLCJjaGVja0FuZFN3aXRjaEJ1ZmZlciIsInZlcnRleENvdW50IiwiX2ZsdXNoIiwicmVxdWVzdFN0YXRpYyIsImluZGljZUNvdW50IiwiYnl0ZUxlbmd0aCIsImluZGljZUxlbmd0aCIsIl91cGRhdGVPZmZzZXQiLCJvZmZzZXRJbmZvIiwicmVxdWVzdCIsIl9idWZmZXIiLCJfcmVhbGxvY1ZEYXRhIiwiX3JlYWxsb2NJRGF0YSIsImNvcHlPbGREYXRhIiwib2xkVkRhdGEiLCJVaW50OEFycmF5IiwiVWludDMyQXJyYXkiLCJuZXdEYXRhIiwiaSIsImwiLCJvbGRJRGF0YSIsImlEYXRhIiwicmVzZXQiLCJkZXN0cm95IiwiZm9yd2FyZEluZGljZVN0YXJ0VG9PZmZzZXQiLCJwcm90b3R5cGUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBeUJBOzs7O0FBekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLElBQU1BLGdCQUFnQixHQUFHLENBQUNDLEVBQUUsQ0FBQ0MsR0FBSCxDQUFPQyxFQUFQLEtBQWNGLEVBQUUsQ0FBQ0MsR0FBSCxDQUFPRSxNQUFyQixJQUErQkgsRUFBRSxDQUFDQyxHQUFILENBQU9DLEVBQVAsS0FBY0YsRUFBRSxDQUFDQyxHQUFILENBQU9HLE1BQXJELEtBQWdFSixFQUFFLENBQUNDLEdBQUgsQ0FBT0ksU0FBdkUsSUFBb0YsZ0NBQWdDQyxJQUFoQyxDQUFxQ0MsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxTQUF0RCxDQUE3RztBQUVBLElBQUlDLFVBQVUsR0FBR1YsRUFBRSxDQUFDVyxLQUFILENBQVM7QUFDdEJDLEVBQUFBLElBQUksRUFBRSxlQURnQjtBQUV0QkMsRUFBQUEsSUFGc0IsZ0JBRWhCQyxPQUZnQixFQUVQQyxZQUZPLEVBRU87QUFDekIsU0FBS0MsSUFBTCxDQUFXRixPQUFYLEVBQW9CQyxZQUFwQjtBQUNILEdBSnFCO0FBTXRCQyxFQUFBQSxJQU5zQixnQkFNaEJGLE9BTmdCLEVBTVBDLFlBTk8sRUFNTztBQUN6QixTQUFLRSxVQUFMLEdBQWtCLENBQWxCO0FBQ0EsU0FBS0MsWUFBTCxHQUFvQixDQUFw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bUIsRUFBQyxFQUF6QyxFQUE2QztBQUN6QyxVQUFJdEIsRUFBRSxHQUFHLEtBQUtyQixNQUFMLENBQVkyQyxFQUFaLENBQVQ7QUFDQXRCLE1BQUFBLEVBQUUsQ0FBQzJCLE9BQUg7QUFDSDs7QUFDRCxTQUFLaEQsTUFBTCxHQUFjLElBQWQ7QUFFQSxTQUFLQyxHQUFMLEdBQVcsSUFBWDtBQUNBLFNBQUtQLEdBQUwsR0FBVyxJQUFYO0FBQ0gsR0FsT3FCO0FBb090QnVELEVBQUFBLDBCQXBPc0Isd0NBb09RO0FBQzFCLFNBQUs5RCxXQUFMLEdBQW1CLEtBQUtGLFlBQXhCO0FBQ0g7QUF0T3FCLENBQVQsQ0FBakIsRUF5T0E7QUFDQTs7QUFDQSxJQUFJbkIsZ0JBQUosRUFBc0I7QUFDbEJXLEVBQUFBLFVBQVUsQ0FBQ3lFLFNBQVgsQ0FBcUJ6QixvQkFBckIsR0FBNEMsVUFBVUMsV0FBVixFQUF1QjtBQUMvRCxRQUFJLEtBQUt4QyxZQUFMLEdBQW9Cd0MsV0FBcEIsR0FBa0MsS0FBdEMsRUFBNkM7QUFDekMsV0FBS2IsVUFBTDs7QUFDQSxXQUFLTCxRQUFMLENBQWNtQixNQUFkO0FBQ0g7QUFDSixHQUxEOztBQU1BbEQsRUFBQUEsVUFBVSxDQUFDeUUsU0FBWCxDQUFxQkQsMEJBQXJCLEdBQWtELFlBQVk7QUFDMUQsU0FBS3BDLFVBQUw7QUFDQSxTQUFLUyxZQUFMO0FBQ0gsR0FIRDtBQUlIOztBQUVEdkQsRUFBRSxDQUFDVSxVQUFILEdBQWdCMEUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCM0UsVUFBakMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xuXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxuIHdvcmxkd2lkZSwgcm95YWx0eS1mcmVlLCBub24tYXNzaWduYWJsZSwgcmV2b2NhYmxlIGFuZCBub24tZXhjbHVzaXZlIGxpY2Vuc2VcbiB0byB1c2UgQ29jb3MgQ3JlYXRvciBzb2xlbHkgdG8gZGV2ZWxvcCBnYW1lcyBvbiB5b3VyIHRhcmdldCBwbGF0Zm9ybXMuIFlvdSBzaGFsbFxuIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcbiB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG4gc3VibGljZW5zZSwgYW5kL29yIHNlbGwgY29waWVzIG9mIENvY29zIENyZWF0b3IuXG5cbiBUaGUgc29mdHdhcmUgb3IgdG9vbHMgaW4gdGhpcyBMaWNlbnNlIEFncmVlbWVudCBhcmUgbGljZW5zZWQsIG5vdCBzb2xkLlxuIFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLiByZXNlcnZlcyBhbGwgcmlnaHRzIG5vdCBleHByZXNzbHkgZ3JhbnRlZCB0byB5b3UuXG5cbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuIFRIRSBTT0ZUV0FSRS5cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5pbXBvcnQgZ2Z4IGZyb20gJy4uLy4uLy4uL3JlbmRlcmVyL2dmeCc7XG5cbmNvbnN0IEZJWF9JT1MxNF9CVUZGRVIgPSAoY2Muc3lzLm9zID09PSBjYy5zeXMuT1NfSU9TIHx8IGNjLnN5cy5vcyA9PT0gY2Muc3lzLk9TX09TWCkgJiYgY2Muc3lzLmlzQnJvd3NlciAmJiAvKE9TIDFbNC05XSl8KFZlcnNpb25cXC8xWzQtOV0pLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcblxubGV0IE1lc2hCdWZmZXIgPSBjYy5DbGFzcyh7XG4gICAgbmFtZTogJ2NjLk1lc2hCdWZmZXInLFxuICAgIGN0b3IgKGJhdGNoZXIsIHZlcnRleEZvcm1hdCkge1xuICAgICAgICB0aGlzLmluaXQgKGJhdGNoZXIsIHZlcnRleEZvcm1hdCk7XG4gICAgfSxcblxuICAgIGluaXQgKGJhdGNoZXIsIHZlcnRleEZvcm1hdCkge1xuICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSAwO1xuICAgICAgICB0aGlzLmluZGljZU9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMudmVydGV4T2Zmc2V0ID0gMDtcbiAgICAgICAgdGhpcy5pbmRpY2VTdGFydCA9IDA7XG5cbiAgICAgICAgdGhpcy5fZGlydHkgPSBmYWxzZTtcblxuICAgICAgICB0aGlzLl92ZXJ0ZXhGb3JtYXQgPSB2ZXJ0ZXhGb3JtYXQ7XG4gICAgICAgIHRoaXMuX3ZlcnRleEJ5dGVzID0gdGhpcy5fdmVydGV4Rm9ybWF0Ll9ieXRlcztcblxuICAgICAgICB0aGlzLl9hcnJPZmZzZXQgPSAwO1xuICAgICAgICB0aGlzLl92YkFyciA9IFtdO1xuICAgICAgICB0aGlzLl92YiA9IG5ldyBnZnguVmVydGV4QnVmZmVyKFxuICAgICAgICAgICAgYmF0Y2hlci5fZGV2aWNlLFxuICAgICAgICAgICAgdmVydGV4Rm9ybWF0LFxuICAgICAgICAgICAgZ2Z4LlVTQUdFX0RZTkFNSUMsXG4gICAgICAgICAgICBuZXcgQXJyYXlCdWZmZXIoKSxcbiAgICAgICAgICAgIDBcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5fdmJBcnJbMF0gPSB0aGlzLl92YjtcblxuICAgICAgICB0aGlzLl9pYkFyciA9IFtdO1xuICAgICAgICB0aGlzLl9pYiA9IG5ldyBnZnguSW5kZXhCdWZmZXIoXG4gICAgICAgICAgICBiYXRjaGVyLl9kZXZpY2UsXG4gICAgICAgICAgICBnZnguSU5ERVhfRk1UX1VJTlQxNixcbiAgICAgICAgICAgIGdmeC5VU0FHRV9TVEFUSUMsXG4gICAgICAgICAgICBuZXcgQXJyYXlCdWZmZXIoKSxcbiAgICAgICAgICAgIDBcbiAgICAgICAgKTtcbiAgICAgICAgdGhpcy5faWJBcnJbMF0gPSB0aGlzLl9pYjtcblxuICAgICAgICB0aGlzLl92RGF0YSA9IG51bGw7XG4gICAgICAgIHRoaXMuX3VpbnRWRGF0YSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2lEYXRhID0gbnVsbDtcblxuICAgICAgICB0aGlzLl9iYXRjaGVyID0gYmF0Y2hlcjtcblxuICAgICAgICB0aGlzLl9pbml0VkRhdGFDb3VudCA9IDI1NiAqIHZlcnRleEZvcm1hdC5fYnl0ZXM7Ly8gYWN0dWFsbHkgMjU2ICogNCAqICh2ZXJ0ZXhGb3JtYXQuX2J5dGVzIC8gNClcbiAgICAgICAgdGhpcy5faW5pdElEYXRhQ291bnQgPSAyNTYgKiA2O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5fb2Zmc2V0SW5mbyA9IHtcbiAgICAgICAgICAgIGJ5dGVPZmZzZXQgOiAwLFxuICAgICAgICAgICAgdmVydGV4T2Zmc2V0IDogMCxcbiAgICAgICAgICAgIGluZGljZU9mZnNldCA6IDBcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZWFsbG9jQnVmZmVyKCk7XG4gICAgfSxcblxuICAgIHVwbG9hZERhdGEgKCkge1xuICAgICAgICBpZiAodGhpcy5ieXRlT2Zmc2V0ID09PSAwIHx8ICF0aGlzLl9kaXJ0eSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdXBkYXRlIHZlcnRleHQgZGF0YVxuICAgICAgICBsZXQgdmVydGV4c0RhdGEgPSBuZXcgRmxvYXQzMkFycmF5KHRoaXMuX3ZEYXRhLmJ1ZmZlciwgMCwgdGhpcy5ieXRlT2Zmc2V0ID4+IDIpO1xuICAgICAgICBsZXQgaW5kaWNlc0RhdGEgPSBuZXcgVWludDE2QXJyYXkodGhpcy5faURhdGEuYnVmZmVyLCAwLCB0aGlzLmluZGljZU9mZnNldCk7XG5cbiAgICAgICAgbGV0IHZiID0gdGhpcy5fdmI7XG4gICAgICAgIHZiLnVwZGF0ZSgwLCB2ZXJ0ZXhzRGF0YSk7XG5cbiAgICAgICAgbGV0IGliID0gdGhpcy5faWI7XG4gICAgICAgIGliLnVwZGF0ZSgwLCBpbmRpY2VzRGF0YSk7XG5cbiAgICAgICAgdGhpcy5fZGlydHkgPSBmYWxzZTtcbiAgICB9LFxuXG4gICAgc3dpdGNoQnVmZmVyICgpIHtcbiAgICAgICAgbGV0IG9mZnNldCA9ICsrdGhpcy5fYXJyT2Zmc2V0O1xuXG4gICAgICAgIHRoaXMuYnl0ZU9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMudmVydGV4T2Zmc2V0ID0gMDtcbiAgICAgICAgdGhpcy5pbmRpY2VPZmZzZXQgPSAwO1xuICAgICAgICB0aGlzLmluZGljZVN0YXJ0ID0gMDtcblxuICAgICAgICBpZiAob2Zmc2V0IDwgdGhpcy5fdmJBcnIubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl92YiA9IHRoaXMuX3ZiQXJyW29mZnNldF07XG4gICAgICAgICAgICB0aGlzLl9pYiA9IHRoaXMuX2liQXJyW29mZnNldF07XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIHRoaXMuX3ZiID0gbmV3IGdmeC5WZXJ0ZXhCdWZmZXIoXG4gICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hlci5fZGV2aWNlLFxuICAgICAgICAgICAgICAgIHRoaXMuX3ZlcnRleEZvcm1hdCxcbiAgICAgICAgICAgICAgICBnZnguVVNBR0VfRFlOQU1JQyxcbiAgICAgICAgICAgICAgICBuZXcgQXJyYXlCdWZmZXIoKSxcbiAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdGhpcy5fdmJBcnJbb2Zmc2V0XSA9IHRoaXMuX3ZiO1xuXG4gICAgICAgICAgICB0aGlzLl9pYiA9IG5ldyBnZnguSW5kZXhCdWZmZXIoXG4gICAgICAgICAgICAgICAgdGhpcy5fYmF0Y2hlci5fZGV2aWNlLFxuICAgICAgICAgICAgICAgIGdmeC5JTkRFWF9GTVRfVUlOVDE2LFxuICAgICAgICAgICAgICAgIGdmeC5VU0FHRV9TVEFUSUMsXG4gICAgICAgICAgICAgICAgbmV3IEFycmF5QnVmZmVyKCksXG4gICAgICAgICAgICAgICAgMFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHRoaXMuX2liQXJyW29mZnNldF0gPSB0aGlzLl9pYjtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjaGVja0FuZFN3aXRjaEJ1ZmZlciAodmVydGV4Q291bnQpIHtcbiAgICAgICAgaWYgKHRoaXMudmVydGV4T2Zmc2V0ICsgdmVydGV4Q291bnQgPiA2NTUzNSkge1xuICAgICAgICAgICAgdGhpcy51cGxvYWREYXRhKCk7XG4gICAgICAgICAgICB0aGlzLl9iYXRjaGVyLl9mbHVzaCgpO1xuICAgICAgICAgICAgdGhpcy5zd2l0Y2hCdWZmZXIoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXF1ZXN0U3RhdGljICh2ZXJ0ZXhDb3VudCwgaW5kaWNlQ291bnQpIHtcblxuICAgICAgICB0aGlzLmNoZWNrQW5kU3dpdGNoQnVmZmVyKHZlcnRleENvdW50KTtcblxuICAgICAgICBsZXQgYnl0ZU9mZnNldCA9IHRoaXMuYnl0ZU9mZnNldCArIHZlcnRleENvdW50ICogdGhpcy5fdmVydGV4Qnl0ZXM7XG4gICAgICAgIGxldCBpbmRpY2VPZmZzZXQgPSB0aGlzLmluZGljZU9mZnNldCArIGluZGljZUNvdW50O1xuXG4gICAgICAgIGxldCBieXRlTGVuZ3RoID0gdGhpcy5fdkRhdGEuYnl0ZUxlbmd0aDtcbiAgICAgICAgbGV0IGluZGljZUxlbmd0aCA9IHRoaXMuX2lEYXRhLmxlbmd0aDtcbiAgICAgICAgaWYgKGJ5dGVPZmZzZXQgPiBieXRlTGVuZ3RoIHx8IGluZGljZU9mZnNldCA+IGluZGljZUxlbmd0aCkge1xuICAgICAgICAgICAgd2hpbGUgKGJ5dGVMZW5ndGggPCBieXRlT2Zmc2V0IHx8IGluZGljZUxlbmd0aCA8IGluZGljZU9mZnNldCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2luaXRWRGF0YUNvdW50ICo9IDI7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdElEYXRhQ291bnQgKj0gMjtcblxuICAgICAgICAgICAgICAgIGJ5dGVMZW5ndGggPSB0aGlzLl9pbml0VkRhdGFDb3VudCAqIDQ7XG4gICAgICAgICAgICAgICAgaW5kaWNlTGVuZ3RoID0gdGhpcy5faW5pdElEYXRhQ291bnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX3JlYWxsb2NCdWZmZXIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl91cGRhdGVPZmZzZXQodmVydGV4Q291bnQsIGluZGljZUNvdW50LCBieXRlT2Zmc2V0KTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZU9mZnNldCAodmVydGV4Q291bnQsIGluZGljZUNvdW50LCBieXRlT2Zmc2V0KSB7XG4gICAgICAgIGxldCBvZmZzZXRJbmZvID0gdGhpcy5fb2Zmc2V0SW5mbztcbiAgICAgICAgb2Zmc2V0SW5mby52ZXJ0ZXhPZmZzZXQgPSB0aGlzLnZlcnRleE9mZnNldDtcbiAgICAgICAgdGhpcy52ZXJ0ZXhPZmZzZXQgKz0gdmVydGV4Q291bnQ7XG5cbiAgICAgICAgb2Zmc2V0SW5mby5pbmRpY2VPZmZzZXQgPSB0aGlzLmluZGljZU9mZnNldDtcbiAgICAgICAgdGhpcy5pbmRpY2VPZmZzZXQgKz0gaW5kaWNlQ291bnQ7XG5cbiAgICAgICAgb2Zmc2V0SW5mby5ieXRlT2Zmc2V0ID0gdGhpcy5ieXRlT2Zmc2V0O1xuICAgICAgICB0aGlzLmJ5dGVPZmZzZXQgPSBieXRlT2Zmc2V0O1xuXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB9LFxuXG4gICAgcmVxdWVzdCAodmVydGV4Q291bnQsIGluZGljZUNvdW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9iYXRjaGVyLl9idWZmZXIgIT09IHRoaXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2JhdGNoZXIuX2ZsdXNoKCk7XG4gICAgICAgICAgICB0aGlzLl9iYXRjaGVyLl9idWZmZXIgPSB0aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZXF1ZXN0U3RhdGljKHZlcnRleENvdW50LCBpbmRpY2VDb3VudCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9vZmZzZXRJbmZvO1xuICAgIH0sXG4gICAgXG4gICAgX3JlYWxsb2NCdWZmZXIgKCkge1xuICAgICAgICB0aGlzLl9yZWFsbG9jVkRhdGEodHJ1ZSk7XG4gICAgICAgIHRoaXMuX3JlYWxsb2NJRGF0YSh0cnVlKTtcbiAgICB9LFxuXG4gICAgX3JlYWxsb2NWRGF0YSAoY29weU9sZERhdGEpIHtcbiAgICAgICAgbGV0IG9sZFZEYXRhO1xuICAgICAgICBpZiAodGhpcy5fdkRhdGEpIHtcbiAgICAgICAgICAgIG9sZFZEYXRhID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fdkRhdGEuYnVmZmVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3ZEYXRhID0gbmV3IEZsb2F0MzJBcnJheSh0aGlzLl9pbml0VkRhdGFDb3VudCk7XG4gICAgICAgIHRoaXMuX3VpbnRWRGF0YSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLl92RGF0YS5idWZmZXIpO1xuXG4gICAgICAgIGxldCBuZXdEYXRhID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fdWludFZEYXRhLmJ1ZmZlcik7XG5cbiAgICAgICAgaWYgKG9sZFZEYXRhICYmIGNvcHlPbGREYXRhKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IG9sZFZEYXRhLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgICAgIG5ld0RhdGFbaV0gPSBvbGRWRGF0YVtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfcmVhbGxvY0lEYXRhIChjb3B5T2xkRGF0YSkge1xuICAgICAgICBsZXQgb2xkSURhdGEgPSB0aGlzLl9pRGF0YTtcblxuICAgICAgICB0aGlzLl9pRGF0YSA9IG5ldyBVaW50MTZBcnJheSh0aGlzLl9pbml0SURhdGFDb3VudCk7XG5cbiAgICAgICAgaWYgKG9sZElEYXRhICYmIGNvcHlPbGREYXRhKSB7XG4gICAgICAgICAgICBsZXQgaURhdGEgPSB0aGlzLl9pRGF0YTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gb2xkSURhdGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaURhdGFbaV0gPSBvbGRJRGF0YVtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICByZXNldCAoKSB7XG4gICAgICAgIHRoaXMuX2Fyck9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMuX3ZiID0gdGhpcy5fdmJBcnJbMF07XG4gICAgICAgIHRoaXMuX2liID0gdGhpcy5faWJBcnJbMF07XG5cbiAgICAgICAgdGhpcy5ieXRlT2Zmc2V0ID0gMDtcbiAgICAgICAgdGhpcy5pbmRpY2VPZmZzZXQgPSAwO1xuICAgICAgICB0aGlzLnZlcnRleE9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMuaW5kaWNlU3RhcnQgPSAwO1xuXG4gICAgICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gICAgfSxcblxuICAgIGRlc3Ryb3kgKCkge1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgIHRoaXMuX3ZiQXJyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgdmIgPSB0aGlzLl92YkFycltpXTtcbiAgICAgICAgICAgIHZiLmRlc3Ryb3koKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl92YkFyciA9IG51bGw7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9pYkFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IGliID0gdGhpcy5faWJBcnJbaV07XG4gICAgICAgICAgICBpYi5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5faWJBcnIgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuX2liID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdmIgPSBudWxsO1xuICAgIH0sXG5cbiAgICBmb3J3YXJkSW5kaWNlU3RhcnRUb09mZnNldCAoKSB7XG4gICAgICAgIHRoaXMuaW5kaWNlU3RhcnQgPSB0aGlzLmluZGljZU9mZnNldDtcbiAgICB9XG59KTtcblxuLy8gU2hvdWxkIG5vdCBzaGFyZSB2YiBhbmQgaWQgYmV0d2VlbiBtdWx0aXBsZSBkcmF3Y2FsbHMgb24gaU9TMTQsIGl0IHdpbGwgY29zdCBhIGxvdCBvZiB0aW1lLlxuLy8gVE9ETzogbWF5YmUgcmVtb3ZlIGl0IGFmdGVyIGlPUzE0IGZpeCBpdD9cbmlmIChGSVhfSU9TMTRfQlVGRkVSKSB7XG4gICAgTWVzaEJ1ZmZlci5wcm90b3R5cGUuY2hlY2tBbmRTd2l0Y2hCdWZmZXIgPSBmdW5jdGlvbiAodmVydGV4Q291bnQpIHtcbiAgICAgICAgaWYgKHRoaXMudmVydGV4T2Zmc2V0ICsgdmVydGV4Q291bnQgPiA2NTUzNSkge1xuICAgICAgICAgICAgdGhpcy51cGxvYWREYXRhKCk7XG4gICAgICAgICAgICB0aGlzLl9iYXRjaGVyLl9mbHVzaCgpO1xuICAgICAgICB9XG4gICAgfTsgICAgIFxuICAgIE1lc2hCdWZmZXIucHJvdG90eXBlLmZvcndhcmRJbmRpY2VTdGFydFRvT2Zmc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVwbG9hZERhdGEoKTtcbiAgICAgICAgdGhpcy5zd2l0Y2hCdWZmZXIoKTtcbiAgICB9ICBcbn1cblxuY2MuTWVzaEJ1ZmZlciA9IG1vZHVsZS5leHBvcnRzID0gTWVzaEJ1ZmZlcjtcbiJdLCJzb3VyY2VSb290IjoiLyJ9