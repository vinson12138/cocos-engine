
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/components/CCCanvas.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Camera = require('../camera/CCCamera');

var Component = require('./CCComponent'); // Screen adaptation strategy for Canvas + Widget


function resetWidgetComponent(canvas) {
  var widget = canvas.node.getComponent(cc.Widget);

  if (!widget) {
    widget = canvas.node.addComponent(cc.Widget);
  }

  widget.isAlignTop = true;
  widget.isAlignBottom = true;
  widget.isAlignLeft = true;
  widget.isAlignRight = true;
  widget.top = 0;
  widget.bottom = 0;
  widget.left = 0;
  widget.right = 0;
}
/**
 * !#zh 作为 UI 根节点，为所有子节点提供视窗四边的位置信息以供对齐，另外提供屏幕适配策略接口，方便从编辑器设置。<br>
 * 注：由于本节点的尺寸会跟随屏幕拉伸，所以 anchorPoint 只支持 (0.5, 0.5)，否则适配不同屏幕时坐标会有偏差。
 *
 * @class Canvas
 * @extends Component
 */


var Canvas = cc.Class({
  name: 'cc.Canvas',
  "extends": Component,
  editor: CC_EDITOR && {
    menu: 'i18n:MAIN_MENU.component.ui/Canvas',
    help: 'i18n:COMPONENT.help_url.canvas',
    executeInEditMode: true,
    disallowMultiple: true
  },
  resetInEditor: CC_EDITOR && function () {
    _Scene._applyCanvasPreferences(this);

    resetWidgetComponent(this);
  },
  statics: {
    /**
     * !#en Current active canvas, the scene should only have one active canvas at the same time.
     * !#zh 当前激活的画布组件，场景同一时间只能有一个激活的画布。
     * @property {Canvas} instance
     * @static
     */
    instance: null
  },
  properties: {
    /**
     * !#en The desigin resolution for current scene.
     * !#zh 当前场景设计分辨率。
     * @property {Size} designResolution
     * @default new cc.Size(960, 640)
     */
    _designResolution: cc.size(960, 640),
    designResolution: {
      get: function get() {
        return cc.size(this._designResolution);
      },
      set: function set(value) {
        this._designResolution.width = value.width;
        this._designResolution.height = value.height;
        this.applySettings();
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.design_resolution'
    },
    _fitWidth: false,
    _fitHeight: true,

    /**
     * !#en TODO
     * !#zh: 是否优先将设计分辨率高度撑满视图高度。
     * @property {Boolean} fitHeight
     * @default false
     */
    fitHeight: {
      get: function get() {
        return this._fitHeight;
      },
      set: function set(value) {
        if (this._fitHeight !== value) {
          this._fitHeight = value;
          this.applySettings();
        }
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_height'
    },

    /**
     * !#en TODO
     * !#zh: 是否优先将设计分辨率宽度撑满视图宽度。
     * @property {Boolean} fitWidth
     * @default false
     */
    fitWidth: {
      get: function get() {
        return this._fitWidth;
      },
      set: function set(value) {
        if (this._fitWidth !== value) {
          this._fitWidth = value;
          this.applySettings();
        }
      },
      tooltip: CC_DEV && 'i18n:COMPONENT.canvas.fit_width'
    }
  },
  // fit canvas node to design resolution
  _fitDesignResolution: CC_EDITOR && function () {
    // TODO: support paddings of locked widget
    var designSize = cc.engine.getDesignResolutionSize();
    this.node.setPosition(designSize.width * 0.5, designSize.height * 0.5);
    this.node.setContentSize(designSize);
  },
  __preload: function __preload() {
    if (CC_DEV) {
      var Flags = cc.Object.Flags;
      this._objFlags |= Flags.IsPositionLocked | Flags.IsAnchorLocked | Flags.IsSizeLocked;
    }

    if (Canvas.instance) {
      return cc.warnID(6700, this.node.name, Canvas.instance.node.name);
    }

    Canvas.instance = this; // Align node to fit the screen

    this.applySettings(); // Stretch to matched size during the scene initialization

    var widget = this.getComponent(cc.Widget);

    if (widget) {
      widget.updateAlignment();
    } else if (CC_EDITOR) {
      this._fitDesignResolution();
    } // Constantly align canvas node in edit mode


    if (CC_EDITOR) {
      cc.director.on(cc.Director.EVENT_AFTER_UPDATE, this._fitDesignResolution, this);
      cc.engine.on('design-resolution-changed', this._fitDesignResolution, this);
    }
  },
  start: function start() {
    if (!Camera.main && cc.game.renderType !== cc.game.RENDER_TYPE_CANVAS) {
      // Create default Main Camera
      var cameraNode = new cc.Node('Main Camera');
      cameraNode.parent = this.node;
      cameraNode.setSiblingIndex(0);
      var camera = cameraNode.addComponent(Camera);
      var ClearFlags = Camera.ClearFlags;
      camera.clearFlags = ClearFlags.COLOR | ClearFlags.DEPTH | ClearFlags.STENCIL;
      camera.depth = -1;
    }
  },
  onDestroy: function onDestroy() {
    if (CC_EDITOR) {
      cc.director.off(cc.Director.EVENT_AFTER_UPDATE, this._fitDesignResolution, this);
      cc.engine.off('design-resolution-changed', this._fitDesignResolution, this);
    }

    if (Canvas.instance === this) {
      Canvas.instance = null;
    }
  },
  applySettings: function applySettings() {
    var ResolutionPolicy = cc.ResolutionPolicy;
    var policy;

    if (this.fitHeight && this.fitWidth) {
      policy = ResolutionPolicy.SHOW_ALL;
    } else if (!this.fitHeight && !this.fitWidth) {
      policy = ResolutionPolicy.NO_BORDER;
    } else if (this.fitWidth) {
      policy = ResolutionPolicy.FIXED_WIDTH;
    } else {
      // fitHeight
      policy = ResolutionPolicy.FIXED_HEIGHT;
    }

    var designRes = this._designResolution;

    if (CC_EDITOR) {
      cc.engine.setDesignResolutionSize(designRes.width, designRes.height);
    } else {
      cc.view.setDesignResolutionSize(designRes.width, designRes.height, policy);
    }
  }
});
cc.Canvas = module.exports = Canvas;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL2NvbXBvbmVudHMvQ0NDYW52YXMuanMiXSwibmFtZXMiOlsiQ2FtZXJhIiwicmVxdWlyZSIsIkNvbXBvbmVudCIsInJlc2V0V2lkZ2V0Q29tcG9uZW50IiwiY2FudmFzIiwid2lkZ2V0Iiwibm9kZSIsImdldENvbXBvbmVudCIsImNjIiwiV2lkZ2V0IiwiYWRkQ29tcG9uZW50IiwiaXNBbGlnblRvcCIsImlzQWxpZ25Cb3R0b20iLCJpc0FsaWduTGVmdCIsImlzQWxpZ25SaWdodCIsInRvcCIsImJvdHRvbSIsImxlZnQiLCJyaWdodCIsIkNhbnZhcyIsIkNsYXNzIiwibmFtZSIsImVkaXRvciIsIkNDX0VESVRPUiIsIm1lbnUiLCJoZWxwIiwiZXhlY3V0ZUluRWRpdE1vZGUiLCJkaXNhbGxvd011bHRpcGxlIiwicmVzZXRJbkVkaXRvciIsIl9TY2VuZSIsIl9hcHBseUNhbnZhc1ByZWZlcmVuY2VzIiwic3RhdGljcyIsImluc3RhbmNlIiwicHJvcGVydGllcyIsIl9kZXNpZ25SZXNvbHV0aW9uIiwic2l6ZSIsImRlc2lnblJlc29sdXRpb24iLCJnZXQiLCJzZXQiLCJ2YWx1ZSIsIndpZHRoIiwiaGVpZ2h0IiwiYXBwbHlTZXR0aW5ncyIsInRvb2x0aXAiLCJDQ19ERVYiLCJfZml0V2lkdGgiLCJfZml0SGVpZ2h0IiwiZml0SGVpZ2h0IiwiZml0V2lkdGgiLCJfZml0RGVzaWduUmVzb2x1dGlvbiIsImRlc2lnblNpemUiLCJlbmdpbmUiLCJnZXREZXNpZ25SZXNvbHV0aW9uU2l6ZSIsInNldFBvc2l0aW9uIiwic2V0Q29udGVudFNpemUiLCJfX3ByZWxvYWQiLCJGbGFncyIsIk9iamVjdCIsIl9vYmpGbGFncyIsIklzUG9zaXRpb25Mb2NrZWQiLCJJc0FuY2hvckxvY2tlZCIsIklzU2l6ZUxvY2tlZCIsIndhcm5JRCIsInVwZGF0ZUFsaWdubWVudCIsImRpcmVjdG9yIiwib24iLCJEaXJlY3RvciIsIkVWRU5UX0FGVEVSX1VQREFURSIsInN0YXJ0IiwibWFpbiIsImdhbWUiLCJyZW5kZXJUeXBlIiwiUkVOREVSX1RZUEVfQ0FOVkFTIiwiY2FtZXJhTm9kZSIsIk5vZGUiLCJwYXJlbnQiLCJzZXRTaWJsaW5nSW5kZXgiLCJjYW1lcmEiLCJDbGVhckZsYWdzIiwiY2xlYXJGbGFncyIsIkNPTE9SIiwiREVQVEgiLCJTVEVOQ0lMIiwiZGVwdGgiLCJvbkRlc3Ryb3kiLCJvZmYiLCJSZXNvbHV0aW9uUG9saWN5IiwicG9saWN5IiwiU0hPV19BTEwiLCJOT19CT1JERVIiLCJGSVhFRF9XSURUSCIsIkZJWEVEX0hFSUdIVCIsImRlc2lnblJlcyIsInNldERlc2lnblJlc29sdXRpb25TaXplIiwidmlldyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQUlBLE1BQU0sR0FBR0MsT0FBTyxDQUFDLG9CQUFELENBQXBCOztBQUNBLElBQUlDLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBdkIsRUFFQTs7O0FBQ0EsU0FBU0Usb0JBQVQsQ0FBK0JDLE1BQS9CLEVBQXVDO0FBQ25DLE1BQUlDLE1BQU0sR0FBR0QsTUFBTSxDQUFDRSxJQUFQLENBQVlDLFlBQVosQ0FBeUJDLEVBQUUsQ0FBQ0MsTUFBNUIsQ0FBYjs7QUFDQSxNQUFJLENBQUNKLE1BQUwsRUFBYTtBQUNUQSxJQUFBQSxNQUFNLEdBQUdELE1BQU0sQ0FBQ0UsSUFBUCxDQUFZSSxZQUFaLENBQXlCRixFQUFFLENBQUNDLE1BQTVCLENBQVQ7QUFDSDs7QUFDREosRUFBQUEsTUFBTSxDQUFDTSxVQUFQLEdBQW9CLElBQXBCO0FBQ0FOLEVBQUFBLE1BQU0sQ0FBQ08sYUFBUCxHQUF1QixJQUF2QjtB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RGpDLE1BQUFBLEVBQUUsQ0FBQ3NGLElBQUgsQ0FBUUQsdUJBQVIsQ0FBZ0NELFNBQVMsQ0FBQ3BELEtBQTFDLEVBQWlEb0QsU0FBUyxDQUFDbkQsTUFBM0QsRUFBbUU4QyxNQUFuRTtBQUNIO0FBQ0o7QUFqTGlCLENBQVQsQ0FBYjtBQXFMQS9FLEVBQUUsQ0FBQ1csTUFBSCxHQUFZNEUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCN0UsTUFBN0IiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cblxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cblxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcbiAgd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcbiAgdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbnZhciBDYW1lcmEgPSByZXF1aXJlKCcuLi9jYW1lcmEvQ0NDYW1lcmEnKTtcbnZhciBDb21wb25lbnQgPSByZXF1aXJlKCcuL0NDQ29tcG9uZW50Jyk7XG5cbi8vIFNjcmVlbiBhZGFwdGF0aW9uIHN0cmF0ZWd5IGZvciBDYW52YXMgKyBXaWRnZXRcbmZ1bmN0aW9uIHJlc2V0V2lkZ2V0Q29tcG9uZW50IChjYW52YXMpIHtcbiAgICBsZXQgd2lkZ2V0ID0gY2FudmFzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLldpZGdldCk7XG4gICAgaWYgKCF3aWRnZXQpIHtcbiAgICAgICAgd2lkZ2V0ID0gY2FudmFzLm5vZGUuYWRkQ29tcG9uZW50KGNjLldpZGdldCk7XG4gICAgfVxuICAgIHdpZGdldC5pc0FsaWduVG9wID0gdHJ1ZTtcbiAgICB3aWRnZXQuaXNBbGlnbkJvdHRvbSA9IHRydWU7XG4gICAgd2lkZ2V0LmlzQWxpZ25MZWZ0ID0gdHJ1ZTtcbiAgICB3aWRnZXQuaXNBbGlnblJpZ2h0ID0gdHJ1ZTtcbiAgICB3aWRnZXQudG9wID0gMDtcbiAgICB3aWRnZXQuYm90dG9tID0gMDtcbiAgICB3aWRnZXQubGVmdCA9IDA7XG4gICAgd2lkZ2V0LnJpZ2h0ID0gMDtcbn1cblxuLyoqXG4gKiAhI3poIOS9nOS4uiBVSSDmoLnoioLngrnvvIzkuLrmiYDmnInlrZDoioLngrnmj5Dkvpvop4bnqpflm5vovrnnmoTkvY3nva7kv6Hmga/ku6Xkvpvlr7npvZDvvIzlj6blpJbmj5DkvpvlsY/luZXpgILphY3nrZbnlaXmjqXlj6PvvIzmlrnkvr/ku47nvJbovpHlmajorr7nva7jgII8YnI+XG4gKiDms6jvvJrnlLHkuo7mnKzoioLngrnnmoTlsLrlr7jkvJrot5/pmo/lsY/luZXmi4nkvLjvvIzmiYDku6UgYW5jaG9yUG9pbnQg5Y+q5pSv5oyBICgwLjUsIDAuNSnvvIzlkKbliJnpgILphY3kuI3lkIzlsY/luZXml7blnZDmoIfkvJrmnInlgY/lt67jgIJcbiAqXG4gKiBAY2xhc3MgQ2FudmFzXG4gKiBAZXh0ZW5kcyBDb21wb25lbnRcbiAqL1xudmFyIENhbnZhcyA9IGNjLkNsYXNzKHtcbiAgICBuYW1lOiAnY2MuQ2FudmFzJyxcbiAgICBleHRlbmRzOiBDb21wb25lbnQsXG5cbiAgICBlZGl0b3I6IENDX0VESVRPUiAmJiB7XG4gICAgICAgIG1lbnU6ICdpMThuOk1BSU5fTUVOVS5jb21wb25lbnQudWkvQ2FudmFzJyxcbiAgICAgICAgaGVscDogJ2kxOG46Q09NUE9ORU5ULmhlbHBfdXJsLmNhbnZhcycsXG4gICAgICAgIGV4ZWN1dGVJbkVkaXRNb2RlOiB0cnVlLFxuICAgICAgICBkaXNhbGxvd011bHRpcGxlOiB0cnVlLFxuICAgIH0sXG5cbiAgICByZXNldEluRWRpdG9yOiBDQ19FRElUT1IgJiYgZnVuY3Rpb24gKCkge1xuICAgICAgICBfU2NlbmUuX2FwcGx5Q2FudmFzUHJlZmVyZW5jZXModGhpcyk7XG4gICAgICAgIHJlc2V0V2lkZ2V0Q29tcG9uZW50KHRoaXMpO1xuICAgIH0sXG5cbiAgICBzdGF0aWNzOiB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiAhI2VuIEN1cnJlbnQgYWN0aXZlIGNhbnZhcywgdGhlIHNjZW5lIHNob3VsZCBvbmx5IGhhdmUgb25lIGFjdGl2ZSBjYW52YXMgYXQgdGhlIHNhbWUgdGltZS5cbiAgICAgICAgICogISN6aCDlvZPliY3mv4DmtLvnmoTnlLvluIPnu4Tku7bvvIzlnLrmma/lkIzkuIDml7bpl7Tlj6rog73mnInkuIDkuKrmv4DmtLvnmoTnlLvluIPjgIJcbiAgICAgICAgICogQHByb3BlcnR5IHtDYW52YXN9IGluc3RhbmNlXG4gICAgICAgICAqIEBzdGF0aWNcbiAgICAgICAgICovXG4gICAgICAgIGluc3RhbmNlOiBudWxsXG4gICAgfSxcblxuICAgIHByb3BlcnRpZXM6IHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogISNlbiBUaGUgZGVzaWdpbiByZXNvbHV0aW9uIGZvciBjdXJyZW50IHNjZW5lLlxuICAgICAgICAgKiAhI3poIOW9k+WJjeWcuuaZr+iuvuiuoeWIhui+qOeOh+OAglxuICAgICAgICAgKiBAcHJvcGVydHkge1NpemV9IGRlc2lnblJlc29sdXRpb25cbiAgICAgICAgICogQGRlZmF1bHQgbmV3IGNjLlNpemUoOTYwLCA2NDApXG4gICAgICAgICAqL1xuICAgICAgICBfZGVzaWduUmVzb2x1dGlvbjogY2Muc2l6ZSg5NjAsIDY0MCksXG4gICAgICAgIGRlc2lnblJlc29sdXRpb246IHtcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYy5zaXplKHRoaXMuX2Rlc2lnblJlc29sdXRpb24pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fZGVzaWduUmVzb2x1dGlvbi53aWR0aCA9IHZhbHVlLndpZHRoO1xuICAgICAgICAgICAgICAgIHRoaXMuX2Rlc2lnblJlc29sdXRpb24uaGVpZ2h0ID0gdmFsdWUuaGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwbHlTZXR0aW5ncygpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvb2x0aXA6IENDX0RFViAmJiAnaTE4bjpDT01QT05FTlQuY2FudmFzLmRlc2lnbl9yZXNvbHV0aW9uJ1xuICAgICAgICB9LFxuXG4gICAgICAgIF9maXRXaWR0aDogZmFsc2UsXG4gICAgICAgIF9maXRIZWlnaHQ6IHRydWUsXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqICEjZW4gVE9ET1xuICAgICAgICAgKiAhI3poOiDmmK/lkKbkvJjlhYjlsIborr7orqHliIbovqjnjofpq5jluqbmkpHmu6Hop4blm77pq5jluqbjgIJcbiAgICAgICAgICogQHByb3BlcnR5IHtCb29sZWFufSBmaXRIZWlnaHRcbiAgICAgICAgICogQGRlZmF1bHQgZmFsc2VcbiAgICAgICAgICovXG4gICAgICAgIGZpdEhlaWdodDoge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpdEhlaWdodDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9maXRIZWlnaHQgIT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2ZpdEhlaWdodCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDogQ0NfREVWICYmICdpMThuOkNPTVBPTkVOVC5jYW52YXMuZml0X2hlaWdodCdcbiAgICAgICAgfSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogISNlbiBUT0RPXG4gICAgICAgICAqICEjemg6IOaYr+WQpuS8mOWFiOWwhuiuvuiuoeWIhui+qOeOh+WuveW6puaSkea7oeinhuWbvuWuveW6puOAglxuICAgICAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IGZpdFdpZHRoXG4gICAgICAgICAqIEBkZWZhdWx0IGZhbHNlXG4gICAgICAgICAqL1xuICAgICAgICBmaXRXaWR0aDoge1xuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpdFdpZHRoO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpdFdpZHRoICE9PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9maXRXaWR0aCA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdG9vbHRpcDogQ0NfREVWICYmICdpMThuOkNPTVBPTkVOVC5jYW52YXMuZml0X3dpZHRoJ1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIGZpdCBjYW52YXMgbm9kZSB0byBkZXNpZ24gcmVzb2x1dGlvblxuICAgIF9maXREZXNpZ25SZXNvbHV0aW9uOiBDQ19FRElUT1IgJiYgZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyBUT0RPOiBzdXBwb3J0IHBhZGRpbmdzIG9mIGxvY2tlZCB3aWRnZXRcbiAgICAgICAgdmFyIGRlc2lnblNpemUgPSBjYy5lbmdpbmUuZ2V0RGVzaWduUmVzb2x1dGlvblNpemUoKTtcbiAgICAgICAgdGhpcy5ub2RlLnNldFBvc2l0aW9uKGRlc2lnblNpemUud2lkdGggKiAwLjUsIGRlc2lnblNpemUuaGVpZ2h0ICogMC41KTtcbiAgICAgICAgdGhpcy5ub2RlLnNldENvbnRlbnRTaXplKGRlc2lnblNpemUpO1xuICAgIH0sXG5cbiAgICBfX3ByZWxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKENDX0RFVikge1xuICAgICAgICAgICAgdmFyIEZsYWdzID0gY2MuT2JqZWN0LkZsYWdzO1xuICAgICAgICAgICAgdGhpcy5fb2JqRmxhZ3MgfD0gKEZsYWdzLklzUG9zaXRpb25Mb2NrZWQgfCBGbGFncy5Jc0FuY2hvckxvY2tlZCB8IEZsYWdzLklzU2l6ZUxvY2tlZCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoQ2FudmFzLmluc3RhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gY2Mud2FybklEKDY3MDAsXG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLm5hbWUsIENhbnZhcy5pbnN0YW5jZS5ub2RlLm5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIENhbnZhcy5pbnN0YW5jZSA9IHRoaXM7XG5cbiAgICAgICAgLy8gQWxpZ24gbm9kZSB0byBmaXQgdGhlIHNjcmVlblxuICAgICAgICB0aGlzLmFwcGx5U2V0dGluZ3MoKTtcblxuICAgICAgICAvLyBTdHJldGNoIHRvIG1hdGNoZWQgc2l6ZSBkdXJpbmcgdGhlIHNjZW5lIGluaXRpYWxpemF0aW9uXG4gICAgICAgIGxldCB3aWRnZXQgPSB0aGlzLmdldENvbXBvbmVudChjYy5XaWRnZXQpO1xuICAgICAgICBpZiAod2lkZ2V0KSB7XG4gICAgICAgICAgICB3aWRnZXQudXBkYXRlQWxpZ25tZW50KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoQ0NfRURJVE9SKSB7XG4gICAgICAgICAgICB0aGlzLl9maXREZXNpZ25SZXNvbHV0aW9uKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb25zdGFudGx5IGFsaWduIGNhbnZhcyBub2RlIGluIGVkaXQgbW9kZVxuICAgICAgICBpZiAoQ0NfRURJVE9SKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vbihjYy5EaXJlY3Rvci5FVkVOVF9BRlRFUl9VUERBVEUsIHRoaXMuX2ZpdERlc2lnblJlc29sdXRpb24sIHRoaXMpO1xuICAgICAgICAgICAgY2MuZW5naW5lLm9uKCdkZXNpZ24tcmVzb2x1dGlvbi1jaGFuZ2VkJywgdGhpcy5fZml0RGVzaWduUmVzb2x1dGlvbiwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc3RhcnQgKCkge1xuICAgICAgICBpZiAoIUNhbWVyYS5tYWluICYmIGNjLmdhbWUucmVuZGVyVHlwZSAhPT0gY2MuZ2FtZS5SRU5ERVJfVFlQRV9DQU5WQVMpIHtcbiAgICAgICAgICAgIC8vIENyZWF0ZSBkZWZhdWx0IE1haW4gQ2FtZXJhXG4gICAgICAgICAgICBsZXQgY2FtZXJhTm9kZSA9IG5ldyBjYy5Ob2RlKCdNYWluIENhbWVyYScpO1xuICAgICAgICAgICAgY2FtZXJhTm9kZS5wYXJlbnQgPSB0aGlzLm5vZGU7XG4gICAgICAgICAgICBjYW1lcmFOb2RlLnNldFNpYmxpbmdJbmRleCgwKTtcblxuICAgICAgICAgICAgbGV0IGNhbWVyYSA9IGNhbWVyYU5vZGUuYWRkQ29tcG9uZW50KENhbWVyYSk7XG4gICAgICAgICAgICBsZXQgQ2xlYXJGbGFncyA9IENhbWVyYS5DbGVhckZsYWdzO1xuICAgICAgICAgICAgY2FtZXJhLmNsZWFyRmxhZ3MgPSBDbGVhckZsYWdzLkNPTE9SIHwgQ2xlYXJGbGFncy5ERVBUSCB8IENsZWFyRmxhZ3MuU1RFTkNJTDtcbiAgICAgICAgICAgIGNhbWVyYS5kZXB0aCA9IC0xO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIG9uRGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoQ0NfRURJVE9SKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfVVBEQVRFLCB0aGlzLl9maXREZXNpZ25SZXNvbHV0aW9uLCB0aGlzKTtcbiAgICAgICAgICAgIGNjLmVuZ2luZS5vZmYoJ2Rlc2lnbi1yZXNvbHV0aW9uLWNoYW5nZWQnLCB0aGlzLl9maXREZXNpZ25SZXNvbHV0aW9uLCB0aGlzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChDYW52YXMuaW5zdGFuY2UgPT09IHRoaXMpIHtcbiAgICAgICAgICAgIENhbnZhcy5pbnN0YW5jZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXBwbHlTZXR0aW5nczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgUmVzb2x1dGlvblBvbGljeSA9IGNjLlJlc29sdXRpb25Qb2xpY3k7XG4gICAgICAgIHZhciBwb2xpY3k7XG5cbiAgICAgICAgaWYgKHRoaXMuZml0SGVpZ2h0ICYmIHRoaXMuZml0V2lkdGgpIHtcbiAgICAgICAgICAgIHBvbGljeSA9IFJlc29sdXRpb25Qb2xpY3kuU0hPV19BTEw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIXRoaXMuZml0SGVpZ2h0ICYmICF0aGlzLmZpdFdpZHRoKSB7XG4gICAgICAgICAgICBwb2xpY3kgPSBSZXNvbHV0aW9uUG9saWN5Lk5PX0JPUkRFUjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLmZpdFdpZHRoKSB7XG4gICAgICAgICAgICBwb2xpY3kgPSBSZXNvbHV0aW9uUG9saWN5LkZJWEVEX1dJRFRIO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgeyAgICAgIC8vIGZpdEhlaWdodFxuICAgICAgICAgICAgcG9saWN5ID0gUmVzb2x1dGlvblBvbGljeS5GSVhFRF9IRUlHSFQ7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZGVzaWduUmVzID0gdGhpcy5fZGVzaWduUmVzb2x1dGlvbjtcbiAgICAgICAgaWYgKENDX0VESVRPUikge1xuICAgICAgICAgICAgY2MuZW5naW5lLnNldERlc2lnblJlc29sdXRpb25TaXplKGRlc2lnblJlcy53aWR0aCwgZGVzaWduUmVzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYy52aWV3LnNldERlc2lnblJlc29sdXRpb25TaXplKGRlc2lnblJlcy53aWR0aCwgZGVzaWduUmVzLmhlaWdodCwgcG9saWN5KTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5cbmNjLkNhbnZhcyA9IG1vZHVsZS5leHBvcnRzID0gQ2FudmFzO1xuIl0sInNvdXJjZVJvb3QiOiIvIn0=