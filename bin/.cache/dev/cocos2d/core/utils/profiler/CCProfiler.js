
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/utils/profiler/CCProfiler.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var macro = require('../../platform/CCMacro');

var PerfCounter = require('./perf-counter');

var _showFPS = false;
var _fontSize = 15;
var _stats = null;
var _rootNode = null;
var _label = null;

function generateStats() {
  if (_stats) return;
  _stats = {
    fps: {
      desc: 'Framerate (FPS)',
      below: 30,
      average: 500
    },
    draws: {
      desc: 'Draw Call'
    },
    frame: {
      desc: 'Frame time (ms)',
      min: 0,
      max: 50,
      average: 500
    },
    logic: {
      desc: 'Game Logic (ms)',
      min: 0,
      max: 50,
      average: 500,
      color: '#080'
    },
    render: {
      desc: 'Renderer (ms)',
      min: 0,
      max: 50,
      average: 500,
      color: '#f90'
    },
    mode: {
      desc: cc.game.renderType === cc.game.RENDER_TYPE_WEBGL ? 'WebGL' : 'Canvas',
      min: 1
    }
  };
  var now = performance.now();

  for (var id in _stats) {
    _stats[id]._counter = new PerfCounter(id, _stats[id], now);
  }
}

function generateNode() {
  if (_rootNode && _rootNode.isValid) return;
  _rootNode = new cc.Node('PROFILER-NODE');
  _rootNode.x = _rootNode.y = 10;
  _rootNode.groupIndex = cc.Node.BuiltinGroupIndex.DEBUG;

  cc.Camera._setupDebugCamera();

  _rootNode.zIndex = macro.MAX_ZINDEX;
  cc.game.addPersistRootNode(_rootNode);
  var left = new cc.Node('LEFT-PANEL');
  left.anchorX = left.anchorY = 0;
  var leftLabel = left.addComponent(cc.Label);
  leftLabel.fontSize = _fontSize;
  leftLabel.lineHeight = _fontSize;
  left.parent = _rootNode;
  var right = new cc.Node('RIGHT-PANEL');
  right.anchorX = 1;
  right.anchorY = 0;
  right.x = 200;
  var rightLabel = right.addComponent(cc.Label);
  rightLabel.horizontalAlign = cc.Label.HorizontalAlign.RIGHT;
  rightLabel.fontSize = _fontSize;
  rightLabel.lineHeight = _fontSize;
  right.parent = _rootNode;

  if (cc.sys.platform !== cc.sys.BAIDU_GAME_SUB && cc.sys.platform !== cc.sys.WECHAT_GAME_SUB) {
    leftLabel.cacheMode = cc.Label.CacheMode.CHAR;
    rightLabel.cacheMode = cc.Label.CacheMode.CHAR;
  }

  _label = {
    left: leftLabel,
    right: rightLabel
  };
}

function beforeUpdate() {
  generateNode();
  var now = cc.director._lastUpdate;

  _stats['frame']._counter.start(now);

  _stats['logic']._counter.start(now);
}

function afterUpdate() {
  var now = performance.now();

  if (cc.director.isPaused()) {
    _stats['frame']._counter.start(now);
  } else {
    _stats['logic']._counter.end(now);
  }

  _stats['render']._counter.start(now);
}

function updateLabel(stat) {
  var length = 20;
  var desc = stat.desc;
  var value = stat._counter.human() + '';
  stat.label.string = stat.desc + '  ' + stat._counter.human();
}

function afterDraw() {
  var now = performance.now();

  _stats['render']._counter.end(now);

  _stats['draws']._counter.value = cc.renderer.drawCalls;

  _stats['frame']._counter.end(now);

  _stats['fps']._counter.frame(now);

  var left = '';
  var right = '';

  for (var id in _stats) {
    var stat = _stats[id];

    stat._counter.sample(now);

    left += stat.desc + '\n';
    right += stat._counter.human() + '\n';
  }

  if (_label) {
    _label.left.string = left;
    _label.right.string = right;
  }
}

cc.profiler = module.exports = {
  isShowingStats: function isShowingStats() {
    return _showFPS;
  },
  hideStats: function hideStats() {
    if (_showFPS) {
      if (_rootNode) {
        _rootNode.active = false;
      }

      cc.director.off(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);
      cc.director.off(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);
      cc.director.off(cc.Director.EVENT_AFTER_DRAW, afterDraw);
      _showFPS = false;
    }
  },
  showStats: function showStats() {
    if (!_showFPS) {
      generateStats();

      if (_rootNode) {
        _rootNode.active = true;
      }

      cc.director.on(cc.Director.EVENT_BEFORE_UPDATE, beforeUpdate);
      cc.director.on(cc.Director.EVENT_AFTER_UPDATE, afterUpdate);
      cc.director.on(cc.Director.EVENT_AFTER_DRAW, afterDraw);
      _showFPS = true;
    }
  }
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3V0aWxzL3Byb2ZpbGVyL0NDUHJvZmlsZXIuanMiXSwibmFtZXMiOlsibWFjcm8iLCJyZXF1aXJlIiwiUGVyZkNvdW50ZXIiLCJfc2hvd0ZQUyIsIl9mb250U2l6ZSIsIl9zdGF0cyIsIl9yb290Tm9kZSIsIl9sYWJlbCIsImdlbmVyYXRlU3RhdHMiLCJmcHMiLCJkZXNjIiwiYmVsb3ciLCJhdmVyYWdlIiwiZHJhd3MiLCJmcmFtZSIsIm1pbiIsIm1heCIsImxvZ2ljIiwiY29sb3IiLCJyZW5kZXIiLCJtb2RlIiwiY2MiLCJnYW1lIiwicmVuZGVyVHlwZSIsIlJFTkRFUl9UWVBFX1dFQkdMIiwibm93IiwicGVyZm9ybWFuY2UiLCJpZCIsIl9jb3VudGVyIiwiZ2VuZXJhdGVOb2RlIiwiaXNWYWxpZCIsIk5vZGUiLCJ4IiwieSIsImdyb3VwSW5kZXgiLCJCdWlsdGluR3JvdXBJbmRleCIsIkRFQlVHIiwiQ2FtZXJhIiwiX3NldHVwRGVidWdDYW1lcmEiLCJ6SW5kZXgiLCJNQVhfWklOREVYIiwiYWRkUGVyc2lzdFJvb3ROb2RlIiwibGVmdCIsImFuY2hvclgiLCJhbmNob3JZIiwibGVmdExhYmVsIiwiYWRkQ29tcG9uZW50IiwiTGFiZWwiLCJmb250U2l6ZSIsImxpbmVIZWlnaHQiLCJwYXJlbnQiLCJyaWdodCIsInJpZ2h0TGFiZWwiLCJob3Jpem9udGFsQWxpZ24iLCJIb3Jpem9udGFsQWxpZ24iLCJSSUdIVCIsInN5cyIsInBsYXRmb3JtIiwiQkFJRFVfR0FNRV9TVUIiLCJXRUNIQVRfR0FNRV9TVUIiLCJjYWNoZU1vZGUiLCJDYWNoZU1vZGUiLCJDSEFSIiwiYmVmb3JlVXBkYXRlIiwiZGlyZWN0b3IiLCJfbGFzdFVwZGF0ZSIsInN0YXJ0IiwiYWZ0ZXJVcGRhdGUiLCJpc1BhdXNlZCIsImVuZCIsInVwZGF0ZUxhYmVsIiwic3RhdCIsImxlbmd0aCIsInZhbHVlIiwiaHVtYW4iLCJsYWJlbCIsInN0cmluZyIsImFmdGVyRHJhdyIsInJlbmRlcmVyIiwiZHJhd0NhbGxzIiwic2FtcGxlIiwicHJvZmlsZXIiLCJtb2R1bGUiLCJleHBvcnRzIiwiaXNTaG93aW5nU3RhdHMiLCJoaWRlU3RhdHMiLCJhY3RpdmUiLCJvZmYiLCJEaXJlY3RvciIsIkVWRU5UX0JFRk9SRV9VUERBVEUiLCJFVkVOVF9BRlRFUl9VUERBVEUiLCJFVkVOVF9BRlRFUl9EUkFXIiwic2hvd1N0YXRzIiwib24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQUlBLEtBQUssR0FBR0MsT0FBTyxDQUFDLHdCQUFELENBQW5COztBQUVBLElBQU1DLFdBQVcsR0FBR0QsT0FBTyxDQUFDLGdCQUFELENBQTNCOztBQUVBLElBQUlFLFFBQVEsR0FBRyxLQUFmO0FBQ0EsSUFBSUMsU0FBUyxHQUFHLEVBQWhCO0FBRUEsSUFBSUMsTUFBTSxHQUFHLElBQWI7QUFDQSxJQUFJQyxTQUFTLEdBQUcsSUFBaEI7QUFDQSxJQUFJQyxNQUFNLEdBQUcsSUFBYjs7QUFFQSxTQUFTQyxhQUFULEdBQTBCO0FBQ3RCLE1BQUlILE1BQUosRUFBWTtBQUVaQSxFQUFBQSxNQUFNLEdBQUc7QUFDTEksSUFBQUEsR0FBRyxFQUFFO0FBQUVDLE1BQUFBLElBQUksRUFBRSxpQkFBUjtBQUEyQkMsTUFBQUEsS0FBSyxFQUFFLEVBQWxDO0FBQXNDQyxNQUFBQSxPQUFPLEVBQUU7QUFBL0MsS0FEQTtBQUVMQyxJQUFBQSxLQUFLLEVBQUU7QUFBRUgsTUFBQUEsSUFBSSxFQUFFO0FBQVIsS0FGRjtBQUdMSSxJQUFBQSxLQUFLLEVBQUU7QUFBRUosTUFBQUEsSUFBSSxFQUFFLGlCQUFSO0FBQTJCSyxNQUFBQSxHQUFHLEVBQUUsQ0FBaEM7QUFBbUND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QUFFLENBQUMyQyxRQUFILENBQVl1QixHQUFaLENBQWdCbEUsRUFBRSxDQUFDbUUsUUFBSCxDQUFZRSxrQkFBNUIsRUFBZ0R2QixXQUFoRDtBQUNBOUMsTUFBQUEsRUFBRSxDQUFDMkMsUUFBSCxDQUFZdUIsR0FBWixDQUFnQmxFLEVBQUUsQ0FBQ21FLFFBQUgsQ0FBWUcsZ0JBQTVCLEVBQThDZCxTQUE5QztBQUNBMUUsTUFBQUEsUUFBUSxHQUFHLEtBQVg7QUFDSDtBQUNKLEdBaEIwQjtBQWtCM0J5RixFQUFBQSxTQWxCMkIsdUJBa0JkO0FBQ1QsUUFBSSxDQUFDekYsUUFBTCxFQUFlO0FBQ1hLLE1BQUFBLGFBQWE7O0FBRWIsVUFBSUYsU0FBSixFQUFlO0FBQ1hBLFFBQUFBLFNBQVMsQ0FBQ2dGLE1BQVYsR0FBbUIsSUFBbkI7QUFDSDs7QUFFRGpFLE1BQUFBLEVBQUUsQ0FBQzJDLFFBQUgsQ0FBWTZCLEVBQVosQ0FBZXhFLEVBQUUsQ0FBQ21FLFFBQUgsQ0FBWUMsbUJBQTNCLEVBQWdEMUIsWUFBaEQ7QUFDQTFDLE1BQUFBLEVBQUUsQ0FBQzJDLFFBQUgsQ0FBWTZCLEVBQVosQ0FBZXhFLEVBQUUsQ0FBQ21FLFFBQUgsQ0FBWUUsa0JBQTNCLEVBQStDdkIsV0FBL0M7QUFDQTlDLE1BQUFBLEVBQUUsQ0FBQzJDLFFBQUgsQ0FBWTZCLEVBQVosQ0FBZXhFLEVBQUUsQ0FBQ21FLFFBQUgsQ0FBWUcsZ0JBQTNCLEVBQTZDZCxTQUE3QztBQUNBMUUsTUFBQUEsUUFBUSxHQUFHLElBQVg7QUFDSDtBQUNKO0FBL0IwQixDQUEvQiIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gQ29weXJpZ2h0IChjKSAyMDEzLTIwMTYgQ2h1a29uZyBUZWNobm9sb2dpZXMgSW5jLlxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cHM6Ly93d3cuY29jb3MuY29tL1xuXG4gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZW5naW5lIHNvdXJjZSBjb2RlICh0aGUgXCJTb2Z0d2FyZVwiKSwgYSBsaW1pdGVkLFxuICB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcbiAgbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuICB1c2VkIGZvciBkZXZlbG9waW5nIGdhbWVzLiBZb3UgYXJlIG5vdCBncmFudGVkIHRvIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsXG4gIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxuXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxuXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiBUSEUgU09GVFdBUkUuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxudmFyIG1hY3JvID0gcmVxdWlyZSgnLi4vLi4vcGxhdGZvcm0vQ0NNYWNybycpO1xuXG5jb25zdCBQZXJmQ291bnRlciA9IHJlcXVpcmUoJy4vcGVyZi1jb3VudGVyJyk7XG5cbmxldCBfc2hvd0ZQUyA9IGZhbHNlO1xubGV0IF9mb250U2l6ZSA9IDE1O1xuXG5sZXQgX3N0YXRzID0gbnVsbDtcbmxldCBfcm9vdE5vZGUgPSBudWxsO1xubGV0IF9sYWJlbCA9IG51bGw7XG5cbmZ1bmN0aW9uIGdlbmVyYXRlU3RhdHMgKCkge1xuICAgIGlmIChfc3RhdHMpIHJldHVybjtcbiAgICBcbiAgICBfc3RhdHMgPSB7XG4gICAgICAgIGZwczogeyBkZXNjOiAnRnJhbWVyYXRlIChGUFMpJywgYmVsb3c6IDMwLCBhdmVyYWdlOiA1MDAgfSxcbiAgICAgICAgZHJhd3M6IHsgZGVzYzogJ0RyYXcgQ2FsbCcgfSxcbiAgICAgICAgZnJhbWU6IHsgZGVzYzogJ0ZyYW1lIHRpbWUgKG1zKScsIG1pbjogMCwgbWF4OiA1MCwgYXZlcmFnZTogNTAwIH0sXG4gICAgICAgIGxvZ2ljOiB7IGRlc2M6ICdHYW1lIExvZ2ljIChtcyknLCBtaW46IDAsIG1heDogNTAsIGF2ZXJhZ2U6IDUwMCwgY29sb3I6ICcjMDgwJyB9LFxuICAgICAgICByZW5kZXI6IHsgZGVzYzogJ1JlbmRlcmVyIChtcyknLCBtaW46IDAsIG1heDogNTAsIGF2ZXJhZ2U6IDUwMCwgY29sb3I6ICcjZjkwJyB9LFxuICAgICAgICBtb2RlOiB7IGRlc2M6IGNjLmdhbWUucmVuZGVyVHlwZSA9PT0gY2MuZ2FtZS5SRU5ERVJfVFlQRV9XRUJHTCA/ICdXZWJHTCcgOiAnQ2FudmFzJywgbWluOiAxIH1cbiAgICB9O1xuXG4gICAgbGV0IG5vdyA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGZvciAobGV0IGlkIGluIF9zdGF0cykge1xuICAgICAgICBfc3RhdHNbaWRdLl9jb3VudGVyID0gbmV3IFBlcmZDb3VudGVyKGlkLCBfc3RhdHNbaWRdLCBub3cpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVOb2RlICgpIHtcbiAgICBpZiAoX3Jvb3ROb2RlICYmIF9yb290Tm9kZS5pc1ZhbGlkKSByZXR1cm47XG5cblxuICAgIF9yb290Tm9kZSA9IG5ldyBjYy5Ob2RlKCdQUk9GSUxFUi1OT0RFJyk7XG4gICAgX3Jvb3ROb2RlLnggPSBfcm9vdE5vZGUueSA9IDEwO1xuXG4gICAgX3Jvb3ROb2RlLmdyb3VwSW5kZXggPSBjYy5Ob2RlLkJ1aWx0aW5Hcm91cEluZGV4LkRFQlVHO1xuICAgIGNjLkNhbWVyYS5fc2V0dXBEZWJ1Z0NhbWVyYSgpO1xuXG4gICAgX3Jvb3ROb2RlLnpJbmRleCA9IG1hY3JvLk1BWF9aSU5ERVg7XG4gICAgY2MuZ2FtZS5hZGRQZXJzaXN0Um9vdE5vZGUoX3Jvb3ROb2RlKTtcblxuICAgIGxldCBsZWZ0ID0gbmV3IGNjLk5vZGUoJ0xFRlQtUEFORUwnKTtcbiAgICBsZWZ0LmFuY2hvclggPSBsZWZ0LmFuY2hvclkgPSAwO1xuICAgIGxldCBsZWZ0TGFiZWwgPSBsZWZ0LmFkZENvbXBvbmVudChjYy5MYWJlbCk7XG4gICAgbGVmdExhYmVsLmZvbnRTaXplID0gX2ZvbnRTaXplO1xuICAgIGxlZnRMYWJlbC5saW5lSGVpZ2h0ID0gX2ZvbnRTaXplO1xuICAgIGxlZnQucGFyZW50ID0gX3Jvb3ROb2RlO1xuXG4gICAgbGV0IHJpZ2h0ID0gbmV3IGNjLk5vZGUoJ1JJR0hULVBBTkVMJyk7XG4gICAgcmlnaHQuYW5jaG9yWCA9IDE7XG4gICAgcmlnaHQuYW5jaG9yWSA9IDA7XG4gICAgcmlnaHQueCA9IDIwMDtcbiAgICBsZXQgcmlnaHRMYWJlbCA9IHJpZ2h0LmFkZENvbXBvbmVudChjYy5MYWJlbCk7XG4gICAgcmlnaHRMYWJlbC5ob3Jpem9udGFsQWxpZ24gPSBjYy5MYWJlbC5Ib3Jpem9udGFsQWxpZ24uUklHSFQ7XG4gICAgcmlnaHRMYWJlbC5mb250U2l6ZSA9IF9mb250U2l6ZTtcbiAgICByaWdodExhYmVsLmxpbmVIZWlnaHQgPSBfZm9udFNpemU7XG4gICAgcmlnaHQucGFyZW50ID0gX3Jvb3ROb2RlO1xuICAgIGlmIChjYy5zeXMucGxhdGZvcm0gIT09IGNjLnN5cy5CQUlEVV9HQU1FX1NVQiAmJlxuICAgICAgICBjYy5zeXMucGxhdGZvcm0gIT09IGNjLnN5cy5XRUNIQVRfR0FNRV9TVUIpIHtcbiAgICAgICAgbGVmdExhYmVsLmNhY2hlTW9kZSA9IGNjLkxhYmVsLkNhY2hlTW9kZS5DSEFSO1xuICAgICAgICByaWdodExhYmVsLmNhY2hlTW9kZSA9IGNjLkxhYmVsLkNhY2hlTW9kZS5DSEFSO1xuICAgIH1cblxuICAgIF9sYWJlbCA9IHtcbiAgICAgICAgbGVmdDogbGVmdExhYmVsLFxuICAgICAgICByaWdodDogcmlnaHRMYWJlbFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGJlZm9yZVVwZGF0ZSAoKSB7XG4gICAgZ2VuZXJhdGVOb2RlKCk7XG5cbiAgICBsZXQgbm93ID0gY2MuZGlyZWN0b3IuX2xhc3RVcGRhdGU7XG4gICAgX3N0YXRzWydmcmFtZSddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XG4gICAgX3N0YXRzWydsb2dpYyddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XG59XG5cbmZ1bmN0aW9uIGFmdGVyVXBkYXRlICgpIHtcbiAgICBsZXQgbm93ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgaWYgKGNjLmRpcmVjdG9yLmlzUGF1c2VkKCkpIHtcbiAgICAgICAgX3N0YXRzWydmcmFtZSddLl9jb3VudGVyLnN0YXJ0KG5vdyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBfc3RhdHNbJ2xvZ2ljJ10uX2NvdW50ZXIuZW5kKG5vdyk7XG4gICAgfVxuICAgIF9zdGF0c1sncmVuZGVyJ10uX2NvdW50ZXIuc3RhcnQobm93KTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlTGFiZWwgKHN0YXQpIHtcbiAgICBsZXQgbGVuZ3RoID0gMjA7XG4gICAgbGV0IGRlc2MgPSBzdGF0LmRlc2M7XG4gICAgbGV0IHZhbHVlID0gc3RhdC5fY291bnRlci5odW1hbigpICsgJyc7XG4gICAgc3RhdC5sYWJlbC5zdHJpbmcgPSBzdGF0LmRlc2MgKyAnICAnICsgc3RhdC5fY291bnRlci5odW1hbigpO1xufVxuXG5mdW5jdGlvbiBhZnRlckRyYXcgKCkge1xuICAgIGxldCBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBfc3RhdHNbJ3JlbmRlciddLl9jb3VudGVyLmVuZChub3cpO1xuICAgIF9zdGF0c1snZHJhd3MnXS5fY291bnRlci52YWx1ZSA9IGNjLnJlbmRlcmVyLmRyYXdDYWxscztcbiAgICBfc3RhdHNbJ2ZyYW1lJ10uX2NvdW50ZXIuZW5kKG5vdyk7XG4gICAgX3N0YXRzWydmcHMnXS5fY291bnRlci5mcmFtZShub3cpO1xuICAgIFxuICAgIGxldCBsZWZ0ID0gJyc7XG4gICAgbGV0IHJpZ2h0ID0gJyc7XG4gICAgZm9yIChsZXQgaWQgaW4gX3N0YXRzKSB7XG4gICAgICAgIGxldCBzdGF0ID0gX3N0YXRzW2lkXTtcbiAgICAgICAgc3RhdC5fY291bnRlci5zYW1wbGUobm93KTtcblxuICAgICAgICBsZWZ0ICs9IHN0YXQuZGVzYyArICdcXG4nO1xuICAgICAgICByaWdodCArPSBzdGF0Ll9jb3VudGVyLmh1bWFuKCkgKyAnXFxuJztcbiAgICB9XG5cbiAgICBpZiAoX2xhYmVsKSB7XG4gICAgICAgIF9sYWJlbC5sZWZ0LnN0cmluZyA9IGxlZnQ7XG4gICAgICAgIF9sYWJlbC5yaWdodC5zdHJpbmcgPSByaWdodDtcbiAgICB9XG59XG5cbmNjLnByb2ZpbGVyID0gbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgaXNTaG93aW5nU3RhdHMgKCkge1xuICAgICAgICByZXR1cm4gX3Nob3dGUFM7XG4gICAgfSxcblxuICAgIGhpZGVTdGF0cyAoKSB7XG4gICAgICAgIGlmIChfc2hvd0ZQUykge1xuICAgICAgICAgICAgaWYgKF9yb290Tm9kZSkge1xuICAgICAgICAgICAgICAgIF9yb290Tm9kZS5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2MuZGlyZWN0b3Iub2ZmKGNjLkRpcmVjdG9yLkVWRU5UX0JFRk9SRV9VUERBVEUsIGJlZm9yZVVwZGF0ZSk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfVVBEQVRFLCBhZnRlclVwZGF0ZSk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vZmYoY2MuRGlyZWN0b3IuRVZFTlRfQUZURVJfRFJBVywgYWZ0ZXJEcmF3KTtcbiAgICAgICAgICAgIF9zaG93RlBTID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgc2hvd1N0YXRzICgpIHtcbiAgICAgICAgaWYgKCFfc2hvd0ZQUykge1xuICAgICAgICAgICAgZ2VuZXJhdGVTdGF0cygpO1xuXG4gICAgICAgICAgICBpZiAoX3Jvb3ROb2RlKSB7XG4gICAgICAgICAgICAgICAgX3Jvb3ROb2RlLmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLm9uKGNjLkRpcmVjdG9yLkVWRU5UX0JFRk9SRV9VUERBVEUsIGJlZm9yZVVwZGF0ZSk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5vbihjYy5EaXJlY3Rvci5FVkVOVF9BRlRFUl9VUERBVEUsIGFmdGVyVXBkYXRlKTtcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLm9uKGNjLkRpcmVjdG9yLkVWRU5UX0FGVEVSX0RSQVcsIGFmdGVyRHJhdyk7XG4gICAgICAgICAgICBfc2hvd0ZQUyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==