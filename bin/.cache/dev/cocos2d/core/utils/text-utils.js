
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/utils/text-utils.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _js = _interopRequireDefault(require("../platform/js"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
// Draw text the textBaseline ratio (Can adjust the appropriate baseline ratio based on the platform)
var _BASELINE_RATIO = 0.26;
var _BASELINE_OFFSET = 0;

if (CC_RUNTIME) {
  _BASELINE_OFFSET = _BASELINE_RATIO * 2 / 3;
}

var MAX_CACHE_SIZE = 100;
var pool = new _js["default"].Pool(2);

pool.get = function () {
  var node = this._get() || {
    key: null,
    value: null,
    prev: null,
    next: null
  };
  return node;
};

function LRUCache(size) {
  this.count = 0;
  this.limit = size;
  this.datas = {};
  this.head = null;
  this.tail = null;
}

LRUCache.prototype.moveToHead = function (node) {
  node.next = this.head;
  node.prev = null;
  if (this.head !== null) this.head.prev = node;
  this.head = node;
  if (this.tail === null) this.tail = node;
  this.count++;
  this.datas[node.key] = node;
};

LRUCache.prototype.put = function (key, value) {
  var node = pool.get();
  node.key = key;
  node.value = value;

  if (this.count >= this.limit) {
    var discard = this.tail;
    delete this.datas[discard.key];
    this.count--;
    this.tail = discard.prev;
    this.tail.next = null;
    discard.prev = null;
    discard.next = null;
    pool.put(discard);
  }

  this.moveToHead(node);
};

LRUCache.prototype.remove = function (node) {
  if (node.prev !== null) {
    node.prev.next = node.next;
  } else {
    this.head = node.next;
  }

  if (node.next !== null) {
    node.next.prev = node.prev;
  } else {
    this.tail = node.prev;
  }

  delete this.datas[node.key];
  this.count--;
};

LRUCache.prototype.get = function (key) {
  var node = this.datas[key];

  if (node) {
    this.remove(node);
    this.moveToHead(node);
    return node.value;
  }

  return null;
};

LRUCache.prototype.clear = function () {
  this.count = 0;
  this.datas = {};
  this.head = null;
  this.tail = null;
};

LRUCache.prototype.has = function (key) {
  return !!this.datas[key];
};

LRUCache.prototype["delete"] = function (key) {
  var node = this.datas[key];
  this.remove(node);
};

var measureCache = new LRUCache(MAX_CACHE_SIZE);
var textUtils = {
  BASELINE_RATIO: _BASELINE_RATIO,
  MIDDLE_RATIO: (_BASELINE_RATIO + 1) / 2 - _BASELINE_RATIO,
  BASELINE_OFFSET: _BASELINE_OFFSET,
  label_wordRex: /([a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°-ÑÐ-Ð¯ÐÑ‘]+|\S)/,
  label_symbolRex: /^[!,.:;'}\]%\?>ã€â€˜â€œã€‹ï¼Ÿã€‚ï¼Œï¼]/,
  label_lastWordRex: /([a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]+|\S)$/,
  label_lastEnglish: /[a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]+$/,
  label_firstEnglish: /^[a-zA-Z0-9Ã„Ã–ÃœÃ¤Ã¶Ã¼ÃŸÃ©Ã¨Ã§Ã Ã¹ÃªÃ¢Ã®Ã´Ã»Ð°Ã­Ã¬ÃÃŒÃ¯ÃÃ€Ã¡Ã Ã‰ÃˆÃ’Ã“Ã²Ã³ÅÅ‘Ã™ÃšÅ°ÃºÅ±Ã±Ã‘Ã¦Ã†Å“Å’ÃƒÃ‚Ã£Ã”ÃµÄ›Å¡ÄÅ™Å¾Ã½Ã¡Ã­Ã©Ã³ÃºÅ¯Å¥ÄÅˆÄšÅ ÄŒÅ˜Å½ÃÃÃ‰Ã“ÃšÅ¤Å¼ÅºÅ›Ã³Å„Å‚Ä™Ä‡Ä…Å»Å¹ÅšÃ“ÅƒÅÄ˜Ä†Ä„-ÑÐ-Ð¯ÐÑ‘]/,
  // The unicode standard will never assign a character from code point 0xD800 to 0xDFFF
  // high surrogate (0xD800-0xDBFF) and low surrogate(0xDC00-0xDFFF) combines to a character on the Supplementary Multilingual Plane
  // reference: https://en.wikipedia.org/wiki/UTF-16
  highSurrogateRex: /[\uD800-\uDBFF]/,
  lowSurrogateRex: /[\uDC00-\uDFFF]/,
  label_wrapinspection: true,
  __CHINESE_REG: /^[\u4E00-\u9FFF\u3400-\u4DFF]+$/,
  __JAPANESE_REG: /[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g,
  __KOREAN_REG: /^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/,
  isUnicodeCJK: function isUnicodeCJK(ch) {
    return this.__CHINESE_REG.test(ch) || this.__JAPANESE_REG.test(ch) || this.__KOREAN_REG.test(ch);
  },
  //Checking whether the character is a whitespace
  isUnicodeSpace: function isUnicodeSpace(ch) {
    ch = ch.charCodeAt(0);
    return ch >= 9 && ch <= 13 || ch === 32 || ch === 133 || ch === 160 || ch === 5760 || ch >= 8192 && ch <= 8202 || ch === 8232 || ch === 8233 || ch === 8239 || ch === 8287 || ch === 12288;
  },
  safeMeasureText: function safeMeasureText(ctx, string, desc) {
    var font = desc || ctx.font;
    var key = font + "\uD83C\uDFAE" + string;
    var cache = measureCache.get(key);

    if (cache !== null) {
      return cache;
    }

    var metric = ctx.measureText(string);
    var width = metric && metric.width || 0;
    measureCache.put(key, width);
    return width;
  },
  // in case truncate a character on the Supplementary Multilingual Plane
  // test case: a = 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 1) === 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 0, 1) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 2) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 3) === 'ðŸ˜‰'
  // _safeSubstring(a, 0, 4) === 'ðŸ˜‰ðŸš—'
  // _safeSubstring(a, 1, 2) === _safeSubstring(a, 1, 3) === 'ðŸ˜‰'
  // _safeSubstring(a, 2, 3) === _safeSubstring(a, 2, 4) === 'ðŸš—'
  _safeSubstring: function _safeSubstring(targetString, startIndex, endIndex) {
    var newStartIndex = startIndex,
        newEndIndex = endIndex;
    var startChar = targetString[startIndex];

    if (this.lowSurrogateRex.test(startChar)) {
      newStartIndex--;
    }

    if (endIndex !== undefined) {
      if (endIndex - 1 !== startIndex) {
        var endChar = targetString[endIndex - 1];

        if (this.highSurrogateRex.test(endChar)) {
          newEndIndex--;
        }
      } else if (this.highSurrogateRex.test(startChar)) {
        newEndIndex++;
      }
    }

    return targetString.substring(newStartIndex, newEndIndex);
  },
  fragmentText: function fragmentText(stringToken, allWidth, maxWidth, measureText) {
    //check the first character
    var wrappedWords = []; //fast return if strArr is empty

    if (stringToken.length === 0 || maxWidth < 0) {
      wrappedWords.push('');
      return wrappedWords;
    }

    var text = stringToken;

    while (allWidth > maxWidth && text.length > 1) {
      var fuzzyLen = text.length * (maxWidth / allWidth) | 0;

      var tmpText = this._safeSubstring(text, fuzzyLen);

      var width = allWidth - measureText(tmpText);
      var sLine = tmpText;
      var pushNum = 0;
      var checkWhile = 0;
      var checkCount = 10; //Exceeded the size

      while (width > maxWidth && checkWhile++ < checkCount) {
        fuzzyLen *= maxWidth / width;
        fuzzyLen = fuzzyLen | 0;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      checkWhile = 0; //Find the truncation point

      while (width <= maxWidth && checkWhile++ < checkCount) {
        if (tmpText) {
          var exec = this.label_wordRex.exec(tmpText);
          pushNum = exec ? exec[0].length : 1;
          sLine = tmpText;
        }

        fuzzyLen = fuzzyLen + pushNum;
        tmpText = this._safeSubstring(text, fuzzyLen);
        width = allWidth - measureText(tmpText);
      }

      fuzzyLen -= pushNum; // in case maxWidth cannot contain any characters, need at least one character per line

      if (fuzzyLen === 0) {
        fuzzyLen = 1;
        sLine = this._safeSubstring(text, 1);
      } else if (fuzzyLen === 1 && this.highSurrogateRex.test(text[0])) {
        fuzzyLen = 2;
        sLine = this._safeSubstring(text, 2);
      }

      var sText = this._safeSubstring(text, 0, fuzzyLen),
          result; //symbol in the first


      if (this.label_wrapinspection) {
        if (this.label_symbolRex.test(sLine || tmpText)) {
          result = this.label_lastWordRex.exec(sText);
          fuzzyLen -= result ? result[0].length : 0;
          if (fuzzyLen === 0) fuzzyLen = 1;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } //To judge whether a English words are truncated


      if (this.label_firstEnglish.test(sLine)) {
        result = this.label_lastEnglish.exec(sText);

        if (result && sText !== result[0]) {
          fuzzyLen -= result[0].length;
          sLine = this._safeSubstring(text, fuzzyLen);
          sText = this._safeSubstring(text, 0, fuzzyLen);
        }
      } // The first line And do not wrap should not remove the space


      if (wrappedWords.length === 0) {
        wrappedWords.push(sText);
      } else {
        sText = sText.trimLeft();

        if (sText.length > 0) {
          wrappedWords.push(sText);
        }
      }

      text = sLine || tmpText;
      allWidth = measureText(text);
    }

    if (wrappedWords.length === 0) {
      wrappedWords.push(text);
    } else {
      text = text.trimLeft();

      if (text.length > 0) {
        wrappedWords.push(text);
      }
    }

    return wrappedWords;
  }
};
cc.textUtils = module.exports = textUtils;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3V0aWxzL3RleHQtdXRpbHMuanMiXSwibmFtZXMiOlsiX0JBU0VMSU5FX1JBVElPIiwiX0JBU0VMSU5FX09GRlNFVCIsIkNDX1JVTlRJTUUiLCJNQVhfQ0FDSEVfU0laRSIsInBvb2wiLCJqcyIsIlBvb2wiLCJnZXQiLCJub2RlIiwiX2dldCIsImtleSIsInZhbHVlIiwicHJldiIsIm5leHQiLCJMUlVDYWNoZSIsInNpemUiLCJjb3VudCIsImxpbWl0IiwiZGF0YXMiLCJoZWFkIiwidGFpbCIsInByb3RvdHlwZSIsIm1vdmVUb0hlYWQiLCJwdXQiLCJkaXNjYXJkIiwicmVtb3ZlIiwiY2xlYXIiLCJoYXMiLCJtZWFzdXJlQ2FjaGUiLCJ0ZXh0VXRpbHMiLCJCQVNFTElORV9SQVRJTyIsIk1JRERMRV9SQVRJTyIsIkJBU0VMSU5FX09GRlNFVCIsImxhYmVsX3dvcmRSZXgiLCJsYWJlbF9zeW1ib2xSZXgiLCJsYWJlbF9sYXN0V29yZFJleCIsImxhYmVsX2xhc3RFbmdsaXNoIiwibGFiZWxfZmlyc3RFbmdsaXNoIiwiaGlnaFN1cnJvZ2F0ZVJleCIsImxvd1N1cnJvZ2F0ZVJleCIsImxhYmVsX3dyYXBpbnNwZWN0aW9uIiwiX19DSElORVNFX1JFRyIsIl9fSkFQQU5FU0VfUkVHIiwiX19LT1JFQU5fUkVHIiwiaXNVbmljb2RlQ0pLIiwiY2giLCJ0ZXN0IiwiaXNVbmljb2RlU3BhY2UiLCJjaGFyQ29kZUF0Iiwic2FmZU1lYXN1cmVUZXh0IiwiY3R4Iiwic3RyaW5nIiwiZGVzYyIsImZvbnQiLCJjYWNoZSIsIm1ldHJpYyIsIm1lYXN1cmVUZXh0Iiwid2lkdGgiLCJfc2FmZVN1YnN0cmluZyIsInRhcmdldFN0cmluZyIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsIm5ld1N0YXJ0SW5kZXgiLCJuZXdFbmRJbmRleCIsInN0YXJ0Q2hhciIsInVuZGVmaW5lZCIsImVuZENoYXIiLCJzdWJzdHJpbmciLCJmcmFnbWVudFRleHQiLCJzdHJpbmdUb2tlbiIsImFsbFdpZHRoIiwibWF4V2lkdGgiLCJ3cmFwcGVkV29yZHMiLCJsZW5ndGgiLCJwdXNoIiwidGV4dCIsImZ1enp5TGVuIiwidG1wVGV4dCIsInNMaW5lIiwicHVzaE51bSIsImNoZWNrV2hpbGUiLCJjaGVja0NvdW50IiwiZXhlYyIsInNUZXh0IiwicmVzdWx0IiwidHJpbUxlZnQiLCJjYyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUEwQkE7Ozs7QUExQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBLElBQUlBLGVBQWUsR0FBRyxJQUF0QjtBQUNBLElBQUlDLGdCQUFnQixHQUFHLENBQXZCOztBQUNBLElBQUlDLFVBQUosRUFBZ0I7QUFDWkQsRUFBQUEsZ0JBQWdCLEdBQUdELGVBQWUsR0FBRyxDQUFsQixHQUFzQixDQUF6QztBQUNIOztBQUVELElBQU1HLGNBQWMsR0FBRyxHQUF2QjtBQUVBLElBQUlDLElBQUksR0FBRyxJQUFJQyxlQUFHQyxJQUFQLENBQVksQ0FBWixDQUFYOztBQUNBRixJQUFJLENBQUNHLEdBQUwsR0FBVyxZQUFZO0FBQ25CLE1BQUlDLElBQUksR0FBRyxLQUFLQyxJQUFMLE1BQWU7QUFDdEJDLElBQUFBLEdBQUcsRUFBRSxJQURpQjtBQUV0QkMsSUFBQUEsS0FBSyxFQUFFLElBRmU7QUFHdEJDLElBQUFBLElBQUksRUFBRSxJQUhnQjtBQUl0QkMsSUFBQUEsSUFBSSxFQUFFO0FBSmdCLEdBQTFCO0FBT0EsU0FBT0wsSUFBUDtBQUNILENBVEQ7O0FBV0EsU0FBU00sUUFBVCxDQUFrQkMsSUFBbEIsRUFBd0I7QUFDcEIsT0FBS0MsS0FBTCxHQUFhLENBQWI7QUFDQSxPQUFLQyxLQUFMLEdBQWFGLElBQWI7QUFDQSxP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b0JpQixJQUFwQixFQUEwQixDQUExQixFQUE2QkMsUUFBN0IsQ0FBUjtBQUNIO0FBQ0osT0FuRTBDLENBcUUzQzs7O0FBQ0EsVUFBSUosWUFBWSxDQUFDQyxNQUFiLEtBQXdCLENBQTVCLEVBQStCO0FBQzNCRCxRQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JTLEtBQWxCO0FBQ0gsT0FGRCxNQUdLO0FBQ0RBLFFBQUFBLEtBQUssR0FBR0EsS0FBSyxDQUFDRSxRQUFOLEVBQVI7O0FBQ0EsWUFBSUYsS0FBSyxDQUFDVixNQUFOLEdBQWUsQ0FBbkIsRUFBc0I7QUFDbEJELFVBQUFBLFlBQVksQ0FBQ0UsSUFBYixDQUFrQlMsS0FBbEI7QUFDSDtBQUNKOztBQUNEUixNQUFBQSxJQUFJLEdBQUdHLEtBQUssSUFBSUQsT0FBaEI7QUFDQVAsTUFBQUEsUUFBUSxHQUFHZCxXQUFXLENBQUNtQixJQUFELENBQXRCO0FBQ0g7O0FBRUQsUUFBSUgsWUFBWSxDQUFDQyxNQUFiLEtBQXdCLENBQTVCLEVBQStCO0FBQzNCRCxNQUFBQSxZQUFZLENBQUNFLElBQWIsQ0FBa0JDLElBQWxCO0FBQ0gsS0FGRCxNQUdLO0FBQ0RBLE1BQUFBLElBQUksR0FBR0EsSUFBSSxDQUFDVSxRQUFMLEVBQVA7O0FBQ0EsVUFBSVYsSUFBSSxDQUFDRixNQUFMLEdBQWMsQ0FBbEIsRUFBcUI7QUFDakJELFFBQUFBLFlBQVksQ0FBQ0UsSUFBYixDQUFrQkMsSUFBbEI7QUFDSDtBQUNKOztBQUNELFdBQU9ILFlBQVA7QUFDSDtBQW5MVyxDQUFoQjtBQXNMQWMsRUFBRSxDQUFDekQsU0FBSCxHQUFlMEQsTUFBTSxDQUFDQyxPQUFQLEdBQWlCM0QsU0FBaEMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuIENvcHlyaWdodCAoYykgMjAxMy0yMDE2IENodWtvbmcgVGVjaG5vbG9naWVzIEluYy5cbiBDb3B5cmlnaHQgKGMpIDIwMTctMjAxOCBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cblxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cblxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcbiB3b3JsZHdpZGUsIHJveWFsdHktZnJlZSwgbm9uLWFzc2lnbmFibGUsIHJldm9jYWJsZSBhbmQgbm9uLWV4Y2x1c2l2ZSBsaWNlbnNlXG4gdG8gdXNlIENvY29zIENyZWF0b3Igc29sZWx5IHRvIGRldmVsb3AgZ2FtZXMgb24geW91ciB0YXJnZXQgcGxhdGZvcm1zLiBZb3Ugc2hhbGxcbiBub3QgdXNlIENvY29zIENyZWF0b3Igc29mdHdhcmUgZm9yIGRldmVsb3Bpbmcgb3RoZXIgc29mdHdhcmUgb3IgdG9vbHMgdGhhdCdzXG4gdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxuIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiBDb2NvcyBDcmVhdG9yLlxuXG4gVGhlIHNvZnR3YXJlIG9yIHRvb2xzIGluIHRoaXMgTGljZW5zZSBBZ3JlZW1lbnQgYXJlIGxpY2Vuc2VkLCBub3Qgc29sZC5cbiBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC4gcmVzZXJ2ZXMgYWxsIHJpZ2h0cyBub3QgZXhwcmVzc2x5IGdyYW50ZWQgdG8geW91LlxuXG4gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbiBUSEUgU09GVFdBUkUuXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuaW1wb3J0IGpzIGZyb20gJy4uL3BsYXRmb3JtL2pzJ1xuXG4vLyBEcmF3IHRleHQgdGhlIHRleHRCYXNlbGluZSByYXRpbyAoQ2FuIGFkanVzdCB0aGUgYXBwcm9wcmlhdGUgYmFzZWxpbmUgcmF0aW8gYmFzZWQgb24gdGhlIHBsYXRmb3JtKVxubGV0IF9CQVNFTElORV9SQVRJTyA9IDAuMjY7XG5sZXQgX0JBU0VMSU5FX09GRlNFVCA9IDA7XG5pZiAoQ0NfUlVOVElNRSkge1xuICAgIF9CQVNFTElORV9PRkZTRVQgPSBfQkFTRUxJTkVfUkFUSU8gKiAyIC8gMztcbn1cblxuY29uc3QgTUFYX0NBQ0hFX1NJWkUgPSAxMDA7XG5cbmxldCBwb29sID0gbmV3IGpzLlBvb2woMik7XG5wb29sLmdldCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm9kZSA9IHRoaXMuX2dldCgpIHx8IHtcbiAgICAgICAga2V5OiBudWxsLFxuICAgICAgICB2YWx1ZTogbnVsbCxcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbFxuICAgIH07XG5cbiAgICByZXR1cm4gbm9kZTtcbn07XG5cbmZ1bmN0aW9uIExSVUNhY2hlKHNpemUpIHtcbiAgICB0aGlzLmNvdW50ID0gMDtcbiAgICB0aGlzLmxpbWl0ID0gc2l6ZTtcbiAgICB0aGlzLmRhdGFzID0ge307XG4gICAgdGhpcy5oZWFkID0gbnVsbDtcbiAgICB0aGlzLnRhaWwgPSBudWxsO1xufVxuXG5MUlVDYWNoZS5wcm90b3R5cGUubW92ZVRvSGVhZCA9IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgbm9kZS5uZXh0ID0gdGhpcy5oZWFkO1xuICAgIG5vZGUucHJldiA9IG51bGw7XG4gICAgaWYgKHRoaXMuaGVhZCAhPT0gbnVsbCkgXG4gICAgICAgIHRoaXMuaGVhZC5wcmV2ID0gbm9kZTtcbiAgICB0aGlzLmhlYWQgPSBub2RlO1xuICAgIGlmICh0aGlzLnRhaWwgPT09IG51bGwpIFxuICAgICAgICB0aGlzLnRhaWwgPSBub2RlO1xuICAgIHRoaXMuY291bnQrKztcbiAgICB0aGlzLmRhdGFzW25vZGUua2V5XSA9IG5vZGU7XG59XG5cbkxSVUNhY2hlLnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIGNvbnN0IG5vZGUgPSBwb29sLmdldCgpO1xuICAgIG5vZGUua2V5ID0ga2V5O1xuICAgIG5vZGUudmFsdWUgPSB2YWx1ZTtcbiAgICBcbiAgICBpZiAodGhpcy5jb3VudCA+PSB0aGlzLmxpbWl0KSB7XG4gICAgICAgIGxldCBkaXNjYXJkID0gdGhpcy50YWlsO1xuICAgICAgICBkZWxldGUgdGhpcy5kYXRhc1tkaXNjYXJkLmtleV07XG4gICAgICAgIHRoaXMuY291bnQtLTtcbiAgICAgICAgdGhpcy50YWlsID0gZGlzY2FyZC5wcmV2O1xuICAgICAgICB0aGlzLnRhaWwubmV4dCA9IG51bGw7XG4gICAgICAgIGRpc2NhcmQucHJldiA9IG51bGw7XG4gICAgICAgIGRpc2NhcmQubmV4dCA9IG51bGw7XG4gICAgICAgIHBvb2wucHV0KGRpc2NhcmQpO1xuICAgIH1cbiAgICB0aGlzLm1vdmVUb0hlYWQobm9kZSk7XG59XG5cbkxSVUNhY2hlLnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAobm9kZSkge1xuICAgIGlmIChub2RlLnByZXYgIT09IG51bGwpIHtcbiAgICAgICAgbm9kZS5wcmV2Lm5leHQgPSBub2RlLm5leHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5oZWFkID0gbm9kZS5uZXh0O1xuICAgIH1cbiAgICBpZiAobm9kZS5uZXh0ICE9PSBudWxsKSB7XG4gICAgICAgIG5vZGUubmV4dC5wcmV2ID0gbm9kZS5wcmV2O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudGFpbCA9IG5vZGUucHJldjtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuZGF0YXNbbm9kZS5rZXldO1xuICAgIHRoaXMuY291bnQtLTtcbn1cblxuTFJVQ2FjaGUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICBjb25zdCBub2RlID0gdGhpcy5kYXRhc1trZXldO1xuICAgIGlmIChub2RlKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlKG5vZGUpO1xuICAgICAgICB0aGlzLm1vdmVUb0hlYWQobm9kZSk7XG4gICAgICAgIHJldHVybiBub2RlLnZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuTFJVQ2FjaGUucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY291bnQgPSAwO1xuICAgIHRoaXMuZGF0YXMgPSB7fTtcbiAgICB0aGlzLmhlYWQgPSBudWxsO1xuICAgIHRoaXMudGFpbCA9IG51bGw7XG59XG5cbkxSVUNhY2hlLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgcmV0dXJuICEhdGhpcy5kYXRhc1trZXldO1xufVxuXG5MUlVDYWNoZS5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24gKGtleSkge1xuICAgIGNvbnN0IG5vZGUgPSB0aGlzLmRhdGFzW2tleV07XG4gICAgdGhpcy5yZW1vdmUobm9kZSk7XG59XG5cbmxldCBtZWFzdXJlQ2FjaGUgPSBuZXcgTFJVQ2FjaGUoTUFYX0NBQ0hFX1NJWkUpO1xuXG52YXIgdGV4dFV0aWxzID0ge1xuXG4gICAgQkFTRUxJTkVfUkFUSU86IF9CQVNFTElORV9SQVRJTyxcbiAgICBNSURETEVfUkFUSU86IChfQkFTRUxJTkVfUkFUSU8gKyAxKSAvIDIgLSBfQkFTRUxJTkVfUkFUSU8sXG4gICAgQkFTRUxJTkVfT0ZGU0VUOiBfQkFTRUxJTkVfT0ZGU0VULFxuXG4gICAgbGFiZWxfd29yZFJleCA6IC8oW2EtekEtWjAtOcOEw5bDnMOkw7bDvMOfw6nDqMOnw6DDucOqw6LDrsO0w7vQsC3Rj9CQLdCv0IHRkV0rfFxcUykvLFxuICAgIGxhYmVsX3N5bWJvbFJleCA6IC9eWyEsLjo7J31cXF0lXFw/PuOAgeKAmOKAnOOAi++8n+OAgu+8jO+8gV0vLFxuICAgIGxhYmVsX2xhc3RXb3JkUmV4IDogLyhbYS16QS1aMC05w4TDlsOcw6TDtsO8w5/DqcOow6fDoMO5w6rDosOuw7TDu9Cww63DrMONw4zDr8OBw4DDocOgw4nDiMOSw5PDssOzxZDFkcOZw5rFsMO6xbHDscORw6bDhsWTxZLDg8OCw6PDlMO1xJvFocSNxZnFvsO9w6HDrcOpw7PDusWvxaXEj8WIxJrFoMSMxZjFvcOBw43DicOTw5rFpMW8xbrFm8OzxYTFgsSZxIfEhcW7xbnFmsOTxYPFgcSYxIbEhC3Rj9CQLdCv0IHRkV0rfFxcUykkLyxcbiAgICBsYWJlbF9sYXN0RW5nbGlzaCA6IC9bYS16QS1aMC05w4TDlsOcw6TDtsO8w5/DqcOow6fDoMO5w6rDosOuw7TDu9Cww63DrMONw4zDr8OBw4DDocOgw4nDiMOSw5PDssOzxZDFkcOZw5rFsMO6xbHDscORw6bDhsWTxZLDg8OCw6PDlMO1xJvFocSNxZnFvsO9w6HDrcOpw7PDusWvxaXEj8WIxJrFoMSMxZjFvcOBw43DicOTw5rFpMW8xbrFm8OzxYTFgsSZxIfEhcW7xbnFmsOTxYPFgcSYxIbEhC3Rj9CQLdCv0IHRkV0rJC8sXG4gICAgbGFiZWxfZmlyc3RFbmdsaXNoIDogL15bYS16QS1aMC05w4TDlsOcw6TDtsO8w5/DqcOow6fDoMO5w6rDosOuw7TDu9Cww63DrMONw4zDr8OBw4DDocOgw4nDiMOSw5PDssOzxZDFkcOZw5rFsMO6xbHDscORw6bDhsWTxZLDg8OCw6PDlMO1xJvFocSNxZnFvsO9w6HDrcOpw7PDusWvxaXEj8WIxJrFoMSMxZjFvcOBw43DicOTw5rFpMW8xbrFm8OzxYTFgsSZxIfEhcW7xbnFmsOTxYPFgcSYxIbEhC3Rj9CQLdCv0IHRkV0vLFxuICAgIC8vIFRoZSB1bmljb2RlIHN0YW5kYXJkIHdpbGwgbmV2ZXIgYXNzaWduIGEgY2hhcmFjdGVyIGZyb20gY29kZSBwb2ludCAweEQ4MDAgdG8gMHhERkZGXG4gICAgLy8gaGlnaCBzdXJyb2dhdGUgKDB4RDgwMC0weERCRkYpIGFuZCBsb3cgc3Vycm9nYXRlKDB4REMwMC0weERGRkYpIGNvbWJpbmVzIHRvIGEgY2hhcmFjdGVyIG9uIHRoZSBTdXBwbGVtZW50YXJ5IE11bHRpbGluZ3VhbCBQbGFuZVxuICAgIC8vIHJlZmVyZW5jZTogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVVRGLTE2XG4gICAgaGlnaFN1cnJvZ2F0ZVJleDogL1tcXHVEODAwLVxcdURCRkZdLyxcbiAgICBsb3dTdXJyb2dhdGVSZXg6IC9bXFx1REMwMC1cXHVERkZGXS8sXG4gICAgbGFiZWxfd3JhcGluc3BlY3Rpb24gOiB0cnVlLFxuXG4gICAgX19DSElORVNFX1JFRzogL15bXFx1NEUwMC1cXHU5RkZGXFx1MzQwMC1cXHU0REZGXSskLyxcbiAgICBfX0pBUEFORVNFX1JFRzogL1tcXHUzMDAwLVxcdTMwM0ZdfFtcXHUzMDQwLVxcdTMwOUZdfFtcXHUzMEEwLVxcdTMwRkZdfFtcXHVGRjAwLVxcdUZGRUZdfFtcXHU0RTAwLVxcdTlGQUZdfFtcXHUyNjA1LVxcdTI2MDZdfFtcXHUyMTkwLVxcdTIxOTVdfFxcdTIwM0IvZyxcbiAgICBfX0tPUkVBTl9SRUc6IC9eW1xcdTExMDAtXFx1MTFGRl18W1xcdTMxMzAtXFx1MzE4Rl18W1xcdUE5NjAtXFx1QTk3Rl18W1xcdUFDMDAtXFx1RDdBRl18W1xcdUQ3QjAtXFx1RDdGRl0rJC8sXG5cbiAgICBpc1VuaWNvZGVDSks6IGZ1bmN0aW9uKGNoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9fQ0hJTkVTRV9SRUcudGVzdChjaCkgfHwgdGhpcy5fX0pBUEFORVNFX1JFRy50ZXN0KGNoKSB8fCB0aGlzLl9fS09SRUFOX1JFRy50ZXN0KGNoKTtcbiAgICB9LFxuXG4gICAgLy9DaGVja2luZyB3aGV0aGVyIHRoZSBjaGFyYWN0ZXIgaXMgYSB3aGl0ZXNwYWNlXG4gICAgaXNVbmljb2RlU3BhY2U6IGZ1bmN0aW9uKGNoKSB7XG4gICAgICAgIGNoID0gY2guY2hhckNvZGVBdCgwKTtcbiAgICAgICAgcmV0dXJuICgoY2ggPj0gOSAmJiBjaCA8PSAxMykgfHwgY2ggPT09IDMyIHx8IGNoID09PSAxMzMgfHwgY2ggPT09IDE2MCB8fCBjaCA9PT0gNTc2MCB8fCAoY2ggPj0gODE5MiAmJiBjaCA8PSA4MjAyKSB8fCBjaCA9PT0gODIzMiB8fCBjaCA9PT0gODIzMyB8fCBjaCA9PT0gODIzOSB8fCBjaCA9PT0gODI4NyB8fCBjaCA9PT0gMTIyODgpO1xuICAgIH0sXG5cbiAgICBzYWZlTWVhc3VyZVRleHQ6IGZ1bmN0aW9uIChjdHgsIHN0cmluZywgZGVzYykge1xuICAgICAgICBsZXQgZm9udCA9IGRlc2MgfHwgY3R4LmZvbnQ7XG4gICAgICAgIGxldCBrZXkgPSBmb250ICsgXCJcXHVEODNDXFx1REZBRVwiICsgc3RyaW5nO1xuICAgICAgICBsZXQgY2FjaGUgPSBtZWFzdXJlQ2FjaGUuZ2V0KGtleSk7XG4gICAgICAgIGlmIChjYWNoZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1ldHJpYyA9IGN0eC5tZWFzdXJlVGV4dChzdHJpbmcpO1xuICAgICAgICBsZXQgd2lkdGggPSBtZXRyaWMgJiYgbWV0cmljLndpZHRoIHx8IDA7XG4gICAgICAgIG1lYXN1cmVDYWNoZS5wdXQoa2V5LCB3aWR0aCk7XG5cbiAgICAgICAgcmV0dXJuIHdpZHRoO1xuICAgIH0sXG5cbiAgICAvLyBpbiBjYXNlIHRydW5jYXRlIGEgY2hhcmFjdGVyIG9uIHRoZSBTdXBwbGVtZW50YXJ5IE11bHRpbGluZ3VhbCBQbGFuZVxuICAgIC8vIHRlc3QgY2FzZTogYSA9ICfwn5iJ8J+alydcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAxKSA9PT0gJ/CfmInwn5qXJ1xuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDAsIDEpID09PSAn8J+YiSdcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAwLCAyKSA9PT0gJ/CfmIknXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMCwgMykgPT09ICfwn5iJJ1xuICAgIC8vIF9zYWZlU3Vic3RyaW5nKGEsIDAsIDQpID09PSAn8J+YifCfmpcnXG4gICAgLy8gX3NhZmVTdWJzdHJpbmcoYSwgMSwgMikgPT09IF9zYWZlU3Vic3RyaW5nKGEsIDEsIDMpID09PSAn8J+YiSdcbiAgICAvLyBfc2FmZVN1YnN0cmluZyhhLCAyLCAzKSA9PT0gX3NhZmVTdWJzdHJpbmcoYSwgMiwgNCkgPT09ICfwn5qXJ1xuICAgIF9zYWZlU3Vic3RyaW5nICh0YXJnZXRTdHJpbmcsIHN0YXJ0SW5kZXgsIGVuZEluZGV4KSB7XG4gICAgICAgIGxldCBuZXdTdGFydEluZGV4ID0gc3RhcnRJbmRleCwgbmV3RW5kSW5kZXggPSBlbmRJbmRleDtcbiAgICAgICAgbGV0IHN0YXJ0Q2hhciA9IHRhcmdldFN0cmluZ1tzdGFydEluZGV4XTtcbiAgICAgICAgaWYgKHRoaXMubG93U3Vycm9nYXRlUmV4LnRlc3Qoc3RhcnRDaGFyKSkge1xuICAgICAgICAgICAgbmV3U3RhcnRJbmRleC0tO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbmRJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggLSAxICE9PSBzdGFydEluZGV4KSB7XG4gICAgICAgICAgICAgICAgbGV0IGVuZENoYXIgPSB0YXJnZXRTdHJpbmdbZW5kSW5kZXggLSAxXTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5oaWdoU3Vycm9nYXRlUmV4LnRlc3QoZW5kQ2hhcikpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RW5kSW5kZXgtLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmhpZ2hTdXJyb2dhdGVSZXgudGVzdChzdGFydENoYXIpKSB7XG4gICAgICAgICAgICAgICAgbmV3RW5kSW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGFyZ2V0U3RyaW5nLnN1YnN0cmluZyhuZXdTdGFydEluZGV4LCBuZXdFbmRJbmRleCk7XG4gICAgfSxcblxuICAgIGZyYWdtZW50VGV4dDogZnVuY3Rpb24gKHN0cmluZ1Rva2VuLCBhbGxXaWR0aCwgbWF4V2lkdGgsIG1lYXN1cmVUZXh0KSB7XG4gICAgICAgIC8vY2hlY2sgdGhlIGZpcnN0IGNoYXJhY3RlclxuICAgICAgICB2YXIgd3JhcHBlZFdvcmRzID0gW107XG4gICAgICAgIC8vZmFzdCByZXR1cm4gaWYgc3RyQXJyIGlzIGVtcHR5XG4gICAgICAgIGlmKHN0cmluZ1Rva2VuLmxlbmd0aCA9PT0gMCB8fCBtYXhXaWR0aCA8IDApIHtcbiAgICAgICAgICAgIHdyYXBwZWRXb3Jkcy5wdXNoKCcnKTtcbiAgICAgICAgICAgIHJldHVybiB3cmFwcGVkV29yZHM7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgdGV4dCA9IHN0cmluZ1Rva2VuO1xuICAgICAgICB3aGlsZSAoYWxsV2lkdGggPiBtYXhXaWR0aCAmJiB0ZXh0Lmxlbmd0aCA+IDEpIHtcblxuICAgICAgICAgICAgdmFyIGZ1enp5TGVuID0gdGV4dC5sZW5ndGggKiAoIG1heFdpZHRoIC8gYWxsV2lkdGggKSB8IDA7XG4gICAgICAgICAgICB2YXIgdG1wVGV4dCA9IHRoaXMuX3NhZmVTdWJzdHJpbmcodGV4dCwgZnV6enlMZW4pO1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gYWxsV2lkdGggLSBtZWFzdXJlVGV4dCh0bXBUZXh0KTtcbiAgICAgICAgICAgIHZhciBzTGluZSA9IHRtcFRleHQ7XG4gICAgICAgICAgICB2YXIgcHVzaE51bSA9IDA7XG5cbiAgICAgICAgICAgIHZhciBjaGVja1doaWxlID0gMDtcbiAgICAgICAgICAgIHZhciBjaGVja0NvdW50ID0gMTA7XG5cbiAgICAgICAgICAgIC8vRXhjZWVkZWQgdGhlIHNpemVcbiAgICAgICAgICAgIHdoaWxlICh3aWR0aCA+IG1heFdpZHRoICYmIGNoZWNrV2hpbGUrKyA8IGNoZWNrQ291bnQpIHtcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiAqPSBtYXhXaWR0aCAvIHdpZHRoO1xuICAgICAgICAgICAgICAgIGZ1enp5TGVuID0gZnV6enlMZW4gfCAwO1xuICAgICAgICAgICAgICAgIHRtcFRleHQgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIGZ1enp5TGVuKTtcbiAgICAgICAgICAgICAgICB3aWR0aCA9IGFsbFdpZHRoIC0gbWVhc3VyZVRleHQodG1wVGV4dCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNoZWNrV2hpbGUgPSAwO1xuXG4gICAgICAgICAgICAvL0ZpbmQgdGhlIHRydW5jYXRpb24gcG9pbnRcbiAgICAgICAgICAgIHdoaWxlICh3aWR0aCA8PSBtYXhXaWR0aCAmJiBjaGVja1doaWxlKysgPCBjaGVja0NvdW50KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRtcFRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4ZWMgPSB0aGlzLmxhYmVsX3dvcmRSZXguZXhlYyh0bXBUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgcHVzaE51bSA9IGV4ZWMgPyBleGVjWzBdLmxlbmd0aCA6IDE7XG4gICAgICAgICAgICAgICAgICAgIHNMaW5lID0gdG1wVGV4dDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmdXp6eUxlbiA9IGZ1enp5TGVuICsgcHVzaE51bTtcbiAgICAgICAgICAgICAgICB0bXBUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgd2lkdGggPSBhbGxXaWR0aCAtIG1lYXN1cmVUZXh0KHRtcFRleHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdXp6eUxlbiAtPSBwdXNoTnVtO1xuICAgICAgICAgICAgLy8gaW4gY2FzZSBtYXhXaWR0aCBjYW5ub3QgY29udGFpbiBhbnkgY2hhcmFjdGVycywgbmVlZCBhdCBsZWFzdCBvbmUgY2hhcmFjdGVyIHBlciBsaW5lXG4gICAgICAgICAgICBpZiAoZnV6enlMZW4gPT09IDApIHtcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiA9IDE7XG4gICAgICAgICAgICAgICAgc0xpbmUgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZnV6enlMZW4gPT09IDEgJiYgdGhpcy5oaWdoU3Vycm9nYXRlUmV4LnRlc3QodGV4dFswXSkpIHtcbiAgICAgICAgICAgICAgICBmdXp6eUxlbiA9IDI7XG4gICAgICAgICAgICAgICAgc0xpbmUgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIDIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgc1RleHQgPSB0aGlzLl9zYWZlU3Vic3RyaW5nKHRleHQsIDAsIGZ1enp5TGVuKSwgcmVzdWx0O1xuXG4gICAgICAgICAgICAvL3N5bWJvbCBpbiB0aGUgZmlyc3RcbiAgICAgICAgICAgIGlmICh0aGlzLmxhYmVsX3dyYXBpbnNwZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGFiZWxfc3ltYm9sUmV4LnRlc3Qoc0xpbmUgfHwgdG1wVGV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5sYWJlbF9sYXN0V29yZFJleC5leGVjKHNUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgZnV6enlMZW4gLT0gcmVzdWx0ID8gcmVzdWx0WzBdLmxlbmd0aCA6IDA7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmdXp6eUxlbiA9PT0gMCkgZnV6enlMZW4gPSAxO1xuXG4gICAgICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgICAgIHNUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAwLCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvL1RvIGp1ZGdlIHdoZXRoZXIgYSBFbmdsaXNoIHdvcmRzIGFyZSB0cnVuY2F0ZWRcbiAgICAgICAgICAgIGlmICh0aGlzLmxhYmVsX2ZpcnN0RW5nbGlzaC50ZXN0KHNMaW5lKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMubGFiZWxfbGFzdEVuZ2xpc2guZXhlYyhzVGV4dCk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiBzVGV4dCAhPT0gcmVzdWx0WzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIGZ1enp5TGVuIC09IHJlc3VsdFswXS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIHNMaW5lID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgICAgIHNUZXh0ID0gdGhpcy5fc2FmZVN1YnN0cmluZyh0ZXh0LCAwLCBmdXp6eUxlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGUgZmlyc3QgbGluZSBBbmQgZG8gbm90IHdyYXAgc2hvdWxkIG5vdCByZW1vdmUgdGhlIHNwYWNlXG4gICAgICAgICAgICBpZiAod3JhcHBlZFdvcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHdyYXBwZWRXb3Jkcy5wdXNoKHNUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNUZXh0ID0gc1RleHQudHJpbUxlZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAoc1RleHQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaChzVGV4dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGV4dCA9IHNMaW5lIHx8IHRtcFRleHQ7XG4gICAgICAgICAgICBhbGxXaWR0aCA9IG1lYXN1cmVUZXh0KHRleHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHdyYXBwZWRXb3Jkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHdyYXBwZWRXb3Jkcy5wdXNoKHRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQudHJpbUxlZnQoKTtcbiAgICAgICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB3cmFwcGVkV29yZHMucHVzaCh0ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd3JhcHBlZFdvcmRzO1xuICAgIH0sXG59O1xuXG5jYy50ZXh0VXRpbHMgPSBtb2R1bGUuZXhwb3J0cyA9IHRleHRVdGlscztcbiJdLCJzb3VyY2VSb290IjoiLyJ9