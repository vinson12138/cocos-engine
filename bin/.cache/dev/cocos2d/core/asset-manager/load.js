
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/asset-manager/load.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var packManager = require('./pack-manager');

var Pipeline = require('./pipeline');

var parser = require('./parser');

var _require = require('./utilities'),
    getDepends = _require.getDepends,
    cache = _require.cache,
    gatherAsset = _require.gatherAsset,
    setProperties = _require.setProperties,
    forEach = _require.forEach,
    clear = _require.clear,
    checkCircleReference = _require.checkCircleReference;

var _require2 = require('./shared'),
    assets = _require2.assets,
    files = _require2.files,
    parsed = _require2.parsed,
    pipeline = _require2.pipeline;

var Task = require('./task');

function load(task, done) {
  var firstTask = false;

  if (!task.progress) {
    task.progress = {
      finish: 0,
      total: task.input.length,
      canInvoke: true
    };
    firstTask = true;
  }

  var options = task.options,
      progress = task.progress;
  options.__exclude__ = options.__exclude__ || Object.create(null);
  task.output = [];
  forEach(task.input, function (item, cb) {
    var subTask = Task.create({
      input: item,
      onProgress: task.onProgress,
      options: options,
      progress: progress,
      onComplete: function onComplete(err, item) {
        if (err && !task.isFinish) {
          if (!cc.assetManager.force || firstTask) {
            if (!CC_EDITOR) {
              cc.error(err.message, err.stack);
            }

            progress.canInvoke = false;
            done(err);
          } else {
            progress.canInvoke && task.dispatch('progress', ++progress.finish, progress.total, item);
          }
        }

        task.output.push(item);
        subTask.recycle();
        cb();
      }
    });
    loadOneAssetPipeline.async(subTask);
  }, function () {
    options.__exclude__ = null;

    if (task.isFinish) {
      clear(task, true);
      return task.dispatch('error');
    }

    gatherAsset(task);
    clear(task, true);
    done();
  });
}

var loadOneAssetPipeline = new Pipeline('loadOneAsset', [function fetch(task, done) {
  var item = task.output = task.input;
  var options = item.options,
      isNative = item.isNative,
      uuid = item.uuid,
      file = item.file;
  var reload = options.reload;
  if (file || !reload && !isNative && assets.has(uuid)) return done();
  packManager.load(item, task.options, function (err, data) {
    item.file = data;
    done(err);
  });
}, function parse(task, done) {
  var item = task.output = task.input,
      progress = task.progress,
      exclude = task.options.__exclude__;
  var id = item.id,
      file = item.file,
      options = item.options;

  if (item.isNative) {
    parser.parse(id, file, item.ext, options, function (err, asset) {
      if (err) return done(err);
      item.content = asset;
      progress.canInvoke && task.dispatch('progress', ++progress.finish, progress.total, item);
      files.remove(id);
      parsed.remove(id);
      done();
    });
  } else {
    var uuid = item.uuid;

    if (uuid in exclude) {
      var _exclude$uuid = exclude[uuid],
          finish = _exclude$uuid.finish,
          content = _exclude$uuid.content,
          err = _exclude$uuid.err,
          callbacks = _exclude$uuid.callbacks;
      progress.canInvoke && task.dispatch('progress', ++progress.finish, progress.total, item);

      if (finish || checkCircleReference(uuid, uuid, exclude)) {
        content && content.addRef && content.addRef();
        item.content = content;
        done(err);
      } else {
        callbacks.push({
          done: done,
          item: item
        });
      }
    } else {
      if (!options.reload && assets.has(uuid)) {
        var asset = assets.get(uuid);

        if (options.__asyncLoadAssets__ || !asset.__asyncLoadAssets__) {
          item.content = asset.addRef();
          progress.canInvoke && task.dispatch('progress', ++progress.finish, progress.total, item);
          done();
        } else {
          loadDepends(task, asset, done, false);
        }
      } else {
        parser.parse(id, file, 'import', options, function (err, asset) {
          if (err) return done(err);
          asset._uuid = uuid;
          loadDepends(task, asset, done, true);
        });
      }
    }
  }
}]);

function loadDepends(task, asset, done, init) {
  var item = task.input,
      progress = task.progress;
  var uuid = item.uuid,
      id = item.id,
      options = item.options,
      config = item.config;
  var __asyncLoadAssets__ = options.__asyncLoadAssets__,
      cacheAsset = options.cacheAsset;
  var depends = []; // add reference avoid being released during loading dependencies

  asset.addRef && asset.addRef();
  getDepends(uuid, asset, Object.create(null), depends, false, __asyncLoadAssets__, config);
  progress.canInvoke && task.dispatch('progress', ++progress.finish, progress.total += depends.length, item);
  var repeatItem = task.options.__exclude__[uuid] = {
    content: asset,
    finish: false,
    callbacks: [{
      done: done,
      item: item
    }]
  };
  var subTask = Task.create({
    input: depends,
    options: task.options,
    onProgress: task.onProgress,
    onError: Task.prototype.recycle,
    progress: progress,
    onComplete: function onComplete(err) {
      asset.decRef && asset.decRef(false);
      asset.__asyncLoadAssets__ = __asyncLoadAssets__;
      repeatItem.finish = true;
      repeatItem.err = err;

      if (!err) {
        var assets = Array.isArray(subTask.output) ? subTask.output : [subTask.output];
        var map = Object.create(null);

        for (var _i = 0, _l = assets.length; _i < _l; _i++) {
          var dependAsset = assets[_i];
          dependAsset && (map[dependAsset instanceof cc.Asset ? dependAsset._uuid + '@import' : uuid + '@native'] = dependAsset);
        }

        if (!init) {
          if (asset.__nativeDepend__ && !asset._nativeAsset) {
            var missingAsset = setProperties(uuid, asset, map);

            if (!missingAsset && !asset.__onLoadInvoked__) {
              try {
                asset.onLoad && asset.onLoad();
                asset.__onLoadInvoked__ = true;
              } catch (e) {
                cc.error(e.message, e.stack);
              }
            }
          }
        } else {
          var missingAsset = setProperties(uuid, asset, map);

          if (!missingAsset && !asset.__onLoadInvoked__) {
            try {
              asset.onLoad && asset.onLoad();
              asset.__onLoadInvoked__ = true;
            } catch (e) {
              cc.error(e.message, e.stack);
            }
          }

          files.remove(id);
          parsed.remove(id);
          cache(uuid, asset, cacheAsset !== undefined ? cacheAsset : cc.assetManager.cacheAsset);
        }

        subTask.recycle();
      }

      var callbacks = repeatItem.callbacks;

      for (var i = 0, l = callbacks.length; i < l; i++) {
        var cb = callbacks[i];
        asset.addRef && asset.addRef();
        cb.item.content = asset;
        cb.done(err);
      }

      callbacks.length = 0;
    }
  });
  pipeline.async(subTask);
}

module.exports = load;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL2Fzc2V0LW1hbmFnZXIvbG9hZC5qcyJdLCJuYW1lcyI6WyJwYWNrTWFuYWdlciIsInJlcXVpcmUiLCJQaXBlbGluZSIsInBhcnNlciIsImdldERlcGVuZHMiLCJjYWNoZSIsImdhdGhlckFzc2V0Iiwic2V0UHJvcGVydGllcyIsImZvckVhY2giLCJjbGVhciIsImNoZWNrQ2lyY2xlUmVmZXJlbmNlIiwiYXNzZXRzIiwiZmlsZXMiLCJwYXJzZWQiLCJwaXBlbGluZSIsIlRhc2siLCJsb2FkIiwidGFzayIsImRvbmUiLCJmaXJzdFRhc2siLCJwcm9ncmVzcyIsImZpbmlzaCIsInRvdGFsIiwiaW5wdXQiLCJsZW5ndGgiLCJjYW5JbnZva2UiLCJvcHRpb25zIiwiX19leGNsdWRlX18iLCJPYmplY3QiLCJjcmVhdGUiLCJvdXRwdXQiLCJpdGVtIiwiY2IiLCJzdWJUYXNrIiwib25Qcm9ncmVzcyIsIm9uQ29tcGxldGUiLCJlcnIiLCJpc0ZpbmlzaCIsImNjIiwiYXNzZXRNYW5hZ2VyIiwiZm9yY2UiLCJDQ19FRElUT1IiLCJlcnJvciIsIm1lc3NhZ2UiLCJzdGFjayIsImRpc3BhdGNoIiwicHVzaCIsInJlY3ljbGUiLCJsb2FkT25lQXNzZXRQaXBlbGluZSIsImFzeW5jIiwiZmV0Y2giLCJpc05hdGl2ZSIsInV1aWQiLCJmaWxlIiwicmVsb2FkIiwiaGFzIiwiZGF0YSIsInBhcnNlIiwiZXhjbHVkZSIsImlkIiwiZXh0IiwiYXNzZXQiLCJjb250ZW50IiwicmVtb3ZlIiwiY2FsbGJhY2tzIiwiYWRkUmVmIiwiZ2V0IiwiX19hc3luY0xvYWRBc3NldHNfXyIsImxvYWREZXBlbmRzIiwiX3V1aWQiLCJpbml0IiwiY29uZmlnIiwiY2FjaGVBc3NldCIsImRlcGVuZHMiLCJyZXBlYXRJdGVtIiwib25FcnJvciIsInByb3RvdHlwZSIsImRlY1JlZiIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsImkiLCJsIiwiZGVwZW5kQXNzZXQiLCJBc3NldCIsIl9fbmF0aXZlRGVwZW5kX18iLCJfbmF0aXZlQXNzZXQiLCJtaXNzaW5nQXNzZXQiLCJfX29uTG9hZEludm9rZWRfXyIsIm9uTG9hZCIsImUiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBTUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsZ0JBQUQsQ0FBM0I7O0FBQ0EsSUFBTUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsWUFBRCxDQUF4Qjs7QUFDQSxJQUFNRSxNQUFNLEdBQUdGLE9BQU8sQ0FBQyxVQUFELENBQXRCOztlQUNnR0EsT0FBTyxDQUFDLGFBQUQ7SUFBL0ZHLHNCQUFBQTtJQUFZQyxpQkFBQUE7SUFBT0MsdUJBQUFBO0lBQWFDLHlCQUFBQTtJQUFlQyxtQkFBQUE7SUFBU0MsaUJBQUFBO0lBQU9DLGdDQUFBQTs7Z0JBQzNCVCxPQUFPLENBQUMsVUFBRDtJQUEzQ1UsbUJBQUFBO0lBQVFDLGtCQUFBQTtJQUFPQyxtQkFBQUE7SUFBUUMscUJBQUFBOztBQUMvQixJQUFNQyxJQUFJLEdBQUdkLE9BQU8sQ0FBQyxRQUFELENBQXBCOztBQUVBLFNBQVNlLElBQVQsQ0FBZUMsSUFBZixFQUFxQkMsSUFBckIsRUFBMkI7QUFFdkIsTUFBSUMsU0FBUyxHQUFHLEtBQWhCOztBQUNBLE1BQUksQ0FBQ0YsSUFBSSxDQUFDRyxRQUFWLEVBQW9CO0FBQ2hCSCxJQUFBQSxJQUFJLENBQUNHLFFBQUwsR0FBZ0I7QUFBRUMsTUFBQUEsTUFBTSxFQUFFLENBQVY7QUFBYUMsTUFBQUEsS0FBSyxFQUFFTCxJQUFJLENBQUNNLEtBQUwsQ0FBV0MsTUFBL0I7QUFBdUNDLE1BQUFBLFNBQVMsRUFBRTtBQUFsRCxLQUFo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QVFrQixHQUFSO0FBRUg7O0FBRUQ0QixNQUFBQSxTQUFTLENBQUN4QyxNQUFWLEdBQW1CLENBQW5CO0FBQ0g7QUFqRXFCLEdBQVosQ0FBZDtBQW9FQVYsRUFBQUEsUUFBUSxDQUFDbUMsS0FBVCxDQUFlaEIsT0FBZjtBQUNIOztBQUVEMkQsTUFBTSxDQUFDQyxPQUFQLEdBQWlCN0UsSUFBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuIENvcHlyaWdodCAoYykgMjAxOSBYaWFtZW4gWWFqaSBTb2Z0d2FyZSBDby4sIEx0ZC5cblxuIGh0dHBzOi8vd3d3LmNvY29zLmNvbS9cblxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcbiAgd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcbiAgdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5jb25zdCBwYWNrTWFuYWdlciA9IHJlcXVpcmUoJy4vcGFjay1tYW5hZ2VyJyk7XG5jb25zdCBQaXBlbGluZSA9IHJlcXVpcmUoJy4vcGlwZWxpbmUnKTtcbmNvbnN0IHBhcnNlciA9IHJlcXVpcmUoJy4vcGFyc2VyJyk7XG5jb25zdCB7IGdldERlcGVuZHMsIGNhY2hlLCBnYXRoZXJBc3NldCwgc2V0UHJvcGVydGllcywgZm9yRWFjaCwgY2xlYXIsIGNoZWNrQ2lyY2xlUmVmZXJlbmNlIH0gPSByZXF1aXJlKCcuL3V0aWxpdGllcycpO1xuY29uc3QgeyBhc3NldHMsIGZpbGVzLCBwYXJzZWQsIHBpcGVsaW5lIH0gPSByZXF1aXJlKCcuL3NoYXJlZCcpO1xuY29uc3QgVGFzayA9IHJlcXVpcmUoJy4vdGFzaycpO1xuXG5mdW5jdGlvbiBsb2FkICh0YXNrLCBkb25lKSB7XG5cbiAgICBsZXQgZmlyc3RUYXNrID0gZmFsc2U7XG4gICAgaWYgKCF0YXNrLnByb2dyZXNzKSB7XG4gICAgICAgIHRhc2sucHJvZ3Jlc3MgPSB7IGZpbmlzaDogMCwgdG90YWw6IHRhc2suaW5wdXQubGVuZ3RoLCBjYW5JbnZva2U6IHRydWUgfTtcbiAgICAgICAgZmlyc3RUYXNrID0gdHJ1ZTtcbiAgICB9XG4gICAgXG4gICAgdmFyIG9wdGlvbnMgPSB0YXNrLm9wdGlvbnMsIHByb2dyZXNzID0gdGFzay5wcm9ncmVzcztcblxuICAgIG9wdGlvbnMuX19leGNsdWRlX18gPSBvcHRpb25zLl9fZXhjbHVkZV9fIHx8IE9iamVjdC5jcmVhdGUobnVsbCk7XG5cbiAgICB0YXNrLm91dHB1dCA9IFtdO1xuICAgIFxuICAgIGZvckVhY2godGFzay5pbnB1dCwgZnVuY3Rpb24gKGl0ZW0sIGNiKSB7XG5cbiAgICAgICAgbGV0IHN1YlRhc2sgPSBUYXNrLmNyZWF0ZSh7IFxuICAgICAgICAgICAgaW5wdXQ6IGl0ZW0sIFxuICAgICAgICAgICAgb25Qcm9ncmVzczogdGFzay5vblByb2dyZXNzLCBcbiAgICAgICAgICAgIG9wdGlvbnMsIFxuICAgICAgICAgICAgcHJvZ3Jlc3MsIFxuICAgICAgICAgICAgb25Db21wbGV0ZTogZnVuY3Rpb24gKGVyciwgaXRlbSkge1xuICAgICAgICAgICAgICAgIGlmIChlcnIgJiYgIXRhc2suaXNGaW5pc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFjYy5hc3NldE1hbmFnZXIuZm9yY2UgfHwgZmlyc3RUYXNrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIUNDX0VESVRPUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmVycm9yKGVyci5tZXNzYWdlLCBlcnIuc3RhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MuY2FuSW52b2tlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKGVycik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcy5jYW5JbnZva2UgJiYgdGFzay5kaXNwYXRjaCgncHJvZ3Jlc3MnLCArK3Byb2dyZXNzLmZpbmlzaCwgcHJvZ3Jlc3MudG90YWwsIGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRhc2sub3V0cHV0LnB1c2goaXRlbSk7XG4gICAgICAgICAgICAgICAgc3ViVGFzay5yZWN5Y2xlKCk7XG4gICAgICAgICAgICAgICAgY2IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgbG9hZE9uZUFzc2V0UGlwZWxpbmUuYXN5bmMoc3ViVGFzayk7XG5cbiAgICB9LCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgb3B0aW9ucy5fX2V4Y2x1ZGVfXyA9IG51bGw7XG5cbiAgICAgICAgaWYgKHRhc2suaXNGaW5pc2gpIHtcbiAgICAgICAgICAgIGNsZWFyKHRhc2ssIHRydWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRhc2suZGlzcGF0Y2goJ2Vycm9yJyk7XG4gICAgICAgIH1cblxuICAgICAgICBnYXRoZXJBc3NldCh0YXNrKTtcbiAgICAgICAgY2xlYXIodGFzaywgdHJ1ZSk7XG4gICAgICAgIGRvbmUoKTtcbiAgICB9KTtcbn1cblxudmFyIGxvYWRPbmVBc3NldFBpcGVsaW5lID0gbmV3IFBpcGVsaW5lKCdsb2FkT25lQXNzZXQnLCBbXG5cbiAgICBmdW5jdGlvbiBmZXRjaCAodGFzaywgZG9uZSkge1xuICAgICAgICB2YXIgaXRlbSA9IHRhc2sub3V0cHV0ID0gdGFzay5pbnB1dDtcbiAgICAgICAgdmFyIHsgb3B0aW9ucywgaXNOYXRpdmUsIHV1aWQsIGZpbGUgfSA9IGl0ZW07XG4gICAgICAgIHZhciB7IHJlbG9hZCB9ID0gb3B0aW9ucztcblxuICAgICAgICBpZiAoZmlsZSB8fCAoIXJlbG9hZCAmJiAhaXNOYXRpdmUgJiYgYXNzZXRzLmhhcyh1dWlkKSkpIHJldHVybiBkb25lKCk7XG5cbiAgICAgICAgcGFja01hbmFnZXIubG9hZChpdGVtLCB0YXNrLm9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbiAgICAgICAgICAgIGl0ZW0uZmlsZSA9IGRhdGE7XG4gICAgICAgICAgICBkb25lKGVycik7XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBmdW5jdGlvbiBwYXJzZSAodGFzaywgZG9uZSkge1xuXG4gICAgICAgIHZhciBpdGVtID0gdGFzay5vdXRwdXQgPSB0YXNrLmlucHV0LCBwcm9ncmVzcyA9IHRhc2sucHJvZ3Jlc3MsIGV4Y2x1ZGUgPSB0YXNrLm9wdGlvbnMuX19leGNsdWRlX187XG4gICAgICAgIHZhciB7IGlkLCBmaWxlLCBvcHRpb25zIH0gPSBpdGVtO1xuXG4gICAgICAgIGlmIChpdGVtLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBwYXJzZXIucGFyc2UoaWQsIGZpbGUsIGl0ZW0uZXh0LCBvcHRpb25zLCBmdW5jdGlvbiAoZXJyLCBhc3NldCkge1xuICAgICAgICAgICAgICAgIGlmIChlcnIpIHJldHVybiBkb25lKGVycik7XG4gICAgICAgICAgICAgICAgaXRlbS5jb250ZW50ID0gYXNzZXQ7XG4gICAgICAgICAgICAgICAgcHJvZ3Jlc3MuY2FuSW52b2tlICYmIHRhc2suZGlzcGF0Y2goJ3Byb2dyZXNzJywgKytwcm9ncmVzcy5maW5pc2gsIHByb2dyZXNzLnRvdGFsLCBpdGVtKTtcbiAgICAgICAgICAgICAgICBmaWxlcy5yZW1vdmUoaWQpO1xuICAgICAgICAgICAgICAgIHBhcnNlZC5yZW1vdmUoaWQpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIHsgdXVpZCB9ID0gaXRlbTtcbiAgICAgICAgICAgIGlmICh1dWlkIGluIGV4Y2x1ZGUpIHtcbiAgICBcbiAgICAgICAgICAgICAgICB2YXIgeyBmaW5pc2gsIGNvbnRlbnQsIGVyciwgY2FsbGJhY2tzIH0gPSBleGNsdWRlW3V1aWRdO1xuICAgICAgICAgICAgICAgIHByb2dyZXNzLmNhbkludm9rZSAmJiB0YXNrLmRpc3BhdGNoKCdwcm9ncmVzcycsICsrcHJvZ3Jlc3MuZmluaXNoLCBwcm9ncmVzcy50b3RhbCwgaXRlbSk7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKGZpbmlzaCB8fCBjaGVja0NpcmNsZVJlZmVyZW5jZSh1dWlkLCB1dWlkLCBleGNsdWRlKSApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGVudCAmJiBjb250ZW50LmFkZFJlZiAmJiBjb250ZW50LmFkZFJlZigpO1xuICAgICAgICAgICAgICAgICAgICBpdGVtLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICAgICAgICAgICAgICBkb25lKGVycik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3MucHVzaCh7IGRvbmUsIGl0ZW0gfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKCFvcHRpb25zLnJlbG9hZCAmJiBhc3NldHMuaGFzKHV1aWQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBhc3NldCA9IGFzc2V0cy5nZXQodXVpZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLl9fYXN5bmNMb2FkQXNzZXRzX18gfHwgIWFzc2V0Ll9fYXN5bmNMb2FkQXNzZXRzX18pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY29udGVudCA9IGFzc2V0LmFkZFJlZigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MuY2FuSW52b2tlICYmIHRhc2suZGlzcGF0Y2goJ3Byb2dyZXNzJywgKytwcm9ncmVzcy5maW5pc2gsIHByb2dyZXNzLnRvdGFsLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWREZXBlbmRzKHRhc2ssIGFzc2V0LCBkb25lLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlci5wYXJzZShpZCwgZmlsZSwgJ2ltcG9ydCcsIG9wdGlvbnMsIGZ1bmN0aW9uIChlcnIsIGFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyKSByZXR1cm4gZG9uZShlcnIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuX3V1aWQgPSB1dWlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9hZERlcGVuZHModGFzaywgYXNzZXQsIGRvbmUsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5dKTtcblxuZnVuY3Rpb24gbG9hZERlcGVuZHMgKHRhc2ssIGFzc2V0LCBkb25lLCBpbml0KSB7XG5cbiAgICB2YXIgaXRlbSA9IHRhc2suaW5wdXQsIHByb2dyZXNzID0gdGFzay5wcm9ncmVzcztcbiAgICB2YXIgeyB1dWlkLCBpZCwgb3B0aW9ucywgY29uZmlnIH0gPSBpdGVtO1xuICAgIHZhciB7IF9fYXN5bmNMb2FkQXNzZXRzX18sIGNhY2hlQXNzZXQgfSA9IG9wdGlvbnM7XG5cbiAgICB2YXIgZGVwZW5kcyA9IFtdO1xuICAgIC8vIGFkZCByZWZlcmVuY2UgYXZvaWQgYmVpbmcgcmVsZWFzZWQgZHVyaW5nIGxvYWRpbmcgZGVwZW5kZW5jaWVzXG4gICAgYXNzZXQuYWRkUmVmICYmIGFzc2V0LmFkZFJlZigpO1xuICAgIGdldERlcGVuZHModXVpZCwgYXNzZXQsIE9iamVjdC5jcmVhdGUobnVsbCksIGRlcGVuZHMsIGZhbHNlLCBfX2FzeW5jTG9hZEFzc2V0c19fLCBjb25maWcpO1xuICAgIHByb2dyZXNzLmNhbkludm9rZSAmJiB0YXNrLmRpc3BhdGNoKCdwcm9ncmVzcycsICsrcHJvZ3Jlc3MuZmluaXNoLCBwcm9ncmVzcy50b3RhbCArPSBkZXBlbmRzLmxlbmd0aCwgaXRlbSk7XG5cbiAgICB2YXIgcmVwZWF0SXRlbSA9IHRhc2sub3B0aW9ucy5fX2V4Y2x1ZGVfX1t1dWlkXSA9IHsgY29udGVudDogYXNzZXQsIGZpbmlzaDogZmFsc2UsIGNhbGxiYWNrczogW3sgZG9uZSwgaXRlbSB9XSB9O1xuXG4gICAgbGV0IHN1YlRhc2sgPSBUYXNrLmNyZWF0ZSh7IFxuICAgICAgICBpbnB1dDogZGVwZW5kcywgXG4gICAgICAgIG9wdGlvbnM6IHRhc2sub3B0aW9ucywgXG4gICAgICAgIG9uUHJvZ3Jlc3M6IHRhc2sub25Qcm9ncmVzcywgXG4gICAgICAgIG9uRXJyb3I6IFRhc2sucHJvdG90eXBlLnJlY3ljbGUsIFxuICAgICAgICBwcm9ncmVzcywgXG4gICAgICAgIG9uQ29tcGxldGU6IGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGFzc2V0LmRlY1JlZiAmJiBhc3NldC5kZWNSZWYoZmFsc2UpO1xuICAgICAgICAgICAgYXNzZXQuX19hc3luY0xvYWRBc3NldHNfXyA9IF9fYXN5bmNMb2FkQXNzZXRzX187XG4gICAgICAgICAgICByZXBlYXRJdGVtLmZpbmlzaCA9IHRydWU7XG4gICAgICAgICAgICByZXBlYXRJdGVtLmVyciA9IGVycjtcblxuICAgICAgICAgICAgaWYgKCFlcnIpIHtcblxuICAgICAgICAgICAgICAgIHZhciBhc3NldHMgPSBBcnJheS5pc0FycmF5KHN1YlRhc2sub3V0cHV0KSA/IHN1YlRhc2sub3V0cHV0IDogW3N1YlRhc2sub3V0cHV0XTtcbiAgICAgICAgICAgICAgICB2YXIgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFzc2V0cy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlcGVuZEFzc2V0ID0gYXNzZXRzW2ldO1xuICAgICAgICAgICAgICAgICAgICBkZXBlbmRBc3NldCAmJiAobWFwW2RlcGVuZEFzc2V0IGluc3RhbmNlb2YgY2MuQXNzZXQgPyBkZXBlbmRBc3NldC5fdXVpZCArICdAaW1wb3J0JyA6IHV1aWQgKyAnQG5hdGl2ZSddID0gZGVwZW5kQXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICghaW5pdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXNzZXQuX19uYXRpdmVEZXBlbmRfXyAmJiAhYXNzZXQuX25hdGl2ZUFzc2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWlzc2luZ0Fzc2V0ID0gc2V0UHJvcGVydGllcyh1dWlkLCBhc3NldCwgbWFwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbWlzc2luZ0Fzc2V0ICYmICFhc3NldC5fX29uTG9hZEludm9rZWRfXykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0Lm9uTG9hZCAmJiBhc3NldC5vbkxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuX19vbkxvYWRJbnZva2VkX18gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcihlLm1lc3NhZ2UsIGUuc3RhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1pc3NpbmdBc3NldCA9IHNldFByb3BlcnRpZXModXVpZCwgYXNzZXQsIG1hcCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghbWlzc2luZ0Fzc2V0ICYmICFhc3NldC5fX29uTG9hZEludm9rZWRfXykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3NldC5vbkxvYWQgJiYgYXNzZXQub25Mb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXQuX19vbkxvYWRJbnZva2VkX18gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5lcnJvcihlLm1lc3NhZ2UsIGUuc3RhY2spO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzLnJlbW92ZShpZCk7XG4gICAgICAgICAgICAgICAgICAgIHBhcnNlZC5yZW1vdmUoaWQpO1xuICAgICAgICAgICAgICAgICAgICBjYWNoZSh1dWlkLCBhc3NldCwgY2FjaGVBc3NldCAhPT0gdW5kZWZpbmVkID8gY2FjaGVBc3NldCA6IGNjLmFzc2V0TWFuYWdlci5jYWNoZUFzc2V0KTsgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN1YlRhc2sucmVjeWNsZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgY2FsbGJhY2tzID0gcmVwZWF0SXRlbS5jYWxsYmFja3M7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2FsbGJhY2tzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgdmFyIGNiID0gY2FsbGJhY2tzW2ldO1xuICAgICAgICAgICAgICAgIGFzc2V0LmFkZFJlZiAmJiBhc3NldC5hZGRSZWYoKTtcbiAgICAgICAgICAgICAgICBjYi5pdGVtLmNvbnRlbnQgPSBhc3NldDtcbiAgICAgICAgICAgICAgICBjYi5kb25lKGVycik7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2FsbGJhY2tzLmxlbmd0aCA9IDA7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHBpcGVsaW5lLmFzeW5jKHN1YlRhc2spO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGxvYWQ7Il0sInNvdXJjZVJvb3QiOiIvIn0=