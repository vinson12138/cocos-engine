
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/platform/CCSAXParser.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

/****************************************************************************
 Copyright (c) 2008-2010 Ricardo Quesada
 Copyright (c) 2011-2012 cocos2d-x.org
 Copyright (c) 2013-2016 Chukong Technologies Inc.
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 http://www.cocos2d-x.org

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var js = require('../platform/js');
/**
 * A SAX Parser
 * @class saxParser
 */


cc.SAXParser = function () {
  if (!(CC_EDITOR && Editor.isMainProcess) && window.DOMParser) {
    this._isSupportDOMParser = true;
    this._parser = new DOMParser();
  } else {
    this._isSupportDOMParser = false;
    this._parser = null;
  }
};

cc.SAXParser.prototype = {
  constructor: cc.SAXParser,

  /**
   * @method parse
   * @param {String} xmlTxt
   * @return {Document}
   */
  parse: function parse(xmlTxt) {
    return this._parseXML(xmlTxt);
  },
  _parseXML: function _parseXML(textxml) {
    // get a reference to the requested corresponding xml file
    var xmlDoc;

    if (this._isSupportDOMParser) {
      xmlDoc = this._parser.parseFromString(textxml, "text/xml");
    } else {
      // Internet Explorer (untested!)
      xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
      xmlDoc.async = "false";
      xmlDoc.loadXML(textxml);
    }

    return xmlDoc;
  }
};
/**
 *
 * cc.plistParser is a singleton object for parsing plist files
 * @class plistParser
 * @extends SAXParser
 */

cc.PlistParser = function () {
  cc.SAXParser.call(this);
};

js.extend(cc.PlistParser, cc.SAXParser);
js.mixin(cc.PlistParser.prototype, {
  /**
   * parse a xml string as plist object.
   * @param {String} xmlTxt - plist xml contents
   * @return {*} plist object
   */
  parse: function parse(xmlTxt) {
    var xmlDoc = this._parseXML(xmlTxt);

    var plist = xmlDoc.documentElement;

    if (plist.tagName !== 'plist') {
      cc.warnID(5100);
      return {};
    } // Get first real node


    var node = null;

    for (var i = 0, len = plist.childNodes.length; i < len; i++) {
      node = plist.childNodes[i];
      if (node.nodeType === 1) break;
    }

    xmlDoc = null;
    return this._parseNode(node);
  },
  _parseNode: function _parseNode(node) {
    var data = null,
        tagName = node.tagName;

    if (tagName === "dict") {
      data = this._parseDict(node);
    } else if (tagName === "array") {
      data = this._parseArray(node);
    } else if (tagName === "string") {
      if (node.childNodes.length === 1) data = node.firstChild.nodeValue;else {
        //handle Firefox's 4KB nodeValue limit
        data = "";

        for (var i = 0; i < node.childNodes.length; i++) {
          data += node.childNodes[i].nodeValue;
        }
      }
    } else if (tagName === "false") {
      data = false;
    } else if (tagName === "true") {
      data = true;
    } else if (tagName === "real") {
      data = parseFloat(node.firstChild.nodeValue);
    } else if (tagName === "integer") {
      data = parseInt(node.firstChild.nodeValue, 10);
    }

    return data;
  },
  _parseArray: function _parseArray(node) {
    var data = [];

    for (var i = 0, len = node.childNodes.length; i < len; i++) {
      var child = node.childNodes[i];
      if (child.nodeType !== 1) continue;
      data.push(this._parseNode(child));
    }

    return data;
  },
  _parseDict: function _parseDict(node) {
    var data = {};
    var key = null;

    for (var i = 0, len = node.childNodes.length; i < len; i++) {
      var child = node.childNodes[i];
      if (child.nodeType !== 1) continue; // Grab the key, next noe should be the value

      if (child.tagName === 'key') key = child.firstChild.nodeValue;else data[key] = this._parseNode(child); // Parse the value node
    }

    return data;
  }
});
cc.saxParser = new cc.SAXParser();
/**
 * @type {PlistParser}
 * @name plistParser
 * A Plist Parser
 */

cc.plistParser = new cc.PlistParser();
module.exports = {
  saxParser: cc.saxParser,
  plistParser: cc.plistParser
};
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlL3BsYXRmb3JtL0NDU0FYUGFyc2VyLmpzIl0sIm5hbWVzIjpbImpzIiwicmVxdWlyZSIsImNjIiwiU0FYUGFyc2VyIiwiQ0NfRURJVE9SIiwiRWRpdG9yIiwiaXNNYWluUHJvY2VzcyIsIndpbmRvdyIsIkRPTVBhcnNlciIsIl9pc1N1cHBvcnRET01QYXJzZXIiLCJfcGFyc2VyIiwicHJvdG90eXBlIiwiY29uc3RydWN0b3IiLCJwYXJzZSIsInhtbFR4dCIsIl9wYXJzZVhNTCIsInRleHR4bWwiLCJ4bWxEb2MiLCJwYXJzZUZyb21TdHJpbmciLCJBY3RpdmVYT2JqZWN0IiwiYXN5bmMiLCJsb2FkWE1MIiwiUGxpc3RQYXJzZXIiLCJjYWxsIiwiZXh0ZW5kIiwibWl4aW4iLCJwbGlzdCIsImRvY3VtZW50RWxlbWVudCIsInRhZ05hbWUiLCJ3YXJuSUQiLCJub2RlIiwiaSIsImxlbiIsImNoaWxkTm9kZXMiLCJsZW5ndGgiLCJub2RlVHlwZSIsIl9wYXJzZU5vZGUiLCJkYXRhIiwiX3BhcnNlRGljdCIsIl9wYXJzZUFycmF5IiwiZmlyc3RDaGlsZCIsIm5vZGVWYWx1ZSIsInBhcnNlRmxvYXQiLCJwYXJzZUludCIsImNoaWxkIiwicHVzaCIsImtleSIsInNheFBhcnNlciIsInBsaXN0UGFyc2VyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxJQUFJQSxFQUFFLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUFoQjtBQUVBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQUMsRUFBRSxDQUFDQyxTQUFILEdBQWUsWUFBWTtBQUN2QixNQUFJLEVBQUVDLFNB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T1AsSUFBUDtBQUNIO0FBOUU4QixDQUFuQztBQWlGQW5DLEVBQUUsQ0FBQzZDLFNBQUgsR0FBZSxJQUFJN0MsRUFBRSxDQUFDQyxTQUFQLEVBQWY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUNBRCxFQUFFLENBQUM4QyxXQUFILEdBQWlCLElBQUk5QyxFQUFFLENBQUNvQixXQUFQLEVBQWpCO0FBRUEyQixNQUFNLENBQUNDLE9BQVAsR0FBaUI7QUFDYkgsRUFBQUEsU0FBUyxFQUFFN0MsRUFBRSxDQUFDNkMsU0FERDtBQUViQyxFQUFBQSxXQUFXLEVBQUU5QyxFQUFFLENBQUM4QztBQUZILENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMDgtMjAxMCBSaWNhcmRvIFF1ZXNhZGFcbiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMiBjb2NvczJkLXgub3JnXG4gQ29weXJpZ2h0IChjKSAyMDEzLTIwMTYgQ2h1a29uZyBUZWNobm9sb2dpZXMgSW5jLlxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cDovL3d3dy5jb2NvczJkLXgub3JnXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cbiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuIFRIRSBTT0ZUV0FSRS5cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG52YXIganMgPSByZXF1aXJlKCcuLi9wbGF0Zm9ybS9qcycpO1xuXG4vKipcbiAqIEEgU0FYIFBhcnNlclxuICogQGNsYXNzIHNheFBhcnNlclxuICovXG5jYy5TQVhQYXJzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCEoQ0NfRURJVE9SICYmIEVkaXRvci5pc01haW5Qcm9jZXNzKSAmJiB3aW5kb3cuRE9NUGFyc2VyKSB7XG4gICAgICAgIHRoaXMuX2lzU3VwcG9ydERPTVBhcnNlciA9IHRydWU7XG4gICAgICAgIHRoaXMuX3BhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pc1N1cHBvcnRET01QYXJzZXIgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fcGFyc2VyID0gbnVsbDtcbiAgICB9XG59O1xuY2MuU0FYUGFyc2VyLnByb3RvdHlwZSA9IHtcbiAgICBjb25zdHJ1Y3RvcjogY2MuU0FYUGFyc2VyLFxuICAgIC8qKlxuICAgICAqIEBtZXRob2QgcGFyc2VcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30geG1sVHh0XG4gICAgICogQHJldHVybiB7RG9jdW1lbnR9XG4gICAgICovXG4gICAgcGFyc2UgOiBmdW5jdGlvbih4bWxUeHQpe1xuICAgICAgICByZXR1cm4gdGhpcy5fcGFyc2VYTUwoeG1sVHh0KTtcbiAgICB9LFxuXG4gICAgX3BhcnNlWE1MOiBmdW5jdGlvbiAodGV4dHhtbCkge1xuICAgICAgICAvLyBnZXQgYSByZWZlcmVuY2UgdG8gdGhlIHJlcXVlc3RlZCBjb3JyZXNwb25kaW5nIHhtbCBmaWxlXG4gICAgICAgIHZhciB4bWxEb2M7XG4gICAgICAgIGlmICh0aGlzLl9pc1N1cHBvcnRET01QYXJzZXIpIHtcbiAgICAgICAgICAgIHhtbERvYyA9IHRoaXMuX3BhcnNlci5wYXJzZUZyb21TdHJpbmcodGV4dHhtbCwgXCJ0ZXh0L3htbFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEludGVybmV0IEV4cGxvcmVyICh1bnRlc3RlZCEpXG4gICAgICAgICAgICB4bWxEb2MgPSBuZXcgQWN0aXZlWE9iamVjdChcIk1pY3Jvc29mdC5YTUxET01cIik7XG4gICAgICAgICAgICB4bWxEb2MuYXN5bmMgPSBcImZhbHNlXCI7XG4gICAgICAgICAgICB4bWxEb2MubG9hZFhNTCh0ZXh0eG1sKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geG1sRG9jO1xuICAgIH1cbn07XG5cbi8qKlxuICpcbiAqIGNjLnBsaXN0UGFyc2VyIGlzIGEgc2luZ2xldG9uIG9iamVjdCBmb3IgcGFyc2luZyBwbGlzdCBmaWxlc1xuICogQGNsYXNzIHBsaXN0UGFyc2VyXG4gKiBAZXh0ZW5kcyBTQVhQYXJzZXJcbiAqL1xuY2MuUGxpc3RQYXJzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2MuU0FYUGFyc2VyLmNhbGwodGhpcyk7XG59O1xuanMuZXh0ZW5kKGNjLlBsaXN0UGFyc2VyLCBjYy5TQVhQYXJzZXIpO1xuanMubWl4aW4oY2MuUGxpc3RQYXJzZXIucHJvdG90eXBlLCB7XG4gICAgLyoqXG4gICAgICogcGFyc2UgYSB4bWwgc3RyaW5nIGFzIHBsaXN0IG9iamVjdC5cbiAgICAgKiBAcGFyYW0ge1N0cmluZ30geG1sVHh0IC0gcGxpc3QgeG1sIGNvbnRlbnRzXG4gICAgICogQHJldHVybiB7Kn0gcGxpc3Qgb2JqZWN0XG4gICAgICovXG4gICAgcGFyc2UgOiBmdW5jdGlvbiAoeG1sVHh0KSB7XG4gICAgICAgIHZhciB4bWxEb2MgPSB0aGlzLl9wYXJzZVhNTCh4bWxUeHQpO1xuICAgICAgICB2YXIgcGxpc3QgPSB4bWxEb2MuZG9jdW1lbnRFbGVtZW50O1xuICAgICAgICBpZiAocGxpc3QudGFnTmFtZSAhPT0gJ3BsaXN0Jykge1xuICAgICAgICAgICAgY2Mud2FybklEKDUxMDApO1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2V0IGZpcnN0IHJlYWwgbm9kZVxuICAgICAgICB2YXIgbm9kZSA9IG51bGw7XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwbGlzdC5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBub2RlID0gcGxpc3QuY2hpbGROb2Rlc1tpXTtcbiAgICAgICAgICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAxKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHhtbERvYyA9IG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJzZU5vZGUobm9kZSk7XG4gICAgfSxcblxuICAgIF9wYXJzZU5vZGU6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHZhciBkYXRhID0gbnVsbCwgdGFnTmFtZSA9IG5vZGUudGFnTmFtZTtcbiAgICAgICAgaWYodGFnTmFtZSA9PT0gXCJkaWN0XCIpe1xuICAgICAgICAgICAgZGF0YSA9IHRoaXMuX3BhcnNlRGljdChub2RlKTtcbiAgICAgICAgfWVsc2UgaWYodGFnTmFtZSA9PT0gXCJhcnJheVwiKXtcbiAgICAgICAgICAgIGRhdGEgPSB0aGlzLl9wYXJzZUFycmF5KG5vZGUpO1xuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcInN0cmluZ1wiKXtcbiAgICAgICAgICAgIGlmIChub2RlLmNoaWxkTm9kZXMubGVuZ3RoID09PSAxKVxuICAgICAgICAgICAgICAgIGRhdGEgPSBub2RlLmZpcnN0Q2hpbGQubm9kZVZhbHVlO1xuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy9oYW5kbGUgRmlyZWZveCdzIDRLQiBub2RlVmFsdWUgbGltaXRcbiAgICAgICAgICAgICAgICBkYXRhID0gXCJcIjtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGUuY2hpbGROb2Rlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBub2RlLmNoaWxkTm9kZXNbaV0ubm9kZVZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcImZhbHNlXCIpe1xuICAgICAgICAgICAgZGF0YSA9IGZhbHNlO1xuICAgICAgICB9ZWxzZSBpZih0YWdOYW1lID09PSBcInRydWVcIil7XG4gICAgICAgICAgICBkYXRhID0gdHJ1ZTtcbiAgICAgICAgfWVsc2UgaWYodGFnTmFtZSA9PT0gXCJyZWFsXCIpe1xuICAgICAgICAgICAgZGF0YSA9IHBhcnNlRmxvYXQobm9kZS5maXJzdENoaWxkLm5vZGVWYWx1ZSk7XG4gICAgICAgIH1lbHNlIGlmKHRhZ05hbWUgPT09IFwiaW50ZWdlclwiKXtcbiAgICAgICAgICAgIGRhdGEgPSBwYXJzZUludChub2RlLmZpcnN0Q2hpbGQubm9kZVZhbHVlLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIF9wYXJzZUFycmF5OiBmdW5jdGlvbiAobm9kZSkge1xuICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbaV07XG4gICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgIT09IDEpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICBkYXRhLnB1c2godGhpcy5fcGFyc2VOb2RlKGNoaWxkKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfSxcblxuICAgIF9wYXJzZURpY3Q6IGZ1bmN0aW9uIChub2RlKSB7XG4gICAgICAgIHZhciBkYXRhID0ge307XG4gICAgICAgIHZhciBrZXkgPSBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGQgPSBub2RlLmNoaWxkTm9kZXNbaV07XG4gICAgICAgICAgICBpZiAoY2hpbGQubm9kZVR5cGUgIT09IDEpXG4gICAgICAgICAgICAgICAgY29udGludWU7XG5cbiAgICAgICAgICAgIC8vIEdyYWIgdGhlIGtleSwgbmV4dCBub2Ugc2hvdWxkIGJlIHRoZSB2YWx1ZVxuICAgICAgICAgICAgaWYgKGNoaWxkLnRhZ05hbWUgPT09ICdrZXknKVxuICAgICAgICAgICAgICAgIGtleSA9IGNoaWxkLmZpcnN0Q2hpbGQubm9kZVZhbHVlO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGRhdGFba2V5XSA9IHRoaXMuX3BhcnNlTm9kZShjaGlsZCk7ICAgICAgICAgICAgICAgICAvLyBQYXJzZSB0aGUgdmFsdWUgbm9kZVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbn0pO1xuXG5jYy5zYXhQYXJzZXIgPSBuZXcgY2MuU0FYUGFyc2VyKCk7XG4vKipcbiAqIEB0eXBlIHtQbGlzdFBhcnNlcn1cbiAqIEBuYW1lIHBsaXN0UGFyc2VyXG4gKiBBIFBsaXN0IFBhcnNlclxuICovXG5jYy5wbGlzdFBhcnNlciA9IG5ldyBjYy5QbGlzdFBhcnNlcigpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBzYXhQYXJzZXI6IGNjLnNheFBhcnNlcixcbiAgICBwbGlzdFBhcnNlcjogY2MucGxpc3RQYXJzZXJcbn1cbiJdLCJzb3VyY2VSb290IjoiLyJ9