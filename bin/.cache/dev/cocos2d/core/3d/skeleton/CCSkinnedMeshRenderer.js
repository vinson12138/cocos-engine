
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/3d/skeleton/CCSkinnedMeshRenderer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

var _mat = _interopRequireDefault(require("../../value-types/mat4"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/****************************************************************************
 Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.

 http://www.cocos.com

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
  worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
  not use Cocos Creator software for developing other software or tools that's
  used for developing games. You are not granted to publish, distribute,
  sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
var Skeleton = require('./CCSkeleton');

var MeshRenderer = require('../../mesh/CCMeshRenderer');

var RenderFlow = require('../../renderer/render-flow');

var enums = require('../../../renderer/enums');

var _m4_tmp = cc.mat4();

var _m4_tmp2 = cc.mat4();
/**
 * !#en
 * Skinned Mesh Renderer
 * !#zh
 * 蒙皮渲染组件
 * @class SkinnedMeshRenderer
 * @extends MeshRenderer
 */


var SkinnedMeshRenderer = cc.Class({
  name: 'cc.SkinnedMeshRenderer',
  "extends": MeshRenderer,
  editor: CC_EDITOR && {
    menu: 'i18n:MAIN_MENU.component.mesh/Skinned Mesh Renderer'
  },
  ctor: function ctor() {
    this._jointsData = this._jointsFloat32Data = null;
    this._jointsTexture = null;
    this._joints = [];
    this._dummyNode = new cc.Node();
    this._jointsTextureOptions = null;
    this._usingRGBA8Texture = false;
  },
  properties: {
    _skeleton: Skeleton,
    _rootBone: cc.Node,

    /**
     * !#en
     * Skeleton Asset
     * !#zh
     * 骨骼资源
     * @property {Skeleton} skeleton
     */
    skeleton: {
      get: function get() {
        return this._skeleton;
      },
      set: function set(val) {
        this._skeleton = val;

        this._init();
      },
      type: Skeleton
    },

    /**
     * !#en
     * Root Bone
     * !#zh
     * 骨骼根节点
     * @property {Node} rootBone
     */
    rootBone: {
      get: function get() {
        return this._rootBone;
      },
      set: function set(val) {
        this._rootBone = val;

        this._init();
      },
      type: cc.Node
    },
    // SkinnedMeshRenderer cannot batch
    enableAutoBatch: {
      get: function get() {
        return false;
      },
      visible: false,
      override: true
    }
  },
  __preload: function __preload() {
    this._super();

    this._init();
  },
  _init: function _init() {
    this._model = this._skeleton && this._skeleton.model;
    this._calFunc = null;

    this._initJoints();

    this._initJointsTexture();

    this._initCalcFunc();

    this._updateRenderNode();
  },
  _calcWorldMatrixToRoot: function _calcWorldMatrixToRoot(joint) {
    var worldMatrixToRoot = joint._worldMatrixToRoot;

    if (!worldMatrixToRoot) {
      joint._worldMatrixToRoot = worldMatrixToRoot = cc.mat4();
      joint.getLocalMatrix(worldMatrixToRoot);
    } else {
      return;
    }

    var parent = joint.parent;

    if (parent !== this.rootBone) {
      if (!parent._worldMatrixToRoot) {
        this._calcWorldMatrixToRoot(parent);
      }

      _mat["default"].mul(worldMatrixToRoot, parent._worldMatrixToRoot, worldMatrixToRoot);
    }
  },
  _validateRender: function _validateRender() {
    if (!this._jointsData) {
      this.disableRender();
      return;
    }

    this._super();
  },
  _initJoints: function _initJoints() {
    var joints = this._joints;
    joints.length = 0;
    if (!this.skeleton || !this.rootBone) return;

    var useJointMatrix = this._useJointMatrix();

    var jointPaths = this.skeleton.jointPaths;
    var rootBone = this.rootBone;

    for (var i = 0; i < jointPaths.length; i++) {
      var joint = cc.find(jointPaths[i], rootBone);

      if (!joint) {
        cc.warn('Can not find joint in root bone [%s] with path [%s]', rootBone.name, jointPaths[i]);
      }

      if (useJointMatrix) {
        joint._renderFlag &= ~RenderFlow.FLAG_CHILDREN;

        this._calcWorldMatrixToRoot(joint);
      }

      joints.push(joint);
    }

    if (useJointMatrix) {
      var uniqueBindPoses = this.skeleton.uniqueBindPoses;

      for (var _i = 0; _i < jointPaths.length; _i++) {
        var _joint = joints[_i];

        if (uniqueBindPoses[_i]) {
          _mat["default"].mul(_m4_tmp, _joint._worldMatrixToRoot, uniqueBindPoses[_i]);

          _joint._jointMatrix = _mat["default"].toArray([], _m4_tmp);
        } else {
          _joint._jointMatrix = _joint._worldMatrixToRoot;
        }
      }
    }
  },
  _initJointsTexture: function _initJointsTexture() {
    if (!this._skeleton) return;
    var jointCount = this._joints.length;
    var inited = false;

    if (jointCount <= cc.sys.getMaxJointMatrixSize()) {
      inited = true;
      this._jointsData = this._jointsFloat32Data = new Float32Array(jointCount * 16);
    }

    if (!inited) {
      var SUPPORT_FLOAT_TEXTURE = !!cc.sys.glExtension('OES_texture_float');
      var size;

      if (jointCount > 256) {
        size = 64;
      } else if (jointCount > 64) {
        size = 32;
      } else if (jointCount > 16) {
        size = 16;
      } else {
        size = 8;
      }

      this._jointsData = this._jointsFloat32Data = new Float32Array(size * size * 4);
      var pixelFormat = cc.Texture2D.PixelFormat.RGBA32F,
          width = size,
          height = size;

      if (!SUPPORT_FLOAT_TEXTURE) {
        this._jointsData = new Uint8Array(this._jointsFloat32Data.buffer);
        pixelFormat = cc.Texture2D.PixelFormat.RGBA8888;
        width *= 4;
        this._usingRGBA8Texture = true;
        cc.warn("SkinnedMeshRenderer [" + this.node.name + "] has too many joints [" + jointCount + "] and device do not support float32 texture, fallback to use RGBA8888 texture, which is much slower.");
      }

      var texture = this._jointsTexture || new cc.Texture2D();
      var NEAREST = cc.Texture2D.Filter.NEAREST;
      texture.setFilters(NEAREST, NEAREST);
      texture.initWithData(this._jointsData, pixelFormat, width, height);
      this._jointsTexture = texture;
      this._jointsTextureOptions = {
        format: pixelFormat,
        width: texture.width,
        height: texture.height,
        images: []
      };
    }

    this._updateMaterial();
  },
  _updateMaterial: function _updateMaterial() {
    MeshRenderer.prototype._updateMaterial.call(this);

    var materials = this.getMaterials();

    for (var i = 0; i < materials.length; i++) {
      var material = materials[i];

      if (this._jointsTexture) {
        material.setProperty('jointsTexture', this._jointsTexture);
        material.setProperty('jointsTextureSize', new Float32Array([this._jointsTexture.width, this._jointsTexture.height]));
        material.define('CC_JOINTS_TEXTURE_FLOAT32', !!cc.sys.glExtension('OES_texture_float'));
        material.define('CC_USE_JOINTS_TEXTRUE', true);
      } else {
        if (this._jointsFloat32Data) {
          material.setProperty('jointMatrices', this._jointsFloat32Data, undefined, true);
        }

        material.define('CC_USE_JOINTS_TEXTRUE', false);
      }

      material.define('CC_USE_SKINNING', true);
    }
  },
  _setJointsDataWithArray: function _setJointsDataWithArray(iMatrix, matrixArray) {
    var data = this._jointsFloat32Data;
    data.set(matrixArray, iMatrix * 16);
  },
  _setJointsDataWithMatrix: function _setJointsDataWithMatrix(iMatrix, matrix) {
    this._jointsFloat32Data.set(matrix.m, 16 * iMatrix);
  },
  _commitJointsData: function _commitJointsData() {
    if (this._jointsTexture) {
      this._jointsTextureOptions.images[0] = this._jointsData;

      this._jointsTexture.update(this._jointsTextureOptions);
    }
  },
  _useJointMatrix: function _useJointMatrix() {
    return this._model && this._model.precomputeJointMatrix;
  },
  _updateRenderNode: function _updateRenderNode() {
    if (this._useJointMatrix() || this._usingRGBA8Texture) {
      this._assembler.setRenderNode(this.rootBone);
    } else {
      this._assembler.setRenderNode(this._dummyNode);
    }
  },
  _initCalcFunc: function _initCalcFunc() {
    if (this._useJointMatrix()) {
      this._calFunc = this._calJointMatrix;
    } else if (this._usingRGBA8Texture) {
      this._calFunc = this._calRGBA8WorldMatrix;
    } else {
      this._calFunc = this._calWorldMatrix;
    }
  },
  _calJointMatrix: function _calJointMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;
    var uniqueBindPoses = this.skeleton.uniqueBindPoses;

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];
      var jointMatrix = joint._jointMatrix;

      if (uniqueBindPoses[i]) {
        this._setJointsDataWithArray(i, jointMatrix);
      } else {
        _mat["default"].multiply(_m4_tmp, jointMatrix, bindposes[i]);

        this._setJointsDataWithMatrix(i, _m4_tmp);
      }
    }
  },
  // Some device rgba8 texture precision is low, when encode a big number it may loss precision.
  // Invert root bone matrix can effectively avoid big position encode into rgba8 texture.
  _calRGBA8WorldMatrix: function _calRGBA8WorldMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;

    this.rootBone._updateWorldMatrix();

    var rootMatrix = this.rootBone._worldMatrix;

    var invRootMat = _mat["default"].invert(_m4_tmp2, rootMatrix);

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];

      joint._updateWorldMatrix();

      _mat["default"].multiply(_m4_tmp, invRootMat, joint._worldMatrix);

      _mat["default"].multiply(_m4_tmp, _m4_tmp, bindposes[i]);

      this._setJointsDataWithMatrix(i, _m4_tmp);
    }
  },
  _calWorldMatrix: function _calWorldMatrix() {
    var joints = this._joints;
    var bindposes = this.skeleton.bindposes;

    for (var i = 0; i < joints.length; ++i) {
      var joint = joints[i];

      joint._updateWorldMatrix();

      _mat["default"].multiply(_m4_tmp, joint._worldMatrix, bindposes[i]);

      this._setJointsDataWithMatrix(i, _m4_tmp);
    }
  },
  calcJointMatrix: function calcJointMatrix() {
    if (!this.skeleton || !this.rootBone) return;

    this._calFunc.call(this);

    this._commitJointsData();
  }
});
cc.SkinnedMeshRenderer = module.exports = SkinnedMeshRenderer;
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlLzNkL3NrZWxldG9uL0NDU2tpbm5lZE1lc2hSZW5kZXJlci5qcyJdLCJuYW1lcyI6WyJTa2VsZXRvbiIsInJlcXVpcmUiLCJNZXNoUmVuZGVyZXIiLCJSZW5kZXJGbG93IiwiZW51bXMiLCJfbTRfdG1wIiwiY2MiLCJtYXQ0IiwiX200X3RtcDIiLCJTa2lubmVkTWVzaFJlbmRlcmVyIiwiQ2xhc3MiLCJuYW1lIiwiZWRpdG9yIiwiQ0NfRURJVE9SIiwibWVudSIsImN0b3IiLCJfam9pbnRzRGF0YSIsIl9qb2ludHNGbG9hdDMyRGF0YSIsIl9qb2ludHNUZXh0dXJlIiwiX2pvaW50cyIsIl9kdW1teU5vZGUiLCJOb2RlIiwiX2pvaW50c1RleHR1cmVPcHRpb25zIiwiX3VzaW5nUkdCQThUZXh0dXJlIiwicHJvcGVydGllcyIsIl9za2VsZXRvbiIsIl9yb290Qm9uZSIsInNrZWxldG9uIiwiZ2V0Iiwic2V0IiwidmFsIiwiX2luaXQiLCJ0eXBlIiwicm9vdEJvbmUiLCJlbmFibGVBdXRvQmF0Y2giLCJ2aXNpYmxlIiwib3ZlcnJpZGUiLCJfX3ByZWxvYWQiLCJfc3VwZXIiLCJfbW9kZWwiLCJtb2RlbCIsIl9jYWxGdW5jIiwiX2luaXRKb2ludHMiLCJfaW5pdEpvaW50c1RleHR1cmUiLCJfaW5pdENhbGNGdW5jIiwiX3VwZGF0ZVJlbmRlck5vZGUiLCJfY2FsY1dvcmxkTWF0cml4VG9Sb290Iiwiam9pbnQiLCJ3b3JsZE1hdHJpeFRvUm9vdCIsIl93b3JsZE1hdHJpeFRvUm9vdCIsImdldExvY2FsTWF0cml4IiwicGFyZW50IiwiTWF0NCIsIm11bCIsIl92YWxpZGF0ZVJlbmRlciIsImRpc2FibGVSZW5kZXIiLCJqb2ludHMiLCJsZW5ndGgiLCJ1c2VKb2ludE1hdHJpeCIsIl91c2VKb2ludE1hdHJpeCIsImpvaW50UGF0aHMiLCJpIiwiZmluZCIsIndhcm4iLCJfcmVuZGVyRmxhZyIsIkZMQUdfQ0hJTERSRU4iLCJwdXNoIiwidW5pcXVlQmluZFBvc2VzIiwiX2pvaW50TWF0cml4IiwidG9BcnJheSIsImpvaW50Q291bnQiLCJpbml0ZWQiLCJzeXMiLCJnZXRNYXhKb2ludE1hdHJpeFNpemUiLCJGbG9hdDMyQXJyYXkiLCJTVVBQT1JUX0ZMT0FUX1RFWFRVUkUiLCJnbEV4dGVuc2lvbiIsInNpemUiLCJwaXhlbEZvcm1hdCIsIlRleHR1cmUyRCIsIlBpeGVsRm9ybWF0IiwiUkdCQTMyRiIsIndpZHRoIiwiaGVpZ2h0IiwiVWludDhBcnJheSIsImJ1ZmZlciIsIlJHQkE4ODg4Iiwibm9kZSIsInRleHR1cmUiLCJORUFSRVNUIiwiRmlsdGVyIiwic2V0RmlsdGVycyIsImluaXRXaXRoRGF0YSIsImZvcm1hdCIsImltYWdlcyIsIl91cGRhdGVNYXRlcmlhbCIsInByb3RvdHlwZSIsImNhbGwiLCJtYXRlcmlhbHMiLCJnZXRNYXRlcmlhbHMiLCJtYXRlcmlhbCIsInNldFByb3BlcnR5IiwiZGVmaW5lIiwidW5kZWZpbmVkIiwiX3NldEpvaW50c0RhdGFXaXRoQXJyYXkiLCJpTWF0cml4IiwibWF0cml4QXJyYXkiLCJkYXRhIiwiX3NldEpvaW50c0RhdGFXaXRoTWF0cml4IiwibWF0cml4IiwibSIsIl9jb21taXRKb2ludHNEYXRhIiwidXBkYXRlIiwicHJlY29tcHV0ZUpvaW50TWF0cml4IiwiX2Fzc2VtYmxlciIsInNldFJlbmRlck5vZGUiLCJfY2FsSm9pbnRNYXRyaXgiLCJfY2FsUkdCQThXb3JsZE1hdHJpeCIsIl9jYWxXb3JsZE1hdHJpeCIsImJpbmRwb3NlcyIsImpvaW50TWF0cml4IiwibXVsdGlwbHkiLCJfdXBkYXRlV29ybGRNYXRyaXgiLCJyb290TWF0cml4IiwiX3dvcmxkTWF0cml4IiwiaW52Um9vdE1hdCIsImludmVydCIsImNhbGNKb2ludE1hdHJpeCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUF5QkE7Ozs7QUF6QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUsrQyx3QkFBTCxDQUE4Qi9DLENBQTlCLEVBQWlDeEQsT0FBakM7QUFDSDtBQUNKLEdBN1Q4QjtBQStUL0IwSCxFQUFBQSxlQS9UK0IsNkJBK1RaO0FBQ2YsUUFBSSxDQUFDLEtBQUtwRyxRQUFOLElBQWtCLENBQUMsS0FBS00sUUFBNUIsRUFBc0M7O0FBRXRDLFNBQUtRLFFBQUwsQ0FBY3dELElBQWQsQ0FBbUIsSUFBbkI7O0FBQ0EsU0FBS2MsaUJBQUw7QUFDSDtBQXBVOEIsQ0FBVCxDQUExQjtBQXVVQXpHLEVBQUUsQ0FBQ0csbUJBQUgsR0FBeUJ1SCxNQUFNLENBQUNDLE9BQVAsR0FBaUJ4SCxtQkFBMUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuIENvcHlyaWdodCAoYykgMjAxNy0yMDE4IFhpYW1lbiBZYWppIFNvZnR3YXJlIENvLiwgTHRkLlxuXG4gaHR0cDovL3d3dy5jb2Nvcy5jb21cblxuIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGVuZ2luZSBzb3VyY2UgY29kZSAodGhlIFwiU29mdHdhcmVcIiksIGEgbGltaXRlZCxcbiAgd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gIG5vdCB1c2UgQ29jb3MgQ3JlYXRvciBzb2Z0d2FyZSBmb3IgZGV2ZWxvcGluZyBvdGhlciBzb2Z0d2FyZSBvciB0b29scyB0aGF0J3NcbiAgdXNlZCBmb3IgZGV2ZWxvcGluZyBnYW1lcy4gWW91IGFyZSBub3QgZ3JhbnRlZCB0byBwdWJsaXNoLCBkaXN0cmlidXRlLFxuICBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCBNYXQ0IGZyb20gJy4uLy4uL3ZhbHVlLXR5cGVzL21hdDQnO1xuY29uc3QgU2tlbGV0b24gPSByZXF1aXJlKCcuL0NDU2tlbGV0b24nKTtcbmNvbnN0IE1lc2hSZW5kZXJlciA9IHJlcXVpcmUoJy4uLy4uL21lc2gvQ0NNZXNoUmVuZGVyZXInKTtcbmNvbnN0IFJlbmRlckZsb3cgPSByZXF1aXJlKCcuLi8uLi9yZW5kZXJlci9yZW5kZXItZmxvdycpO1xuY29uc3QgZW51bXMgPSByZXF1aXJlKCcuLi8uLi8uLi9yZW5kZXJlci9lbnVtcycpO1xuXG5sZXQgX200X3RtcCA9IGNjLm1hdDQoKTtcbmxldCBfbTRfdG1wMiA9IGNjLm1hdDQoKTtcblxuLyoqXG4gKiAhI2VuXG4gKiBTa2lubmVkIE1lc2ggUmVuZGVyZXJcbiAqICEjemhcbiAqIOiSmeearua4suafk+e7hOS7tlxuICogQGNsYXNzIFNraW5uZWRNZXNoUmVuZGVyZXJcbiAqIEBleHRlbmRzIE1lc2hSZW5kZXJlclxuICovXG5sZXQgU2tpbm5lZE1lc2hSZW5kZXJlciA9IGNjLkNsYXNzKHtcbiAgICBuYW1lOiAnY2MuU2tpbm5lZE1lc2hSZW5kZXJlcicsXG4gICAgZXh0ZW5kczogTWVzaFJlbmRlcmVyLFxuXG4gICAgZWRpdG9yOiBDQ19FRElUT1IgJiYge1xuICAgICAgICBtZW51OiAnaTE4bjpNQUlOX01FTlUuY29tcG9uZW50Lm1lc2gvU2tpbm5lZCBNZXNoIFJlbmRlcmVyJyxcbiAgICB9LFxuXG4gICAgY3RvciAoKSB7XG4gICAgICAgIHRoaXMuX2pvaW50c0RhdGEgPSB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSA9IG51bGw7XG4gICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmUgPSBudWxsO1xuICAgICAgICB0aGlzLl9qb2ludHMgPSBbXTtcbiAgICAgICAgdGhpcy5fZHVtbXlOb2RlID0gbmV3IGNjLk5vZGUoKTtcbiAgICAgICAgdGhpcy5fam9pbnRzVGV4dHVyZU9wdGlvbnMgPSBudWxsO1xuICAgICAgICB0aGlzLl91c2luZ1JHQkE4VGV4dHVyZSA9IGZhbHNlO1xuICAgIH0sXG5cbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIF9za2VsZXRvbjogU2tlbGV0b24sXG4gICAgICAgIF9yb290Qm9uZTogY2MuTm9kZSxcblxuICAgICAgICAvKipcbiAgICAgICAgICogISNlblxuICAgICAgICAgKiBTa2VsZXRvbiBBc3NldFxuICAgICAgICAgKiAhI3poXG4gICAgICAgICAqIOmqqOmqvOi1hOa6kFxuICAgICAgICAgKiBAcHJvcGVydHkge1NrZWxldG9ufSBza2VsZXRvblxuICAgICAgICAgKi9cbiAgICAgICAgc2tlbGV0b246IHtcbiAgICAgICAgICAgIGdldCAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3NrZWxldG9uO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNldCAodmFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2tlbGV0b24gPSB2YWw7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHR5cGU6IFNrZWxldG9uXG4gICAgICAgIH0sXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqICEjZW5cbiAgICAgICAgICogUm9vdCBCb25lXG4gICAgICAgICAqICEjemhcbiAgICAgICAgICog6aqo6aq85qC56IqC54K5XG4gICAgICAgICAqIEBwcm9wZXJ0eSB7Tm9kZX0gcm9vdEJvbmVcbiAgICAgICAgICovXG4gICAgICAgIHJvb3RCb25lOiB7XG4gICAgICAgICAgICBnZXQgKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9yb290Qm9uZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQgKHZhbCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Jvb3RCb25lID0gdmFsO1xuICAgICAgICAgICAgICAgIHRoaXMuX2luaXQoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gU2tpbm5lZE1lc2hSZW5kZXJlciBjYW5ub3QgYmF0Y2hcbiAgICAgICAgZW5hYmxlQXV0b0JhdGNoOiB7XG4gICAgICAgICAgICBnZXQgKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIG92ZXJyaWRlOiB0cnVlXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX19wcmVsb2FkICgpIHtcbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICAgICAgdGhpcy5faW5pdCgpO1xuICAgIH0sXG5cbiAgICBfaW5pdCAoKSB7XG4gICAgICAgIHRoaXMuX21vZGVsID0gdGhpcy5fc2tlbGV0b24gJiYgdGhpcy5fc2tlbGV0b24ubW9kZWw7XG4gICAgICAgIHRoaXMuX2NhbEZ1bmMgPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5faW5pdEpvaW50cygpO1xuICAgICAgICB0aGlzLl9pbml0Sm9pbnRzVGV4dHVyZSgpO1xuICAgICAgICB0aGlzLl9pbml0Q2FsY0Z1bmMoKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlUmVuZGVyTm9kZSgpO1xuICAgIH0sXG5cbiAgICBfY2FsY1dvcmxkTWF0cml4VG9Sb290IChqb2ludCkge1xuICAgICAgICBsZXQgd29ybGRNYXRyaXhUb1Jvb3QgPSBqb2ludC5fd29ybGRNYXRyaXhUb1Jvb3Q7XG4gICAgICAgIGlmICghd29ybGRNYXRyaXhUb1Jvb3QpIHtcbiAgICAgICAgICAgIGpvaW50Ll93b3JsZE1hdHJpeFRvUm9vdCA9IHdvcmxkTWF0cml4VG9Sb290ID0gY2MubWF0NCgpO1xuICAgICAgICAgICAgam9pbnQuZ2V0TG9jYWxNYXRyaXgod29ybGRNYXRyaXhUb1Jvb3QpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHBhcmVudCA9IGpvaW50LnBhcmVudDtcbiAgICAgICAgaWYgKHBhcmVudCAhPT0gdGhpcy5yb290Qm9uZSkge1xuICAgICAgICAgICAgaWYgKCFwYXJlbnQuX3dvcmxkTWF0cml4VG9Sb290KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY2FsY1dvcmxkTWF0cml4VG9Sb290KHBhcmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBNYXQ0Lm11bCh3b3JsZE1hdHJpeFRvUm9vdCwgcGFyZW50Ll93b3JsZE1hdHJpeFRvUm9vdCwgd29ybGRNYXRyaXhUb1Jvb3QpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF92YWxpZGF0ZVJlbmRlciAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fam9pbnRzRGF0YSkge1xuICAgICAgICAgICAgdGhpcy5kaXNhYmxlUmVuZGVyKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc3VwZXIoKTtcbiAgICB9LFxuXG4gICAgX2luaXRKb2ludHMgKCkge1xuICAgICAgICBsZXQgam9pbnRzID0gdGhpcy5fam9pbnRzO1xuICAgICAgICBqb2ludHMubGVuZ3RoID0gMDtcblxuICAgICAgICBpZiAoIXRoaXMuc2tlbGV0b24gfHwgIXRoaXMucm9vdEJvbmUpIHJldHVybjtcblxuICAgICAgICBsZXQgdXNlSm9pbnRNYXRyaXggPSB0aGlzLl91c2VKb2ludE1hdHJpeCgpO1xuXG4gICAgICAgIGxldCBqb2ludFBhdGhzID0gdGhpcy5za2VsZXRvbi5qb2ludFBhdGhzO1xuICAgICAgICBsZXQgcm9vdEJvbmUgPSB0aGlzLnJvb3RCb25lO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW50UGF0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGxldCBqb2ludCA9IGNjLmZpbmQoam9pbnRQYXRoc1tpXSwgcm9vdEJvbmUpO1xuICAgICAgICAgICAgaWYgKCFqb2ludCkge1xuICAgICAgICAgICAgICAgIGNjLndhcm4oJ0NhbiBub3QgZmluZCBqb2ludCBpbiByb290IGJvbmUgWyVzXSB3aXRoIHBhdGggWyVzXScsIHJvb3RCb25lLm5hbWUsIGpvaW50UGF0aHNbaV0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXNlSm9pbnRNYXRyaXgpIHtcbiAgICAgICAgICAgICAgICBqb2ludC5fcmVuZGVyRmxhZyAmPSB+UmVuZGVyRmxvdy5GTEFHX0NISUxEUkVOO1xuICAgICAgICAgICAgICAgIHRoaXMuX2NhbGNXb3JsZE1hdHJpeFRvUm9vdChqb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGpvaW50cy5wdXNoKGpvaW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1c2VKb2ludE1hdHJpeCkge1xuICAgICAgICAgICAgY29uc3QgdW5pcXVlQmluZFBvc2VzID0gdGhpcy5za2VsZXRvbi51bmlxdWVCaW5kUG9zZXM7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW50UGF0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsZXQgam9pbnQgPSBqb2ludHNbaV07XG4gICAgICAgICAgICAgICAgaWYgKHVuaXF1ZUJpbmRQb3Nlc1tpXSkge1xuICAgICAgICAgICAgICAgICAgICBNYXQ0Lm11bChfbTRfdG1wLCBqb2ludC5fd29ybGRNYXRyaXhUb1Jvb3QsIHVuaXF1ZUJpbmRQb3Nlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIGpvaW50Ll9qb2ludE1hdHJpeCA9IE1hdDQudG9BcnJheShbXSwgX200X3RtcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqb2ludC5fam9pbnRNYXRyaXggPSBqb2ludC5fd29ybGRNYXRyaXhUb1Jvb3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0Sm9pbnRzVGV4dHVyZSAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fc2tlbGV0b24pIHJldHVybjtcblxuICAgICAgICBsZXQgam9pbnRDb3VudCA9IHRoaXMuX2pvaW50cy5sZW5ndGg7XG5cbiAgICAgICAgbGV0IGluaXRlZCA9IGZhbHNlO1xuICAgICAgICBpZiAoam9pbnRDb3VudCA8PSBjYy5zeXMuZ2V0TWF4Sm9pbnRNYXRyaXhTaXplKCkpIHtcbiAgICAgICAgICAgIGluaXRlZCA9IHRydWU7XG5cbiAgICAgICAgICAgIHRoaXMuX2pvaW50c0RhdGEgPSB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoam9pbnRDb3VudCAqIDE2KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghaW5pdGVkKSB7XG4gICAgICAgICAgICBsZXQgU1VQUE9SVF9GTE9BVF9URVhUVVJFID0gISFjYy5zeXMuZ2xFeHRlbnNpb24oJ09FU190ZXh0dXJlX2Zsb2F0Jyk7XG4gICAgICAgICAgICBsZXQgc2l6ZTtcbiAgICAgICAgICAgIGlmIChqb2ludENvdW50ID4gMjU2KSB7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IDY0O1xuICAgICAgICAgICAgfSBlbHNlIGlmIChqb2ludENvdW50ID4gNjQpIHtcbiAgICAgICAgICAgICAgICBzaXplID0gMzI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGpvaW50Q291bnQgPiAxNikge1xuICAgICAgICAgICAgICAgIHNpemUgPSAxNjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgc2l6ZSA9IDg7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2pvaW50c0RhdGEgPSB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSA9IG5ldyBGbG9hdDMyQXJyYXkoc2l6ZSAqIHNpemUgKiA0KTtcblxuICAgICAgICAgICAgbGV0IHBpeGVsRm9ybWF0ID0gY2MuVGV4dHVyZTJELlBpeGVsRm9ybWF0LlJHQkEzMkYsIFxuICAgICAgICAgICAgICAgIHdpZHRoID0gc2l6ZSwgXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gc2l6ZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCFTVVBQT1JUX0ZMT0FUX1RFWFRVUkUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9qb2ludHNEYXRhID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5fam9pbnRzRmxvYXQzMkRhdGEuYnVmZmVyKTtcbiAgICAgICAgICAgICAgICBwaXhlbEZvcm1hdCA9IGNjLlRleHR1cmUyRC5QaXhlbEZvcm1hdC5SR0JBODg4ODtcbiAgICAgICAgICAgICAgICB3aWR0aCAqPSA0O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fdXNpbmdSR0JBOFRleHR1cmUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgY2Mud2FybihgU2tpbm5lZE1lc2hSZW5kZXJlciBbJHt0aGlzLm5vZGUubmFtZX1dIGhhcyB0b28gbWFueSBqb2ludHMgWyR7am9pbnRDb3VudH1dIGFuZCBkZXZpY2UgZG8gbm90IHN1cHBvcnQgZmxvYXQzMiB0ZXh0dXJlLCBmYWxsYmFjayB0byB1c2UgUkdCQTg4ODggdGV4dHVyZSwgd2hpY2ggaXMgbXVjaCBzbG93ZXIuYCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCB0ZXh0dXJlID0gdGhpcy5fam9pbnRzVGV4dHVyZSB8fCBuZXcgY2MuVGV4dHVyZTJEKCk7XG4gICAgICAgICAgICBsZXQgTkVBUkVTVCA9IGNjLlRleHR1cmUyRC5GaWx0ZXIuTkVBUkVTVDtcbiAgICAgICAgICAgIHRleHR1cmUuc2V0RmlsdGVycyhORUFSRVNULCBORUFSRVNUKTtcbiAgICAgICAgICAgIHRleHR1cmUuaW5pdFdpdGhEYXRhKHRoaXMuX2pvaW50c0RhdGEsIHBpeGVsRm9ybWF0LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICAgIHRoaXMuX2pvaW50c1RleHR1cmUgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgdGhpcy5fam9pbnRzVGV4dHVyZU9wdGlvbnMgPSB7XG4gICAgICAgICAgICAgICAgZm9ybWF0OiBwaXhlbEZvcm1hdCwgXG4gICAgICAgICAgICAgICAgd2lkdGg6IHRleHR1cmUud2lkdGgsIFxuICAgICAgICAgICAgICAgIGhlaWdodDogdGV4dHVyZS5oZWlnaHQsIFxuICAgICAgICAgICAgICAgIGltYWdlczpbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3VwZGF0ZU1hdGVyaWFsKCk7XG4gICAgfSxcblxuICAgIF91cGRhdGVNYXRlcmlhbCAoKSB7XG4gICAgICAgIE1lc2hSZW5kZXJlci5wcm90b3R5cGUuX3VwZGF0ZU1hdGVyaWFsLmNhbGwodGhpcyk7XG5cbiAgICAgICAgbGV0IG1hdGVyaWFscyA9IHRoaXMuZ2V0TWF0ZXJpYWxzKCk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0ZXJpYWxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgbWF0ZXJpYWwgPSBtYXRlcmlhbHNbaV07XG4gICAgICAgICAgICBpZiAodGhpcy5fam9pbnRzVGV4dHVyZSkge1xuICAgICAgICAgICAgICAgIG1hdGVyaWFsLnNldFByb3BlcnR5KCdqb2ludHNUZXh0dXJlJywgdGhpcy5fam9pbnRzVGV4dHVyZSk7XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWwuc2V0UHJvcGVydHkoJ2pvaW50c1RleHR1cmVTaXplJywgbmV3IEZsb2F0MzJBcnJheShbdGhpcy5fam9pbnRzVGV4dHVyZS53aWR0aCwgdGhpcy5fam9pbnRzVGV4dHVyZS5oZWlnaHRdKSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgbWF0ZXJpYWwuZGVmaW5lKCdDQ19KT0lOVFNfVEVYVFVSRV9GTE9BVDMyJywgISFjYy5zeXMuZ2xFeHRlbnNpb24oJ09FU190ZXh0dXJlX2Zsb2F0JykpO1xuICAgICAgICAgICAgICAgIG1hdGVyaWFsLmRlZmluZSgnQ0NfVVNFX0pPSU5UU19URVhUUlVFJywgdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fam9pbnRzRmxvYXQzMkRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWwuc2V0UHJvcGVydHkoJ2pvaW50TWF0cmljZXMnLCB0aGlzLl9qb2ludHNGbG9hdDMyRGF0YSwgdW5kZWZpbmVkLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbWF0ZXJpYWwuZGVmaW5lKCdDQ19VU0VfSk9JTlRTX1RFWFRSVUUnLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtYXRlcmlhbC5kZWZpbmUoJ0NDX1VTRV9TS0lOTklORycsIHRydWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9zZXRKb2ludHNEYXRhV2l0aEFycmF5IChpTWF0cml4LCBtYXRyaXhBcnJheSkge1xuICAgICAgICBsZXQgZGF0YSA9IHRoaXMuX2pvaW50c0Zsb2F0MzJEYXRhO1xuICAgICAgICBkYXRhLnNldChtYXRyaXhBcnJheSwgaU1hdHJpeCAqIDE2KTtcbiAgICB9LFxuXG4gICAgX3NldEpvaW50c0RhdGFXaXRoTWF0cml4IChpTWF0cml4LCBtYXRyaXgpIHtcbiAgICAgICAgdGhpcy5fam9pbnRzRmxvYXQzMkRhdGEuc2V0KG1hdHJpeC5tLCAxNiAqIGlNYXRyaXgpO1xuICAgIH0sXG5cbiAgICBfY29tbWl0Sm9pbnRzRGF0YSAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9qb2ludHNUZXh0dXJlKSB7XG4gICAgICAgICAgICB0aGlzLl9qb2ludHNUZXh0dXJlT3B0aW9ucy5pbWFnZXNbMF0gPSB0aGlzLl9qb2ludHNEYXRhO1xuICAgICAgICAgICAgdGhpcy5fam9pbnRzVGV4dHVyZS51cGRhdGUodGhpcy5fam9pbnRzVGV4dHVyZU9wdGlvbnMpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF91c2VKb2ludE1hdHJpeCAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9tb2RlbCAmJiB0aGlzLl9tb2RlbC5wcmVjb21wdXRlSm9pbnRNYXRyaXg7XG4gICAgfSxcblxuICAgIF91cGRhdGVSZW5kZXJOb2RlICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3VzZUpvaW50TWF0cml4KCkgfHwgdGhpcy5fdXNpbmdSR0JBOFRleHR1cmUpIHtcbiAgICAgICAgICAgIHRoaXMuX2Fzc2VtYmxlci5zZXRSZW5kZXJOb2RlKHRoaXMucm9vdEJvbmUpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9hc3NlbWJsZXIuc2V0UmVuZGVyTm9kZSh0aGlzLl9kdW1teU5vZGUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIF9pbml0Q2FsY0Z1bmMgKCkge1xuICAgICAgICBpZiAodGhpcy5fdXNlSm9pbnRNYXRyaXgoKSkge1xuICAgICAgICAgICAgdGhpcy5fY2FsRnVuYyA9IHRoaXMuX2NhbEpvaW50TWF0cml4O1xuICAgICAgICB9IFxuICAgICAgICBlbHNlIGlmICh0aGlzLl91c2luZ1JHQkE4VGV4dHVyZSkge1xuICAgICAgICAgICAgdGhpcy5fY2FsRnVuYyA9IHRoaXMuX2NhbFJHQkE4V29ybGRNYXRyaXg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jYWxGdW5jID0gdGhpcy5fY2FsV29ybGRNYXRyaXg7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgX2NhbEpvaW50TWF0cml4ICgpIHtcbiAgICAgICAgY29uc3Qgam9pbnRzID0gdGhpcy5fam9pbnRzO1xuICAgICAgICBjb25zdCBiaW5kcG9zZXMgPSB0aGlzLnNrZWxldG9uLmJpbmRwb3NlcztcbiAgICAgICAgY29uc3QgdW5pcXVlQmluZFBvc2VzID0gdGhpcy5za2VsZXRvbi51bmlxdWVCaW5kUG9zZXM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgam9pbnRzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgam9pbnQgPSBqb2ludHNbaV07XG4gICAgICAgICAgICBsZXQgam9pbnRNYXRyaXggPSBqb2ludC5fam9pbnRNYXRyaXg7XG5cbiAgICAgICAgICAgIGlmICh1bmlxdWVCaW5kUG9zZXNbaV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9zZXRKb2ludHNEYXRhV2l0aEFycmF5KGksIGpvaW50TWF0cml4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIE1hdDQubXVsdGlwbHkoX200X3RtcCwgam9pbnRNYXRyaXgsIGJpbmRwb3Nlc1tpXSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fc2V0Sm9pbnRzRGF0YVdpdGhNYXRyaXgoaSwgX200X3RtcCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gU29tZSBkZXZpY2UgcmdiYTggdGV4dHVyZSBwcmVjaXNpb24gaXMgbG93LCB3aGVuIGVuY29kZSBhIGJpZyBudW1iZXIgaXQgbWF5IGxvc3MgcHJlY2lzaW9uLlxuICAgIC8vIEludmVydCByb290IGJvbmUgbWF0cml4IGNhbiBlZmZlY3RpdmVseSBhdm9pZCBiaWcgcG9zaXRpb24gZW5jb2RlIGludG8gcmdiYTggdGV4dHVyZS5cbiAgICBfY2FsUkdCQThXb3JsZE1hdHJpeCAoKSB7XG4gICAgICAgIGNvbnN0IGpvaW50cyA9IHRoaXMuX2pvaW50cztcbiAgICAgICAgY29uc3QgYmluZHBvc2VzID0gdGhpcy5za2VsZXRvbi5iaW5kcG9zZXM7XG5cbiAgICAgICAgdGhpcy5yb290Qm9uZS5fdXBkYXRlV29ybGRNYXRyaXgoKTtcbiAgICAgICAgbGV0IHJvb3RNYXRyaXggPSB0aGlzLnJvb3RCb25lLl93b3JsZE1hdHJpeDtcbiAgICAgICAgbGV0IGludlJvb3RNYXQgPSBNYXQ0LmludmVydChfbTRfdG1wMiwgcm9vdE1hdHJpeCk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBqb2ludHMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGxldCBqb2ludCA9IGpvaW50c1tpXTtcbiAgICAgICAgICAgIGpvaW50Ll91cGRhdGVXb3JsZE1hdHJpeCgpO1xuXG4gICAgICAgICAgICBNYXQ0Lm11bHRpcGx5KF9tNF90bXAsIGludlJvb3RNYXQsIGpvaW50Ll93b3JsZE1hdHJpeCk7XG4gICAgICAgICAgICBNYXQ0Lm11bHRpcGx5KF9tNF90bXAsIF9tNF90bXAsIGJpbmRwb3Nlc1tpXSk7XG4gICAgICAgICAgICB0aGlzLl9zZXRKb2ludHNEYXRhV2l0aE1hdHJpeChpLCBfbTRfdG1wKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBfY2FsV29ybGRNYXRyaXggKCkge1xuICAgICAgICBjb25zdCBqb2ludHMgPSB0aGlzLl9qb2ludHM7XG4gICAgICAgIGNvbnN0IGJpbmRwb3NlcyA9IHRoaXMuc2tlbGV0b24uYmluZHBvc2VzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGpvaW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgbGV0IGpvaW50ID0gam9pbnRzW2ldO1xuXG4gICAgICAgICAgICBqb2ludC5fdXBkYXRlV29ybGRNYXRyaXgoKTtcbiAgICAgICAgICAgIE1hdDQubXVsdGlwbHkoX200X3RtcCwgam9pbnQuX3dvcmxkTWF0cml4LCBiaW5kcG9zZXNbaV0pO1xuICAgICAgICAgICAgdGhpcy5fc2V0Sm9pbnRzRGF0YVdpdGhNYXRyaXgoaSwgX200X3RtcCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgY2FsY0pvaW50TWF0cml4ICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLnNrZWxldG9uIHx8ICF0aGlzLnJvb3RCb25lKSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5fY2FsRnVuYy5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLl9jb21taXRKb2ludHNEYXRhKCk7XG4gICAgfVxufSk7XG5cbmNjLlNraW5uZWRNZXNoUmVuZGVyZXIgPSBtb2R1bGUuZXhwb3J0cyA9IFNraW5uZWRNZXNoUmVuZGVyZXI7XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==