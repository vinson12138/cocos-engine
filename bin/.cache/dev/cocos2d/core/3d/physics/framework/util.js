
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/core/3d/physics/framework/util.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports.stringfyVec3 = stringfyVec3;
exports.stringfyQuat = stringfyQuat;
exports.setWrap = setWrap;
exports.getWrap = getWrap;
exports.clearNodeTransformDirtyFlag = clearNodeTransformDirtyFlag;
exports.clearNodeTransformRecord = clearNodeTransformRecord;
exports.updateWorldTransform = updateWorldTransform;
exports.updateWorldRT = updateWorldRT;
exports.worldDirty = worldDirty;

/****************************************************************************
 Copyright (c) 2019 Xiamen Yaji Software Co., Ltd.

 https://www.cocos.com/

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated engine source code (the "Software"), a limited,
 worldwide, royalty-free, non-assignable, revocable and non-exclusive license
 to use Cocos Creator solely to develop games on your target platforms. You shall
 not use Cocos Creator software for developing other software or tools that's
 used for developing games. You are not granted to publish, distribute,
 sublicense, and/or sell copies of Cocos Creator.

 The software or tools in this License Agreement are licensed, not sold.
 Xiamen Yaji Software Co., Ltd. reserves all rights not expressly granted to you.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 ****************************************************************************/
function stringfyVec3(value) {
  return "(x: " + value.x + ", y: " + value.y + ", z: " + value.z + ")";
}

function stringfyQuat(value) {
  return "(x: " + value.x + ", y: " + value.y + ", z: " + value.z + ", w: " + value.w + ")";
}

function setWrap(object, wrapper) {
  object.__cc_wrapper__ = wrapper;
}

function getWrap(object) {
  return object.__cc_wrapper__;
}

var LocalDirtyFlag = cc.Node._LocalDirtyFlag;
var PHYSICS_TRS = LocalDirtyFlag.PHYSICS_TRS;
var ALL_TRS = LocalDirtyFlag.ALL_TRS;
var SKEW = LocalDirtyFlag.SKEW;
var FLAG_TRANSFORM = cc.RenderFlow.FLAG_TRANSFORM;
var Mat3 = cc.Mat3;
var Mat4 = cc.Mat4;
var Vec3 = cc.Vec3;
var Quat = cc.Quat;
var Trs = cc.Trs;
var _nodeArray = [];

var _lpos = cc.v3();

var _lrot = cc.quat();

var _mat3 = new Mat3();

var _mat3m = _mat3.m;

var _quat = cc.quat();

var _mat4 = cc.mat4();

var _nodeTransformRecord = {};

function clearNodeTransformDirtyFlag() {
  for (var key in _nodeTransformRecord) {
    var physicsNode = _nodeTransformRecord[key];
    physicsNode._localMatDirty &= ~ALL_TRS;

    if (!(physicsNode._localMatDirty & SKEW)) {
      physicsNode._worldMatDirty = false;
      !CC_NATIVERENDERER && (physicsNode._renderFlag &= ~FLAG_TRANSFORM);
    }
  }

  _nodeTransformRecord = {};
  _nodeArray.length = 0;
}

function clearNodeTransformRecord() {
  _nodeTransformRecord = {};
  _nodeArray.length = 0;
}
/*
 * The method of node backtrace is used to optimize the calculation of global transformation. 
 * Node backtrace is continuous until the parent node is empty or the parent node has performed the calculation of global transformation.
 * The result of backtrace will store the node relational chain in the array. 
 * The process of traversing array is equivalent to the process of global transformation from the parent node to the physical node.
 * The calculated results are saved in the node, and the physical global transformation flag will be erased finally.
 */


function updateWorldTransform(node, traverseAllNode) {
  if (traverseAllNode === void 0) {
    traverseAllNode = false;
  }

  var cur = node;
  var i = 0;
  var needUpdateTransform = false;
  var physicsDirtyFlag = 0;

  while (cur) {
    // If current node transform has been calculated
    if (traverseAllNode || !_nodeTransformRecord[cur._id]) {
      _nodeArray[i++] = cur;
    } else {
      // Current node's transform has beed calculated
      physicsDirtyFlag |= cur._localMatDirty & PHYSICS_TRS;
      needUpdateTransform = needUpdateTransform || !!physicsDirtyFlag;
      break;
    }

    if (cur._localMatDirty & PHYSICS_TRS) {
      needUpdateTransform = true;
    }

    cur = cur._parent;
  }

  if (!needUpdateTransform) {
    return false;
  }

  var child;
  var childWorldMat, curWorldMat, childTrs, childLocalMat;
  var wpos, wrot, wscale;
  _nodeArray.length = i;

  while (i) {
    child = _nodeArray[--i];
    !traverseAllNode && (_nodeTransformRecord[child._id] = child);
    childWorldMat = child._worldMatrix;
    childLocalMat = child._matrix;
    childTrs = child._trs;
    wpos = child.__wpos = child.__wpos || cc.v3();
    wrot = child.__wrot = child.__wrot || cc.quat();
    wscale = child.__wscale = child.__wscale || cc.v3();

    if (child._localMatDirty & PHYSICS_TRS) {
      Trs.toMat4(childLocalMat, childTrs);
    }

    child._localMatDirty |= physicsDirtyFlag;
    physicsDirtyFlag |= child._localMatDirty & PHYSICS_TRS;

    if (!(physicsDirtyFlag & PHYSICS_TRS)) {
      cur = child;
      continue;
    }

    if (cur) {
      curWorldMat = cur._worldMatrix;
      Trs.toPosition(_lpos, childTrs);
      Vec3.transformMat4(wpos, _lpos, curWorldMat);
      Mat4.multiply(childWorldMat, curWorldMat, childLocalMat);
      Trs.toRotation(_lrot, childTrs);
      Quat.multiply(wrot, cur.__wrot, _lrot);
      Mat3.fromQuat(_mat3, Quat.conjugate(_quat, wrot));
      Mat3.multiplyMat4(_mat3, _mat3, childWorldMat);
      wscale.x = _mat3m[0];
      wscale.y = _mat3m[4];
      wscale.z = _mat3m[8];
    } else {
      Trs.toPosition(wpos, childTrs);
      Trs.toRotation(wrot, childTrs);
      Trs.toScale(wscale, childTrs);
      Mat4.copy(childWorldMat, childLocalMat);
    }

    cur = child;
  }

  return true;
}

function updateWorldRT(node, position, rotation) {
  var parent = node.parent;

  if (parent) {
    updateWorldTransform(parent, true);
    Vec3.transformMat4(_lpos, position, Mat4.invert(_mat4, parent._worldMatrix));
    Quat.multiply(_quat, Quat.conjugate(_quat, parent.__wrot), rotation);
    node.setPosition(_lpos);
    node.setRotation(_quat);
  } else {
    node.setPosition(position);
    node.setRotation(rotation);
  }
}

function worldDirty(node) {
  var cur = node;

  while (cur) {
    if (cur._worldMatDirty) return true;
    cur = cur._parent;
  }

  return false;
}
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9jb3JlLzNkL3BoeXNpY3MvZnJhbWV3b3JrL3V0aWwudHMiXSwibmFtZXMiOlsic3RyaW5nZnlWZWMzIiwidmFsdWUiLCJ4IiwieSIsInoiLCJzdHJpbmdmeVF1YXQiLCJ3Iiwic2V0V3JhcCIsIm9iamVjdCIsIndyYXBwZXIiLCJfX2NjX3dyYXBwZXJfXyIsImdldFdyYXAiLCJMb2NhbERpcnR5RmxhZyIsImNjIiwiTm9kZSIsIl9Mb2NhbERpcnR5RmxhZyIsIlBIWVNJQ1NfVFJTIiwiQUxMX1RSUyIsIlNLRVciLCJGTEFHX1RSQU5TRk9STSIsIlJlbmRlckZsb3ciLCJNYXQzIiwiTWF0NCIsIlZlYzMiLCJRdWF0IiwiVHJzIiwiX25vZGVBcnJheSIsIl9scG9zIiwidjMiLCJfbHJvdCIsInF1YXQiLCJfbWF0MyIsIl9tYXQzbSIsIm0iLCJfcXVhdCIsIl9tYXQ0IiwibWF0NCIsIl9ub2RlVHJhbnNmb3JtUmVjb3JkIiwiY2xlYXJOb2RlVHJhbnNmb3JtRGlydHlGbGFnIiwia2V5IiwicGh5c2ljc05vZGUiLCJfbG9jYWxNYXREaXJ0eSIsIl93b3JsZE1hdERpcnR5IiwiQ0NfTkFUSVZFUkVOREVSRVIiLCJfcmVuZGVyRmxhZyIsImxlbmd0aCIsImNsZWFyTm9kZVRyYW5zZm9ybVJlY29yZCIsInVwZGF0ZVdvcmxkVHJhbnNmb3JtIiwibm9kZSIsInRyYXZlcnNlQWxsTm9kZSIsImN1ciIsImkiLCJuZWVkVXBkYXRlVHJhbnNmb3JtIiwicGh5c2ljc0RpcnR5RmxhZyIsIl9pZCIsIl9wYXJlbnQiLCJjaGlsZCIsImNoaWxkV29ybGRNYXQiLCJjdXJXb3JsZE1hdCIsImNoaWxkVHJzIiwiY2hpbGRMb2NhbE1hdCIsIndwb3MiLCJ3cm90Iiwid3NjYWxlIiwiX3dvcmxkTWF0cml4IiwiX21hdHJpeCIsIl90cnMiLCJfX3dwb3MiLCJfX3dyb3QiLCJfX3dzY2FsZSIsInRvTWF0NCIsInRvUG9zaXRpb24iLCJ0cmFuc2Zvcm1NYXQ0IiwibXVsdGlwbHkiLCJ0b1JvdGF0aW9uIiwiZnJvbVF1YXQiLCJjb25qdWdhdGUiLCJtdWx0aXBseU1hdDQiLCJ0b1NjYWxlIiwiY29weSIsInVwZGF0ZVdvcmxkUlQiLCJwb3NpdGlvbiIsInJvdGF0aW9uIiwicGFyZW50IiwiaW52ZXJ0Iiwic2V0UG9zaXRpb24iLCJzZXRSb3RhdGlvbiIsIndvcmxkRGlydHkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlPLFNBQVNBLFlBQVQsQ0FBdUJDLEtBQXZCLEVBQWlEO0FBQ3BELGtCQUFjQSxLQUFLLENBQUNDLENBQXBCLGFBQTZCRCxLQUFLLENBQUNFLENBQW5DLGFBQTRDRixLQUFLLENBQUNHLENBQWxEO0FBQ0g7O0FBRU0sU0FBU0MsWUFBVCxDQUF1QkosS0FBdkIsRUFBaUQ7QUFDcEQsa0JBQWNBLEtBQUssQ0FBQ0MsQ0FBcEIsYUFBNkJELEtBQUssQ0FBQ0UsQ0FBbkMsYUFBNENGLEtBQUssQ0FBQ0csQ0FBbEQsYUFBMkRILEtBQUssQ0FBQ0ssQ0FBakU7QUFDSDs7QUFNTSxTQUFTQyxPQUFULENBQTJCQyxNQUEzQixFQUF3Q0MsT0FBeEMsRUFBMEQ7QUFDNURELEVBQUFBLE1BQUQsQ0FBOEJFLGNBQTlCLEdBQStDRCxPQUEvQztBQUNIOztBQUVNLFNBQVNFLE9BQVQsQ0FBMkJILE1BQTNCLEVBQXdDO0FBQzNDLFNBQVFBLE1BQUQsQ0FBOEJFLGNBQXJDO0FBQ0g7O0FBRUQsSUFBTUUsY0FBYyxHQUFHQyxFQUFFLENBQUNDLElBQUgsQ0FBUUMsZUFBL0I7QUFDQSxJQUFNQyxXQUFXLEdBQUdKLGNBQWMsQ0FBQ0ksV0FBbkM7QUFDQSxJQUFNQyxPQUFPLEdBQUdMLGNBQWMsQ0FBQ0ssT0FBL0I7QUFD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LEVBQW9DO0FBQ3ZDLE1BQUlFLEdBQUcsR0FBR0YsSUFBVjs7QUFDQSxTQUFPRSxHQUFQLEVBQVk7QUFDUixRQUFJQSxHQUFHLENBQUNSLGNBQVIsRUFBd0IsT0FBTyxJQUFQO0FBQ3hCUSxJQUFBQSxHQUFHLEdBQUdBLEdBQUcsQ0FBQ0ssT0FBVjtBQUNIOztBQUNELFNBQU8sS0FBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiBDb3B5cmlnaHQgKGMpIDIwMTkgWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbiBodHRwczovL3d3dy5jb2Nvcy5jb20vXG5cbiBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBlbmdpbmUgc291cmNlIGNvZGUgKHRoZSBcIlNvZnR3YXJlXCIpLCBhIGxpbWl0ZWQsXG4gd29ybGR3aWRlLCByb3lhbHR5LWZyZWUsIG5vbi1hc3NpZ25hYmxlLCByZXZvY2FibGUgYW5kIG5vbi1leGNsdXNpdmUgbGljZW5zZVxuIHRvIHVzZSBDb2NvcyBDcmVhdG9yIHNvbGVseSB0byBkZXZlbG9wIGdhbWVzIG9uIHlvdXIgdGFyZ2V0IHBsYXRmb3Jtcy4gWW91IHNoYWxsXG4gbm90IHVzZSBDb2NvcyBDcmVhdG9yIHNvZnR3YXJlIGZvciBkZXZlbG9waW5nIG90aGVyIHNvZnR3YXJlIG9yIHRvb2xzIHRoYXQnc1xuIHVzZWQgZm9yIGRldmVsb3BpbmcgZ2FtZXMuIFlvdSBhcmUgbm90IGdyYW50ZWQgdG8gcHVibGlzaCwgZGlzdHJpYnV0ZSxcbiBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgQ29jb3MgQ3JlYXRvci5cblxuIFRoZSBzb2Z0d2FyZSBvciB0b29scyBpbiB0aGlzIExpY2Vuc2UgQWdyZWVtZW50IGFyZSBsaWNlbnNlZCwgbm90IHNvbGQuXG4gWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuIHJlc2VydmVzIGFsbCByaWdodHMgbm90IGV4cHJlc3NseSBncmFudGVkIHRvIHlvdS5cblxuIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbiBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4gVEhFIFNPRlRXQVJFLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmltcG9ydCB7IElWZWMzTGlrZSwgSVF1YXRMaWtlIH0gZnJvbSAnLi4vc3BlYy9pLWNvbW1vbic7XG5cbmV4cG9ydCBmdW5jdGlvbiBzdHJpbmdmeVZlYzMgKHZhbHVlOiBJVmVjM0xpa2UpOiBzdHJpbmcge1xuICAgIHJldHVybiBgKHg6ICR7dmFsdWUueH0sIHk6ICR7dmFsdWUueX0sIHo6ICR7dmFsdWUuen0pYDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHN0cmluZ2Z5UXVhdCAodmFsdWU6IElRdWF0TGlrZSk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAoeDogJHt2YWx1ZS54fSwgeTogJHt2YWx1ZS55fSwgejogJHt2YWx1ZS56fSwgdzogJHt2YWx1ZS53fSlgO1xufVxuXG5pbnRlcmZhY2UgSVdyYXBwZWQ8VD4ge1xuICAgIF9fY2Nfd3JhcHBlcl9fOiBUO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0V3JhcDxXcmFwcGVyPiAob2JqZWN0OiBhbnksIHdyYXBwZXI6IFdyYXBwZXIpIHtcbiAgICAob2JqZWN0IGFzIElXcmFwcGVkPFdyYXBwZXI+KS5fX2NjX3dyYXBwZXJfXyA9IHdyYXBwZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRXcmFwPFdyYXBwZXI+IChvYmplY3Q6IGFueSkge1xuICAgIHJldHVybiAob2JqZWN0IGFzIElXcmFwcGVkPFdyYXBwZXI+KS5fX2NjX3dyYXBwZXJfXztcbn1cblxuY29uc3QgTG9jYWxEaXJ0eUZsYWcgPSBjYy5Ob2RlLl9Mb2NhbERpcnR5RmxhZztcbmNvbnN0IFBIWVNJQ1NfVFJTID0gTG9jYWxEaXJ0eUZsYWcuUEhZU0lDU19UUlM7XG5jb25zdCBBTExfVFJTID0gTG9jYWxEaXJ0eUZsYWcuQUxMX1RSUztcbmNvbnN0IFNLRVcgPSBMb2NhbERpcnR5RmxhZy5TS0VXO1xuY29uc3QgRkxBR19UUkFOU0ZPUk0gPSBjYy5SZW5kZXJGbG93LkZMQUdfVFJBTlNGT1JNO1xuXG5jb25zdCBNYXQzID0gY2MuTWF0MztcbmNvbnN0IE1hdDQgPSBjYy5NYXQ0O1xuY29uc3QgVmVjMyA9IGNjLlZlYzM7XG5jb25zdCBRdWF0ID0gY2MuUXVhdDtcbmNvbnN0IFRycyA9IGNjLlRycztcblxuY29uc3QgX25vZGVBcnJheTogQXJyYXk8Y2MuTm9kZT4gPSBbXTtcbmNvbnN0IF9scG9zID0gY2MudjMoKTtcbmNvbnN0IF9scm90ID0gY2MucXVhdCgpO1xuY29uc3QgX21hdDMgPSBuZXcgTWF0MygpO1xuY29uc3QgX21hdDNtID0gX21hdDMubTtcbmNvbnN0IF9xdWF0ID0gY2MucXVhdCgpO1xuY29uc3QgX21hdDQgPSBjYy5tYXQ0KCk7XG5cbmxldCBfbm9kZVRyYW5zZm9ybVJlY29yZCA9IHt9O1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyTm9kZVRyYW5zZm9ybURpcnR5RmxhZyAoKSB7XG4gICAgZm9yIChsZXQga2V5IGluIF9ub2RlVHJhbnNmb3JtUmVjb3JkKSB7XG4gICAgICAgIGxldCBwaHlzaWNzTm9kZSA9IF9ub2RlVHJhbnNmb3JtUmVjb3JkW2tleV07XG4gICAgICAgIHBoeXNpY3NOb2RlLl9sb2NhbE1hdERpcnR5ICY9IH5BTExfVFJTO1xuICAgICAgICBpZiAoIShwaHlzaWNzTm9kZS5fbG9jYWxNYXREaXJ0eSAmIFNLRVcpKSB7XG4gICAgICAgICAgICBwaHlzaWNzTm9kZS5fd29ybGRNYXREaXJ0eSA9IGZhbHNlO1xuICAgICAgICAgICAgIUNDX05BVElWRVJFTkRFUkVSICYmIChwaHlzaWNzTm9kZS5fcmVuZGVyRmxhZyAmPSB+RkxBR19UUkFOU0ZPUk0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9ub2RlVHJhbnNmb3JtUmVjb3JkID0ge307XG4gICAgX25vZGVBcnJheS5sZW5ndGggPSAwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJOb2RlVHJhbnNmb3JtUmVjb3JkICgpIHtcbiAgICBfbm9kZVRyYW5zZm9ybVJlY29yZCA9IHt9O1xuICAgIF9ub2RlQXJyYXkubGVuZ3RoID0gMDtcbn1cblxuLypcbiAqIFRoZSBtZXRob2Qgb2Ygbm9kZSBiYWNrdHJhY2UgaXMgdXNlZCB0byBvcHRpbWl6ZSB0aGUgY2FsY3VsYXRpb24gb2YgZ2xvYmFsIHRyYW5zZm9ybWF0aW9uLiBcbiAqIE5vZGUgYmFja3RyYWNlIGlzIGNvbnRpbnVvdXMgdW50aWwgdGhlIHBhcmVudCBub2RlIGlzIGVtcHR5IG9yIHRoZSBwYXJlbnQgbm9kZSBoYXMgcGVyZm9ybWVkIHRoZSBjYWxjdWxhdGlvbiBvZiBnbG9iYWwgdHJhbnNmb3JtYXRpb24uXG4gKiBUaGUgcmVzdWx0IG9mIGJhY2t0cmFjZSB3aWxsIHN0b3JlIHRoZSBub2RlIHJlbGF0aW9uYWwgY2hhaW4gaW4gdGhlIGFycmF5LiBcbiAqIFRoZSBwcm9jZXNzIG9mIHRyYXZlcnNpbmcgYXJyYXkgaXMgZXF1aXZhbGVudCB0byB0aGUgcHJvY2VzcyBvZiBnbG9iYWwgdHJhbnNmb3JtYXRpb24gZnJvbSB0aGUgcGFyZW50IG5vZGUgdG8gdGhlIHBoeXNpY2FsIG5vZGUuXG4gKiBUaGUgY2FsY3VsYXRlZCByZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgbm9kZSwgYW5kIHRoZSBwaHlzaWNhbCBnbG9iYWwgdHJhbnNmb3JtYXRpb24gZmxhZyB3aWxsIGJlIGVyYXNlZCBmaW5hbGx5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlV29ybGRUcmFuc2Zvcm0gKG5vZGU6IGNjLk5vZGUsIHRyYXZlcnNlQWxsTm9kZTogYm9vbGVhbiA9IGZhbHNlKSB7XG4gICAgbGV0IGN1ciA9IG5vZGU7XG4gICAgbGV0IGkgPSAwO1xuICAgIGxldCBuZWVkVXBkYXRlVHJhbnNmb3JtID0gZmFsc2U7XG4gICAgbGV0IHBoeXNpY3NEaXJ0eUZsYWcgPSAwO1xuICAgIHdoaWxlIChjdXIpIHtcbiAgICAgICAgLy8gSWYgY3VycmVudCBub2RlIHRyYW5zZm9ybSBoYXMgYmVlbiBjYWxjdWxhdGVkXG4gICAgICAgIGlmICh0cmF2ZXJzZUFsbE5vZGUgfHwgIV9ub2RlVHJhbnNmb3JtUmVjb3JkW2N1ci5faWRdKSB7XG4gICAgICAgICAgICBfbm9kZUFycmF5W2krK10gPSBjdXI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDdXJyZW50IG5vZGUncyB0cmFuc2Zvcm0gaGFzIGJlZWQgY2FsY3VsYXRlZFxuICAgICAgICAgICAgcGh5c2ljc0RpcnR5RmxhZyB8PSAoY3VyLl9sb2NhbE1hdERpcnR5ICYgUEhZU0lDU19UUlMpO1xuICAgICAgICAgICAgbmVlZFVwZGF0ZVRyYW5zZm9ybSA9IG5lZWRVcGRhdGVUcmFuc2Zvcm0gfHwgISFwaHlzaWNzRGlydHlGbGFnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1ci5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKSB7XG4gICAgICAgICAgICBuZWVkVXBkYXRlVHJhbnNmb3JtID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjdXIgPSBjdXIuX3BhcmVudDtcbiAgICB9XG4gICAgaWYgKCFuZWVkVXBkYXRlVHJhbnNmb3JtKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBsZXQgY2hpbGQ7XG4gICAgbGV0IGNoaWxkV29ybGRNYXQsIGN1cldvcmxkTWF0LCBjaGlsZFRycywgY2hpbGRMb2NhbE1hdDtcbiAgICBsZXQgd3Bvcywgd3JvdCwgd3NjYWxlO1xuXG4gICAgX25vZGVBcnJheS5sZW5ndGggPSBpO1xuICAgIHdoaWxlIChpKSB7XG4gICAgICAgIGNoaWxkID0gX25vZGVBcnJheVstLWldO1xuICAgICAgICAhdHJhdmVyc2VBbGxOb2RlICYmIChfbm9kZVRyYW5zZm9ybVJlY29yZFtjaGlsZC5faWRdID0gY2hpbGQpO1xuXG4gICAgICAgIGNoaWxkV29ybGRNYXQgPSBjaGlsZC5fd29ybGRNYXRyaXg7XG4gICAgICAgIGNoaWxkTG9jYWxNYXQgPSBjaGlsZC5fbWF0cml4O1xuICAgICAgICBjaGlsZFRycyA9IGNoaWxkLl90cnM7XG5cbiAgICAgICAgd3BvcyA9IGNoaWxkLl9fd3BvcyA9IGNoaWxkLl9fd3BvcyB8fCBjYy52MygpO1xuICAgICAgICB3cm90ID0gY2hpbGQuX193cm90ID0gY2hpbGQuX193cm90IHx8IGNjLnF1YXQoKTtcbiAgICAgICAgd3NjYWxlID0gY2hpbGQuX193c2NhbGUgPSBjaGlsZC5fX3dzY2FsZSB8fCBjYy52MygpO1xuXG4gICAgICAgIGlmIChjaGlsZC5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKSB7XG4gICAgICAgICAgICBUcnMudG9NYXQ0KGNoaWxkTG9jYWxNYXQsIGNoaWxkVHJzKTtcbiAgICAgICAgfVxuICAgICAgICBjaGlsZC5fbG9jYWxNYXREaXJ0eSB8PSBwaHlzaWNzRGlydHlGbGFnO1xuICAgICAgICBwaHlzaWNzRGlydHlGbGFnIHw9IChjaGlsZC5fbG9jYWxNYXREaXJ0eSAmIFBIWVNJQ1NfVFJTKTtcblxuICAgICAgICBpZiAoIShwaHlzaWNzRGlydHlGbGFnICYgUEhZU0lDU19UUlMpKSB7XG4gICAgICAgICAgICBjdXIgPSBjaGlsZDtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGN1cikge1xuICAgICAgICAgICAgY3VyV29ybGRNYXQgPSBjdXIuX3dvcmxkTWF0cml4O1xuICAgICAgICAgICAgVHJzLnRvUG9zaXRpb24oX2xwb3MsIGNoaWxkVHJzKTtcbiAgICAgICAgICAgIFZlYzMudHJhbnNmb3JtTWF0NCh3cG9zLCBfbHBvcywgY3VyV29ybGRNYXQpO1xuXG4gICAgICAgICAgICBNYXQ0Lm11bHRpcGx5KGNoaWxkV29ybGRNYXQsIGN1cldvcmxkTWF0LCBjaGlsZExvY2FsTWF0KTtcbiAgICAgICAgICAgIFRycy50b1JvdGF0aW9uKF9scm90LCBjaGlsZFRycyk7XG4gICAgICAgICAgICBRdWF0Lm11bHRpcGx5KHdyb3QsIGN1ci5fX3dyb3QsIF9scm90KTtcblxuICAgICAgICAgICAgTWF0My5mcm9tUXVhdChfbWF0MywgUXVhdC5jb25qdWdhdGUoX3F1YXQsIHdyb3QpKTtcbiAgICAgICAgICAgIE1hdDMubXVsdGlwbHlNYXQ0KF9tYXQzLCBfbWF0MywgY2hpbGRXb3JsZE1hdCk7XG4gICAgICAgICAgICB3c2NhbGUueCA9IF9tYXQzbVswXTtcbiAgICAgICAgICAgIHdzY2FsZS55ID0gX21hdDNtWzRdO1xuICAgICAgICAgICAgd3NjYWxlLnogPSBfbWF0M21bOF07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBUcnMudG9Qb3NpdGlvbih3cG9zLCBjaGlsZFRycyk7XG4gICAgICAgICAgICBUcnMudG9Sb3RhdGlvbih3cm90LCBjaGlsZFRycyk7XG4gICAgICAgICAgICBUcnMudG9TY2FsZSh3c2NhbGUsIGNoaWxkVHJzKTtcbiAgICAgICAgICAgIE1hdDQuY29weShjaGlsZFdvcmxkTWF0LCBjaGlsZExvY2FsTWF0KTtcbiAgICAgICAgfVxuICAgICAgICBjdXIgPSBjaGlsZDtcbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVXb3JsZFJUIChub2RlOiBjYy5Ob2RlLCBwb3NpdGlvbjogY2MuVmVjMywgcm90YXRpb246IGNjLlF1YXQpIHtcbiAgICBsZXQgcGFyZW50ID0gbm9kZS5wYXJlbnQ7XG4gICAgaWYgKHBhcmVudCkge1xuICAgICAgICB1cGRhdGVXb3JsZFRyYW5zZm9ybShwYXJlbnQsIHRydWUpO1xuICAgICAgICBWZWMzLnRyYW5zZm9ybU1hdDQoX2xwb3MsIHBvc2l0aW9uLCBNYXQ0LmludmVydChfbWF0NCwgcGFyZW50Ll93b3JsZE1hdHJpeCkpO1xuICAgICAgICBRdWF0Lm11bHRpcGx5KF9xdWF0LCBRdWF0LmNvbmp1Z2F0ZShfcXVhdCwgcGFyZW50Ll9fd3JvdCksIHJvdGF0aW9uKTtcbiAgICAgICAgbm9kZS5zZXRQb3NpdGlvbihfbHBvcyk7XG4gICAgICAgIG5vZGUuc2V0Um90YXRpb24oX3F1YXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG5vZGUuc2V0UG9zaXRpb24ocG9zaXRpb24pO1xuICAgICAgICBub2RlLnNldFJvdGF0aW9uKHJvdGF0aW9uKTtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3b3JsZERpcnR5IChub2RlOiBjYy5Ob2RlKSB7XG4gICAgbGV0IGN1ciA9IG5vZGU7XG4gICAgd2hpbGUgKGN1cikge1xuICAgICAgICBpZiAoY3VyLl93b3JsZE1hdERpcnR5KSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgY3VyID0gY3VyLl9wYXJlbnQ7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbiJdLCJzb3VyY2VSb290IjoiLyJ9