
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/core/base-renderer.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _memop = require("../memop");

var _enums = _interopRequireDefault(require("../enums"));

var _valueTypes = require("../../core/value-types");

var _programLib = _interopRequireDefault(require("./program-lib"));

var _view = _interopRequireDefault(require("./view"));

var _gfx = _interopRequireDefault(require("../gfx"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

// Copyright (c) 2017-2018 Xiamen Yaji Software Co., Ltd.
var _m4_tmp = new _valueTypes.Mat4();

var _stageInfos = new _memop.RecyclePool(function () {
  return {
    stage: null,
    items: null
  };
}, 8);

var _float2_pool = new _memop.RecyclePool(function () {
  return new Float32Array(2);
}, 8);

var _float3_pool = new _memop.RecyclePool(function () {
  return new Float32Array(3);
}, 8);

var _float4_pool = new _memop.RecyclePool(function () {
  return new Float32Array(4);
}, 8);

var _float9_pool = new _memop.RecyclePool(function () {
  return new Float32Array(9);
}, 8);

var _float16_pool = new _memop.RecyclePool(function () {
  return new Float32Array(16);
}, 8);

var _float64_pool = new _memop.RecyclePool(function () {
  return new Float32Array(64);
}, 8);

var _int2_pool = new _memop.RecyclePool(function () {
  return new Int32Array(2);
}, 8);

var _int3_pool = new _memop.RecyclePool(function () {
  return new Int32Array(3);
}, 8);

var _int4_pool = new _memop.RecyclePool(function () {
  return new Int32Array(4);
}, 8);

var _int64_pool = new _memop.RecyclePool(function () {
  return new Int32Array(64);
}, 8);

var Base = /*#__PURE__*/function () {
  /**
   * @param {gfx.Device} device
   * @param {Object} opts
   * @param {gfx.Texture2D} opts.defaultTexture
   * @param {gfx.TextureCube} opts.defaultTextureCube
   */
  function Base(device, opts) {
    var _this$_type2defaultVa;

    this._device = device;
    this._programLib = new _programLib["default"](device);
    this._opts = opts;
    this._type2defaultValue = (_this$_type2defaultVa = {}, _this$_type2defaultVa[_enums["default"].PARAM_INT] = 0, _this$_type2defaultVa[_enums["default"].PARAM_INT2] = new _valueTypes.Vec2(0, 0), _this$_type2defaultVa[_enums["default"].PARAM_INT3] = new _valueTypes.Vec3(0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_INT4] = new _valueTypes.Vec4(0, 0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT] = 0.0, _this$_type2defaultVa[_enums["default"].PARAM_FLOAT2] = new _valueTypes.Vec2(0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT3] = new _valueTypes.Vec3(0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_FLOAT4] = new _valueTypes.Vec4(0, 0, 0, 0), _this$_type2defaultVa[_enums["default"].PARAM_COLOR4] = new _valueTypes.Color(0, 0, 0, 1), _this$_type2defaultVa[_enums["default"].PARAM_MAT3] = new _valueTypes.Mat3(), _this$_type2defaultVa[_enums["default"].PARAM_MAT4] = new _valueTypes.Mat4(), _this$_type2defaultVa[_enums["default"].PARAM_TEXTURE_2D] = opts.defaultTexture, _this$_type2defaultVa[_enums["default"].PARAM_TEXTURE_CUBE] = opts.defaultTextureCube, _this$_type2defaultVa);
    this._stage2fn = {};
    this._usedTextureUnits = 0;
    this._viewPools = new _memop.RecyclePool(function () {
      return new _view["default"]();
    }, 8);
    this._drawItemsPools = new _memop.RecyclePool(function () {
      return {
        model: null,
        node: null,
        ia: null,
        effect: null,
        defines: null,
        uniforms: null
      };
    }, 100);
    this._stageItemsPools = new _memop.RecyclePool(function () {
      return new _memop.RecyclePool(function () {
        return {
          model: null,
          node: null,
          ia: null,
          effect: null,
          defines: null,
          passes: [],
          sortKey: -1,
          uniforms: null
        };
      }, 100);
    }, 16);
    this._definesChanged = false;
  }

  var _proto = Base.prototype;

  _proto._resetTextuerUnit = function _resetTextuerUnit() {
    this._usedTextureUnits = 0;
  };

  _proto._allocTextureUnit = function _allocTextureUnit() {
    var device = this._device;
    var unit = this._usedTextureUnits;

    if (unit >= device._caps.maxTextureUnits) {
      console.warn("Trying to use " + unit + " texture units while this GPU supports only " + device._caps.maxTextureUnits);
    }

    this._usedTextureUnits += 1;
    return unit;
  };

  _proto._registerStage = function _registerStage(name, fn) {
    this._stage2fn[name] = fn;
  };

  _proto.clear = function clear() {
    this._programLib.clear();

    this.reset();
  };

  _proto.reset = function reset() {
    this._viewPools.reset();

    this._stageItemsPools.reset();

    this._definesChanged = false;
  };

  _proto._requestView = function _requestView() {
    return this._viewPools.add();
  };

  _proto._render = function _render(view, scene) {
    var device = this._device; // setup framebuffer

    device.setFrameBuffer(view._framebuffer); // setup viewport

    device.setViewport(view._rect.x, view._rect.y, view._rect.w, view._rect.h); // setup clear

    var clearOpts = {};

    if (view._clearFlags & _enums["default"].CLEAR_COLOR) {
      clearOpts.color = _valueTypes.Vec4.toArray([], view._color);
    }

    if (view._clearFlags & _enums["default"].CLEAR_DEPTH) {
      clearOpts.depth = view._depth;
    }

    if (view._clearFlags & _enums["default"].CLEAR_STENCIL) {
      clearOpts.stencil = view._stencil;
    }

    device.clear(clearOpts); // get all draw items

    this._drawItemsPools.reset();

    for (var i = 0; i < scene._models.length; ++i) {
      var model = scene._models.data[i]; // filter model by view

      if ((model._cullingMask & view._cullingMask) === 0) {
        continue;
      }

      var drawItem = this._drawItemsPools.add();

      model.extractDrawItem(drawItem);
    } // dispatch draw items to different stage


    _stageInfos.reset();

    for (var _i = 0; _i < view._stages.length; ++_i) {
      var stage = view._stages[_i];

      var stageItems = this._stageItemsPools.add();

      stageItems.reset();

      for (var j = 0; j < this._drawItemsPools.length; ++j) {
        var _drawItem = this._drawItemsPools.data[j];
        var passes = _drawItem.effect.stagePasses[stage];
        if (!passes || passes.length === 0) continue;
        var stageItem = stageItems.add();
        stageItem.passes = passes;
        stageItem.model = _drawItem.model;
        stageItem.node = _drawItem.node;
        stageItem.ia = _drawItem.ia;
        stageItem.effect = _drawItem.effect;
        stageItem.defines = _drawItem.defines;
        stageItem.sortKey = -1;
        stageItem.uniforms = _drawItem.uniforms;
      }

      var stageInfo = _stageInfos.add();

      stageInfo.stage = stage;
      stageInfo.items = stageItems;
    } // render stages


    for (var _i2 = 0; _i2 < _stageInfos.length; ++_i2) {
      var info = _stageInfos.data[_i2];
      var fn = this._stage2fn[info.stage];
      fn(view, info.items);
    }
  };

  _proto._setProperty = function _setProperty(prop) {
    var device = this._device;
    var param = prop.value;

    if (param === undefined) {
      param = prop.val;
    }

    if (param === undefined) {
      param = this._type2defaultValue[prop.type];
    }

    if (param === undefined) {
      console.warn("Failed to set technique property " + prop.name + ", value not found.");
      return;
    }

    if (prop.type === _enums["default"].PARAM_TEXTURE_2D || prop.type === _enums["default"].PARAM_TEXTURE_CUBE) {
      if (Array.isArray(param)) {
        if (param.length > prop.count) {
          console.error("Failed to set property [" + prop.name + "] : The length of texture array [" + param.length + "] is bigger than [" + prop.count + "].");
          return;
        }

        var slots = _int64_pool.add();

        for (var index = 0; index < param.length; ++index) {
          slots[index] = this._allocTextureUnit();
        }

        device.setTextureArray(prop.name, param, slots);
      } else {
        device.setTexture(prop.name, param, this._allocTextureUnit());
      }
    } else {
      if (prop.directly) {
        device.setUniformDirectly(prop.name, param);
      } else {
        device.setUniform(prop.name, param);
      }
    }
  };

  _proto._draw = function _draw(item) {
    var device = this._device;
    var programLib = this._programLib;
    var node = item.node,
        ia = item.ia,
        passes = item.passes,
        effect = item.effect; // reset the pool
    // NOTE: we can use drawCounter optimize this
    // TODO: should be configurable

    _float2_pool.reset();

    _float3_pool.reset();

    _float4_pool.reset();

    _float9_pool.reset();

    _float16_pool.reset();

    _float64_pool.reset();

    _int2_pool.reset();

    _int3_pool.reset();

    _int4_pool.reset();

    _int64_pool.reset(); // set common uniforms
    // TODO: try commit this depends on effect
    // {


    node.getWorldMatrix(_m4_tmp);
    device.setUniform('cc_matWorld', _valueTypes.Mat4.toArray(_float16_pool.add(), _m4_tmp)); // let wq = node.getWorldRotation(cc.quat());

    _valueTypes.Mat4.invert(_m4_tmp, _m4_tmp);

    _valueTypes.Mat4.transpose(_m4_tmp, _m4_tmp);

    device.setUniform('cc_matWorldIT', _valueTypes.Mat4.toArray(_float16_pool.add(), _m4_tmp)); // }

    var defines = this._defines; // for each pass

    for (var i = 0; i < passes.length; ++i) {
      var pass = passes[i];

      if (this._definesChanged) {
        pass._programKey = null;
      }

      var count = ia.count; // set vertex buffer

      if (ia._vertexBuffer) {
        device.setVertexBuffer(0, ia._vertexBuffer);
      } // set index buffer


      if (ia._indexBuffer) {
        device.setIndexBuffer(ia._indexBuffer);
      } // set primitive type


      device.setPrimitiveType(ia._primitiveType); // set program

      Object.setPrototypeOf(defines, pass._defines);
      var program = programLib.getProgram(pass, defines, effect.name);
      device.setProgram(program);
      var uniforms = program._uniforms;
      var variants = pass._properties;

      for (var j = 0; j < uniforms.length; j++) {
        var prop = variants[uniforms[j].name];
        if (prop !== undefined) this._setProperty(prop);
      } // cull mode


      device.setCullMode(pass._cullMode); // blend

      if (pass._blend) {
        device.enableBlend();
        device.setBlendFuncSep(pass._blendSrc, pass._blendDst, pass._blendSrcAlpha, pass._blendDstAlpha);
        device.setBlendEqSep(pass._blendEq, pass._blendAlphaEq);
        device.setBlendColor32(pass._blendColor);
      } // depth test & write


      if (pass._depthTest) {
        device.enableDepthTest();
        device.setDepthFunc(pass._depthFunc);
      }

      if (pass._depthWrite) {
        device.enableDepthWrite();
      } // stencil


      device.setStencilTest(pass._stencilTest);

      if (pass._stencilTest === _gfx["default"].STENCIL_ENABLE) {
        // front
        device.setStencilFuncFront(pass._stencilFuncFront, pass._stencilRefFront, pass._stencilMaskFront);
        device.setStencilOpFront(pass._stencilFailOpFront, pass._stencilZFailOpFront, pass._stencilZPassOpFront, pass._stencilWriteMaskFront); // back

        device.setStencilFuncBack(pass._stencilFuncBack, pass._stencilRefBack, pass._stencilMaskBack);
        device.setStencilOpBack(pass._stencilFailOpBack, pass._stencilZFailOpBack, pass._stencilZPassOpBack, pass._stencilWriteMaskBack);
      } // draw pass


      device.draw(ia._start, count);

      this._resetTextuerUnit();
    }
  };

  return Base;
}();

exports["default"] = Base;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9jb3JlL2Jhc2UtcmVuZGVyZXIuanMiXSwibmFtZXMiOlsiX200X3RtcCIsIk1hdDQiLCJfc3RhZ2VJbmZvcyIsIlJlY3ljbGVQb29sIiwic3RhZ2UiLCJpdGVtcyIsIl9mbG9hdDJfcG9vbCIsIkZsb2F0MzJBcnJheSIsIl9mbG9hdDNfcG9vbCIsIl9mbG9hdDRfcG9vbCIsIl9mbG9hdDlfcG9vbCIsIl9mbG9hdDE2X3Bvb2wiLCJfZmxvYXQ2NF9wb29sIiwiX2ludDJfcG9vbCIsIkludDMyQXJyYXkiLCJfaW50M19wb29sIiwiX2ludDRfcG9vbCIsIl9pbnQ2NF9wb29sIiwiQmFzZSIsImRldmljZSIsIm9wdHMiLCJfZGV2aWNlIiwiX3Byb2dyYW1MaWIiLCJQcm9ncmFtTGliIiwiX29wdHMiLCJfdHlwZTJkZWZhdWx0VmFsdWUiLCJlbnVtcyIsIlBBUkFNX0lOVCIsIlBBUkFNX0lOVDIiLCJWZWMyIiwiUEFSQU1fSU5UMyIsIlZlYzMiLCJQQVJBTV9JTlQ0IiwiVmVjNCIsIlBBUkFNX0ZMT0FUIiwiUEFSQU1fRkxPQVQyIiwiUEFSQU1fRkxPQVQzIiwiUEFSQU1fRkxPQVQ0IiwiUEFSQU1fQ09MT1I0IiwiQ29sb3IiLCJQQVJBTV9NQVQzIiwiTWF0MyIsIlBBUkFNX01BVDQiLCJQQVJBTV9URVhUVVJFXzJEIiwiZGVmYXVsdFRleHR1cmUiLCJQQVJBTV9URVhUVVJFX0NVQkUiLCJkZWZhdWx0VGV4dHVyZUN1YmUiLCJfc3RhZ2UyZm4iLCJfdXNlZFRleHR1cmVVbml0cyIsIl92aWV3UG9vbHMiLCJWaWV3IiwiX2RyYXdJdGVtc1Bvb2xzIiwibW9kZWwiLCJub2RlIiwiaWEiLCJlZmZlY3QiLCJkZWZpbmVzIiwidW5pZm9ybXMiLCJfc3RhZ2VJdGVtc1Bvb2xzIiwicGFzc2VzIiwic29ydEtleSIsIl9kZWZpbmVzQ2hhbmdlZCIsIl9yZXNldFRleHR1ZXJVbml0IiwiX2FsbG9jVGV4dHVyZVVuaXQiLCJ1bml0IiwiX2NhcHMiLCJtYXhUZXh0dXJlVW5pdHMiLCJjb25zb2xlIiwid2FybiIsIl9yZWdpc3RlclN0YWdlIiwibmFtZSIsImZuIiwiY2xlYXIiLCJyZXNldCIsIl9yZXF1ZXN0VmlldyIsImFkZCIsIl9yZW5kZXIiLCJ2aWV3Iiwic2NlbmUiLCJzZXRGcmFtZUJ1ZmZlciIsIl9mcmFtZWJ1ZmZlciIsInNldFZpZXdwb3J0IiwiX3JlY3QiLCJ4IiwieSIsInciLCJoIiwiY2xlYXJPcHRzIiwiX2NsZWFyRmxhZ3MiLCJDTEVBUl9DT0xPUiIsImNvbG9yIiwidG9BcnJheSIsIl9jb2xvciIsIkNMRUFSX0RFUFRIIiwiZGVwdGgiLCJfZGVwdGgiLCJDTEVBUl9TVEVOQ0lMIiwic3RlbmNpbCIsIl9zdGVuY2lsIiwiaSIsIl9tb2RlbHMiLCJsZW5ndGgiLCJkYXRhIiwiX2N1bGxpbmdNYXNrIiwiZHJhd0l0ZW0iLCJleHRyYWN0RHJhd0l0ZW0iLCJfc3RhZ2VzIiwic3RhZ2VJdGVtcyIsImoiLCJzdGFnZVBhc3NlcyIsInN0YWdlSXRlbSIsInN0YWdlSW5mbyIsImluZm8iLCJfc2V0UHJvcGVydHkiLCJwcm9wIiwicGFyYW0iLCJ2YWx1ZSIsInVuZGVmaW5lZCIsInZhbCIsInR5cGUiLCJBcnJheSIsImlzQXJyYXkiLCJjb3VudCIsImVycm9yIiwic2xvdHMiLCJpbmRleCIsInNldFRleHR1cmVBcnJheSIsInNldFRleHR1cmUiLCJkaXJlY3RseSIsInNldFVuaWZvcm1EaXJlY3RseSIsInNldFVuaWZvcm0iLCJfZHJhdyIsIml0ZW0iLCJwcm9ncmFtTGliIiwiZ2V0V29ybGRNYXRyaXgiLCJpbnZlcnQiLCJ0cmFuc3Bvc2UiLCJfZGVmaW5lcyIsInBhc3MiLCJfcHJvZ3JhbUtleSIsIl92ZXJ0ZXhCdWZmZXIiLCJzZXRWZXJ0ZXhCdWZmZXIiLCJfaW5kZXhCdWZmZXIiLCJzZXRJbmRleEJ1ZmZlciIsInNldFByaW1pdGl2ZVR5cGUiLCJfcHJpbWl0aXZlVHlwZSIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwicHJvZ3JhbSIsImdldFByb2dyYW0iLCJzZXRQcm9ncmFtIiwiX3VuaWZvcm1zIiwidmFyaWFudHMiLCJfcHJvcGVydGllcyIsInNldEN1bGxNb2RlIiwiX2N1bGxNb2RlIiwiX2JsZW5kIiwiZW5hYmxlQmxlbmQiLCJzZXRCbGVuZEZ1bmNTZXAiLCJfYmxlbmRTcmMiLCJfYmxlbmREc3QiLCJfYmxlbmRTcmNBbHBoYSIsIl9ibGVuZERzdEFscGhhIiwic2V0QmxlbmRFcVNlcCIsIl9ibGVuZEVxIiwiX2JsZW5kQWxwaGFFcSIsInNldEJsZW5kQ29sb3IzMiIsIl9ibGVuZENvbG9yIiwiX2RlcHRoVGVzdCIsImVuYWJsZURlcHRoVGVzdCIsInNldERlcHRoRnVuYyIsIl9kZXB0aEZ1bmMiLCJfZGVwdGhXcml0ZSIsImVuYWJsZURlcHRoV3JpdGUiLCJzZXRTdGVuY2lsVGVzdCIsIl9zdGVuY2lsVGVzdCIsImdmeCIsIlNURU5DSUxfRU5BQkxFIiwic2V0U3RlbmNpbEZ1bmNGcm9udCIsIl9zdGVuY2lsRnVuY0Zyb250IiwiX3N0ZW5jaWxSZWZGcm9udCIsIl9zdGVuY2lsTWFza0Zyb250Iiwic2V0U3RlbmNpbE9wRnJvbnQiLCJfc3RlbmNpbEZhaWxPcEZyb250IiwiX3N0ZW5jaWxaRmFpbE9wRnJvbnQiLCJfc3RlbmNpbFpQYXNzT3BGcm9udCIsIl9zdGVuY2lsV3JpdGVNYXNrRnJvbnQiLCJzZXRTdGVuY2lsRnVuY0JhY2siLCJfc3RlbmNpbEZ1bmNCYWNrIiwiX3N0ZW5jaWxSZWZCYWNrIiwiX3N0ZW5jaWxNYXNrQmFjayIsInNldFN0ZW5jaWxPcEJhY2siLCJfc3RlbmNpbEZhaWxPcEJhY2siLCJfc3RlbmNpbFpGYWlsT3BCYWNrIiwiX3N0ZW5jaWxaUGFzc09wQmFjayIsIl9zdGVuY2lsV3JpdGVNYXNrQmFjayIsImRyYXciLCJfc3RhcnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQVBBO0FBU0EsSUFB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QkFEUCxFQUVFekMsSUFBSSxDQUFDMEMsZ0JBRlAsRUFHRTFDLElBQUksQ0FBQzJDLGlCQUhQO0FBS0FsSyxRQUFBQSxNQUFNLENBQUNtSyxpQkFBUCxDQUNFNUMsSUFBSSxDQUFDNkMsbUJBRFAsRUFFRTdDLElBQUksQ0FBQzhDLG9CQUZQLEVBR0U5QyxJQUFJLENBQUMrQyxvQkFIUCxFQUlFL0MsSUFBSSxDQUFDZ0Qsc0JBSlAsRUFQNEMsQ0FjNUM7O0FBQ0F2SyxRQUFBQSxNQUFNLENBQUN3SyxrQkFBUCxDQUNFakQsSUFBSSxDQUFDa0QsZ0JBRFAsRUFFRWxELElBQUksQ0FBQ21ELGVBRlAsRUFHRW5ELElBQUksQ0FBQ29ELGdCQUhQO0FBS0EzSyxRQUFBQSxNQUFNLENBQUM0SyxnQkFBUCxDQUNFckQsSUFBSSxDQUFDc0Qsa0JBRFAsRUFFRXRELElBQUksQ0FBQ3VELG1CQUZQLEVBR0V2RCxJQUFJLENBQUN3RCxtQkFIUCxFQUlFeEQsSUFBSSxDQUFDeUQscUJBSlA7QUFNRCxPQTdGcUMsQ0ErRnRDOzs7QUFDQWhMLE1BQUFBLE1BQU0sQ0FBQ2lMLElBQVAsQ0FBWTlJLEVBQUUsQ0FBQytJLE1BQWYsRUFBdUIzRSxLQUF2Qjs7QUFFQSxXQUFLNUQsaUJBQUw7QUFDRDtBQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE3LTIwMTggWGlhbWVuIFlhamkgU29mdHdhcmUgQ28uLCBMdGQuXG5cbmltcG9ydCB7IFJlY3ljbGVQb29sIH0gZnJvbSAnLi4vbWVtb3AnO1xuaW1wb3J0IGVudW1zIGZyb20gJy4uL2VudW1zJztcbmltcG9ydCB7IFZlYzIsIFZlYzQsIE1hdDMsIE1hdDQsIENvbG9yLCBWZWMzIH0gZnJvbSAnLi4vLi4vY29yZS92YWx1ZS10eXBlcyc7XG5pbXBvcnQgUHJvZ3JhbUxpYiBmcm9tICcuL3Byb2dyYW0tbGliJztcbmltcG9ydCBWaWV3IGZyb20gJy4vdmlldyc7XG5pbXBvcnQgZ2Z4IGZyb20gJy4uL2dmeCc7XG5cbmxldCBfbTRfdG1wID0gbmV3IE1hdDQoKTtcblxubGV0IF9zdGFnZUluZm9zID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgcmV0dXJuIHtcbiAgICBzdGFnZTogbnVsbCxcbiAgICBpdGVtczogbnVsbCxcbiAgfTtcbn0sIDgpO1xuXG5sZXQgX2Zsb2F0Ml9wb29sID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoMik7XG59LCA4KTtcblxubGV0IF9mbG9hdDNfcG9vbCA9IG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gIHJldHVybiBuZXcgRmxvYXQzMkFycmF5KDMpO1xufSwgOCk7XG5cbmxldCBfZmxvYXQ0X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSg0KTtcbn0sIDgpO1xuXG5sZXQgX2Zsb2F0OV9wb29sID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgcmV0dXJuIG5ldyBGbG9hdDMyQXJyYXkoOSk7XG59LCA4KTtcblxubGV0IF9mbG9hdDE2X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSgxNik7XG59LCA4KTtcblxubGV0IF9mbG9hdDY0X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEZsb2F0MzJBcnJheSg2NCk7XG59LCA4KTtcblxubGV0IF9pbnQyX3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEludDMyQXJyYXkoMik7XG59LCA4KTtcblxubGV0IF9pbnQzX3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEludDMyQXJyYXkoMyk7XG59LCA4KTtcblxubGV0IF9pbnQ0X3Bvb2wgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICByZXR1cm4gbmV3IEludDMyQXJyYXkoNCk7XG59LCA4KTtcblxubGV0IF9pbnQ2NF9wb29sID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgcmV0dXJuIG5ldyBJbnQzMkFycmF5KDY0KTtcbn0sIDgpO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBCYXNlIHtcbiAgLyoqXG4gICAqIEBwYXJhbSB7Z2Z4LkRldmljZX0gZGV2aWNlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzXG4gICAqIEBwYXJhbSB7Z2Z4LlRleHR1cmUyRH0gb3B0cy5kZWZhdWx0VGV4dHVyZVxuICAgKiBAcGFyYW0ge2dmeC5UZXh0dXJlQ3ViZX0gb3B0cy5kZWZhdWx0VGV4dHVyZUN1YmVcbiAgICovXG4gIGNvbnN0cnVjdG9yIChkZXZpY2UsIG9wdHMpIHtcbiAgICB0aGlzLl9kZXZpY2UgPSBkZXZpY2U7XG4gICAgdGhpcy5fcHJvZ3JhbUxpYiA9IG5ldyBQcm9ncmFtTGliKGRldmljZSk7XG4gICAgdGhpcy5fb3B0cyA9IG9wdHM7XG4gICAgdGhpcy5fdHlwZTJkZWZhdWx0VmFsdWUgPSB7XG4gICAgICBbZW51bXMuUEFSQU1fSU5UXTogMCxcbiAgICAgIFtlbnVtcy5QQVJBTV9JTlQyXTogbmV3IFZlYzIoMCwgMCksXG4gICAgICBbZW51bXMuUEFSQU1fSU5UM106IG5ldyBWZWMzKDAsIDAsIDApLFxuICAgICAgW2VudW1zLlBBUkFNX0lOVDRdOiBuZXcgVmVjNCgwLCAwLCAwLCAwKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9GTE9BVF06IDAuMCxcbiAgICAgIFtlbnVtcy5QQVJBTV9GTE9BVDJdOiBuZXcgVmVjMigwLCAwKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9GTE9BVDNdOiBuZXcgVmVjMygwLCAwLCAwKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9GTE9BVDRdOiBuZXcgVmVjNCgwLCAwLCAwLCAwKSxcbiAgICAgIFtlbnVtcy5QQVJBTV9DT0xPUjRdOiBuZXcgQ29sb3IoMCwgMCwgMCwgMSksXG4gICAgICBbZW51bXMuUEFSQU1fTUFUM106IG5ldyBNYXQzKCksXG4gICAgICBbZW51bXMuUEFSQU1fTUFUNF06IG5ldyBNYXQ0KCksXG4gICAgICBbZW51bXMuUEFSQU1fVEVYVFVSRV8yRF06IG9wdHMuZGVmYXVsdFRleHR1cmUsXG4gICAgICBbZW51bXMuUEFSQU1fVEVYVFVSRV9DVUJFXTogb3B0cy5kZWZhdWx0VGV4dHVyZUN1YmUsXG4gICAgfTtcbiAgICB0aGlzLl9zdGFnZTJmbiA9IHt9O1xuICAgIHRoaXMuX3VzZWRUZXh0dXJlVW5pdHMgPSAwO1xuXG4gICAgdGhpcy5fdmlld1Bvb2xzID0gbmV3IFJlY3ljbGVQb29sKCgpID0+IHtcbiAgICAgIHJldHVybiBuZXcgVmlldygpO1xuICAgIH0sIDgpO1xuXG4gICAgdGhpcy5fZHJhd0l0ZW1zUG9vbHMgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbW9kZWw6IG51bGwsXG4gICAgICAgIG5vZGU6IG51bGwsXG4gICAgICAgIGlhOiBudWxsLFxuICAgICAgICBlZmZlY3Q6IG51bGwsXG4gICAgICAgIGRlZmluZXM6IG51bGwsXG4gICAgICAgIHVuaWZvcm1zOiBudWxsXG4gICAgICB9O1xuICAgIH0sIDEwMCk7XG5cbiAgICB0aGlzLl9zdGFnZUl0ZW1zUG9vbHMgPSBuZXcgUmVjeWNsZVBvb2woKCkgPT4ge1xuICAgICAgcmV0dXJuIG5ldyBSZWN5Y2xlUG9vbCgoKSA9PiB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbW9kZWw6IG51bGwsXG4gICAgICAgICAgbm9kZTogbnVsbCxcbiAgICAgICAgICBpYTogbnVsbCxcbiAgICAgICAgICBlZmZlY3Q6IG51bGwsXG4gICAgICAgICAgZGVmaW5lczogbnVsbCxcbiAgICAgICAgICBwYXNzZXM6IFtdLFxuICAgICAgICAgIHNvcnRLZXk6IC0xLFxuICAgICAgICAgIHVuaWZvcm1zOiBudWxsXG4gICAgICAgIH07XG4gICAgICB9LCAxMDApO1xuICAgIH0sIDE2KTtcblxuICAgIHRoaXMuX2RlZmluZXNDaGFuZ2VkID0gZmFsc2U7XG4gIH1cblxuICBfcmVzZXRUZXh0dWVyVW5pdCAoKSB7XG4gICAgdGhpcy5fdXNlZFRleHR1cmVVbml0cyA9IDA7XG4gIH1cblxuICBfYWxsb2NUZXh0dXJlVW5pdCAoKSB7XG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5fZGV2aWNlO1xuXG4gICAgbGV0IHVuaXQgPSB0aGlzLl91c2VkVGV4dHVyZVVuaXRzO1xuICAgIGlmICh1bml0ID49IGRldmljZS5fY2Fwcy5tYXhUZXh0dXJlVW5pdHMpIHtcbiAgICAgIGNvbnNvbGUud2FybihgVHJ5aW5nIHRvIHVzZSAke3VuaXR9IHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAke2RldmljZS5fY2Fwcy5tYXhUZXh0dXJlVW5pdHN9YCk7XG4gICAgfVxuXG4gICAgdGhpcy5fdXNlZFRleHR1cmVVbml0cyArPSAxO1xuICAgIHJldHVybiB1bml0O1xuICB9XG5cbiAgX3JlZ2lzdGVyU3RhZ2UgKG5hbWUsIGZuKSB7XG4gICAgdGhpcy5fc3RhZ2UyZm5bbmFtZV0gPSBmbjtcbiAgfVxuXG4gIGNsZWFyICgpIHtcbiAgICB0aGlzLl9wcm9ncmFtTGliLmNsZWFyKCk7XG4gICAgdGhpcy5yZXNldCgpO1xuICB9XG5cbiAgcmVzZXQgKCkge1xuICAgIHRoaXMuX3ZpZXdQb29scy5yZXNldCgpO1xuICAgIHRoaXMuX3N0YWdlSXRlbXNQb29scy5yZXNldCgpO1xuXG4gICAgdGhpcy5fZGVmaW5lc0NoYW5nZWQgPSBmYWxzZTtcbiAgfVxuXG4gIF9yZXF1ZXN0VmlldyAoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3ZpZXdQb29scy5hZGQoKTtcbiAgfVxuXG4gIF9yZW5kZXIgKHZpZXcsIHNjZW5lKSB7XG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5fZGV2aWNlO1xuXG4gICAgLy8gc2V0dXAgZnJhbWVidWZmZXJcbiAgICBkZXZpY2Uuc2V0RnJhbWVCdWZmZXIodmlldy5fZnJhbWVidWZmZXIpO1xuXG4gICAgLy8gc2V0dXAgdmlld3BvcnRcbiAgICBkZXZpY2Uuc2V0Vmlld3BvcnQoXG4gICAgICB2aWV3Ll9yZWN0LngsXG4gICAgICB2aWV3Ll9yZWN0LnksXG4gICAgICB2aWV3Ll9yZWN0LncsXG4gICAgICB2aWV3Ll9yZWN0LmhcbiAgICApO1xuXG4gICAgLy8gc2V0dXAgY2xlYXJcbiAgICBsZXQgY2xlYXJPcHRzID0ge307XG4gICAgaWYgKHZpZXcuX2NsZWFyRmxhZ3MgJiBlbnVtcy5DTEVBUl9DT0xPUikge1xuICAgICAgY2xlYXJPcHRzLmNvbG9yID0gVmVjNC50b0FycmF5KFtdLCB2aWV3Ll9jb2xvcik7XG4gICAgfVxuICAgIGlmICh2aWV3Ll9jbGVhckZsYWdzICYgZW51bXMuQ0xFQVJfREVQVEgpIHtcbiAgICAgIGNsZWFyT3B0cy5kZXB0aCA9IHZpZXcuX2RlcHRoO1xuICAgIH1cbiAgICBpZiAodmlldy5fY2xlYXJGbGFncyAmIGVudW1zLkNMRUFSX1NURU5DSUwpIHtcbiAgICAgIGNsZWFyT3B0cy5zdGVuY2lsID0gdmlldy5fc3RlbmNpbDtcbiAgICB9XG4gICAgZGV2aWNlLmNsZWFyKGNsZWFyT3B0cyk7XG5cbiAgICAvLyBnZXQgYWxsIGRyYXcgaXRlbXNcbiAgICB0aGlzLl9kcmF3SXRlbXNQb29scy5yZXNldCgpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzY2VuZS5fbW9kZWxzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsZXQgbW9kZWwgPSBzY2VuZS5fbW9kZWxzLmRhdGFbaV07XG5cbiAgICAgIC8vIGZpbHRlciBtb2RlbCBieSB2aWV3XG4gICAgICBpZiAoKG1vZGVsLl9jdWxsaW5nTWFzayAmIHZpZXcuX2N1bGxpbmdNYXNrKSA9PT0gMCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IGRyYXdJdGVtID0gdGhpcy5fZHJhd0l0ZW1zUG9vbHMuYWRkKCk7XG4gICAgICBtb2RlbC5leHRyYWN0RHJhd0l0ZW0oZHJhd0l0ZW0pO1xuICAgIH1cblxuICAgIC8vIGRpc3BhdGNoIGRyYXcgaXRlbXMgdG8gZGlmZmVyZW50IHN0YWdlXG4gICAgX3N0YWdlSW5mb3MucmVzZXQoKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5fc3RhZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICBsZXQgc3RhZ2UgPSB2aWV3Ll9zdGFnZXNbaV07XG4gICAgICBsZXQgc3RhZ2VJdGVtcyA9IHRoaXMuX3N0YWdlSXRlbXNQb29scy5hZGQoKTtcbiAgICAgIHN0YWdlSXRlbXMucmVzZXQoKTtcblxuICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLl9kcmF3SXRlbXNQb29scy5sZW5ndGg7ICsraikge1xuICAgICAgICBsZXQgZHJhd0l0ZW0gPSB0aGlzLl9kcmF3SXRlbXNQb29scy5kYXRhW2pdO1xuICAgICAgICBsZXQgcGFzc2VzID0gZHJhd0l0ZW0uZWZmZWN0LnN0YWdlUGFzc2VzW3N0YWdlXTtcbiAgICAgICAgaWYgKCFwYXNzZXMgfHwgcGFzc2VzLmxlbmd0aCA9PT0gMCkgY29udGludWU7XG5cbiAgICAgICAgbGV0IHN0YWdlSXRlbSA9IHN0YWdlSXRlbXMuYWRkKCk7XG4gICAgICAgIHN0YWdlSXRlbS5wYXNzZXMgPSBwYXNzZXM7XG4gICAgICAgIHN0YWdlSXRlbS5tb2RlbCA9IGRyYXdJdGVtLm1vZGVsO1xuICAgICAgICBzdGFnZUl0ZW0ubm9kZSA9IGRyYXdJdGVtLm5vZGU7XG4gICAgICAgIHN0YWdlSXRlbS5pYSA9IGRyYXdJdGVtLmlhO1xuICAgICAgICBzdGFnZUl0ZW0uZWZmZWN0ID0gZHJhd0l0ZW0uZWZmZWN0O1xuICAgICAgICBzdGFnZUl0ZW0uZGVmaW5lcyA9IGRyYXdJdGVtLmRlZmluZXM7XG4gICAgICAgIHN0YWdlSXRlbS5zb3J0S2V5ID0gLTE7XG4gICAgICAgIHN0YWdlSXRlbS51bmlmb3JtcyA9IGRyYXdJdGVtLnVuaWZvcm1zO1xuICAgICAgfVxuXG4gICAgICBsZXQgc3RhZ2VJbmZvID0gX3N0YWdlSW5mb3MuYWRkKCk7XG4gICAgICBzdGFnZUluZm8uc3RhZ2UgPSBzdGFnZTtcbiAgICAgIHN0YWdlSW5mby5pdGVtcyA9IHN0YWdlSXRlbXM7XG4gICAgfVxuXG4gICAgLy8gcmVuZGVyIHN0YWdlc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgX3N0YWdlSW5mb3MubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBpbmZvID0gX3N0YWdlSW5mb3MuZGF0YVtpXTtcbiAgICAgIGxldCBmbiA9IHRoaXMuX3N0YWdlMmZuW2luZm8uc3RhZ2VdO1xuICAgICAgZm4odmlldywgaW5mby5pdGVtcyk7XG4gICAgfVxuICB9XG5cbiAgX3NldFByb3BlcnR5IChwcm9wKSB7XG4gICAgY29uc3QgZGV2aWNlID0gdGhpcy5fZGV2aWNlO1xuICAgIGxldCBwYXJhbSA9IHByb3AudmFsdWU7XG5cbiAgICBpZiAocGFyYW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGFyYW0gPSBwcm9wLnZhbDtcbiAgICB9XG5cbiAgICBpZiAocGFyYW0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGFyYW0gPSB0aGlzLl90eXBlMmRlZmF1bHRWYWx1ZVtwcm9wLnR5cGVdO1xuICAgIH1cblxuICAgIGlmIChwYXJhbSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byBzZXQgdGVjaG5pcXVlIHByb3BlcnR5ICR7cHJvcC5uYW1lfSwgdmFsdWUgbm90IGZvdW5kLmApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgIHByb3AudHlwZSA9PT0gZW51bXMuUEFSQU1fVEVYVFVSRV8yRCB8fFxuICAgICAgcHJvcC50eXBlID09PSBlbnVtcy5QQVJBTV9URVhUVVJFX0NVQkVcbiAgICApIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtKSkge1xuICAgICAgICBpZiAocGFyYW0ubGVuZ3RoID4gcHJvcC5jb3VudCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzZXQgcHJvcGVydHkgWyR7cHJvcC5uYW1lfV0gOiBUaGUgbGVuZ3RoIG9mIHRleHR1cmUgYXJyYXkgWyR7cGFyYW0ubGVuZ3RofV0gaXMgYmlnZ2VyIHRoYW4gWyR7cHJvcC5jb3VudH1dLmApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc2xvdHMgPSBfaW50NjRfcG9vbC5hZGQoKTtcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHBhcmFtLmxlbmd0aDsgKytpbmRleCkge1xuICAgICAgICAgIHNsb3RzW2luZGV4XSA9IHRoaXMuX2FsbG9jVGV4dHVyZVVuaXQoKTtcbiAgICAgICAgfVxuICAgICAgICBkZXZpY2Uuc2V0VGV4dHVyZUFycmF5KHByb3AubmFtZSwgcGFyYW0sIHNsb3RzKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRldmljZS5zZXRUZXh0dXJlKHByb3AubmFtZSwgcGFyYW0sIHRoaXMuX2FsbG9jVGV4dHVyZVVuaXQoKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChwcm9wLmRpcmVjdGx5KSB7XG4gICAgICAgIGRldmljZS5zZXRVbmlmb3JtRGlyZWN0bHkocHJvcC5uYW1lLCBwYXJhbSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgZGV2aWNlLnNldFVuaWZvcm0ocHJvcC5uYW1lLCBwYXJhbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX2RyYXcgKGl0ZW0pIHtcbiAgICBjb25zdCBkZXZpY2UgPSB0aGlzLl9kZXZpY2U7XG4gICAgY29uc3QgcHJvZ3JhbUxpYiA9IHRoaXMuX3Byb2dyYW1MaWI7XG4gICAgY29uc3QgeyBub2RlLCBpYSwgcGFzc2VzLCBlZmZlY3QgfSA9IGl0ZW07XG5cbiAgICAvLyByZXNldCB0aGUgcG9vbFxuICAgIC8vIE5PVEU6IHdlIGNhbiB1c2UgZHJhd0NvdW50ZXIgb3B0aW1pemUgdGhpc1xuICAgIC8vIFRPRE86IHNob3VsZCBiZSBjb25maWd1cmFibGVcbiAgICBfZmxvYXQyX3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQzX3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQ0X3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQ5X3Bvb2wucmVzZXQoKTtcbiAgICBfZmxvYXQxNl9wb29sLnJlc2V0KCk7XG4gICAgX2Zsb2F0NjRfcG9vbC5yZXNldCgpO1xuICAgIF9pbnQyX3Bvb2wucmVzZXQoKTtcbiAgICBfaW50M19wb29sLnJlc2V0KCk7XG4gICAgX2ludDRfcG9vbC5yZXNldCgpO1xuICAgIF9pbnQ2NF9wb29sLnJlc2V0KCk7XG5cbiAgICAvLyBzZXQgY29tbW9uIHVuaWZvcm1zXG4gICAgLy8gVE9ETzogdHJ5IGNvbW1pdCB0aGlzIGRlcGVuZHMgb24gZWZmZWN0XG4gICAgLy8ge1xuICAgIG5vZGUuZ2V0V29ybGRNYXRyaXgoX200X3RtcCk7XG4gICAgZGV2aWNlLnNldFVuaWZvcm0oJ2NjX21hdFdvcmxkJywgTWF0NC50b0FycmF5KF9mbG9hdDE2X3Bvb2wuYWRkKCksIF9tNF90bXApKTtcblxuICAgIC8vIGxldCB3cSA9IG5vZGUuZ2V0V29ybGRSb3RhdGlvbihjYy5xdWF0KCkpO1xuICAgIE1hdDQuaW52ZXJ0KF9tNF90bXAsIF9tNF90bXApO1xuICAgIE1hdDQudHJhbnNwb3NlKF9tNF90bXAsIF9tNF90bXApO1xuICAgIGRldmljZS5zZXRVbmlmb3JtKCdjY19tYXRXb3JsZElUJywgTWF0NC50b0FycmF5KF9mbG9hdDE2X3Bvb2wuYWRkKCksIF9tNF90bXApKTtcbiAgICAvLyB9XG5cbiAgICBsZXQgZGVmaW5lcyA9IHRoaXMuX2RlZmluZXM7XG5cbiAgICAvLyBmb3IgZWFjaCBwYXNzXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXNzZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBwYXNzID0gcGFzc2VzW2ldO1xuXG4gICAgICBpZiAodGhpcy5fZGVmaW5lc0NoYW5nZWQpIHtcbiAgICAgICAgcGFzcy5fcHJvZ3JhbUtleSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGxldCBjb3VudCA9IGlhLmNvdW50O1xuXG4gICAgICAvLyBzZXQgdmVydGV4IGJ1ZmZlclxuICAgICAgaWYgKGlhLl92ZXJ0ZXhCdWZmZXIpIHtcbiAgICAgICAgZGV2aWNlLnNldFZlcnRleEJ1ZmZlcigwLCBpYS5fdmVydGV4QnVmZmVyKTtcbiAgICAgIH1cblxuICAgICAgLy8gc2V0IGluZGV4IGJ1ZmZlclxuICAgICAgaWYgKGlhLl9pbmRleEJ1ZmZlcikge1xuICAgICAgICBkZXZpY2Uuc2V0SW5kZXhCdWZmZXIoaWEuX2luZGV4QnVmZmVyKTtcbiAgICAgIH1cblxuICAgICAgLy8gc2V0IHByaW1pdGl2ZSB0eXBlXG4gICAgICBkZXZpY2Uuc2V0UHJpbWl0aXZlVHlwZShpYS5fcHJpbWl0aXZlVHlwZSk7XG5cbiAgICAgIC8vIHNldCBwcm9ncmFtXG4gICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoZGVmaW5lcywgcGFzcy5fZGVmaW5lcyk7XG5cbiAgICAgIGxldCBwcm9ncmFtID0gcHJvZ3JhbUxpYi5nZXRQcm9ncmFtKHBhc3MsIGRlZmluZXMsIGVmZmVjdC5uYW1lKTtcbiAgICAgIGRldmljZS5zZXRQcm9ncmFtKHByb2dyYW0pO1xuXG4gICAgICBsZXQgdW5pZm9ybXMgPSBwcm9ncmFtLl91bmlmb3JtcztcbiAgICAgIGxldCB2YXJpYW50cyA9IHBhc3MuX3Byb3BlcnRpZXM7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHVuaWZvcm1zLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGxldCBwcm9wID0gdmFyaWFudHNbdW5pZm9ybXNbal0ubmFtZV07XG4gICAgICAgIGlmIChwcm9wICE9PSB1bmRlZmluZWQpXG4gICAgICAgIHRoaXMuX3NldFByb3BlcnR5KHByb3ApO1xuICAgICAgfVxuXG5cbiAgICAgIC8vIGN1bGwgbW9kZVxuICAgICAgZGV2aWNlLnNldEN1bGxNb2RlKHBhc3MuX2N1bGxNb2RlKTtcblxuICAgICAgLy8gYmxlbmRcbiAgICAgIGlmIChwYXNzLl9ibGVuZCkge1xuICAgICAgICBkZXZpY2UuZW5hYmxlQmxlbmQoKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kRnVuY1NlcChcbiAgICAgICAgICBwYXNzLl9ibGVuZFNyYyxcbiAgICAgICAgICBwYXNzLl9ibGVuZERzdCxcbiAgICAgICAgICBwYXNzLl9ibGVuZFNyY0FscGhhLFxuICAgICAgICAgIHBhc3MuX2JsZW5kRHN0QWxwaGFcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kRXFTZXAoXG4gICAgICAgICAgcGFzcy5fYmxlbmRFcSxcbiAgICAgICAgICBwYXNzLl9ibGVuZEFscGhhRXFcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldEJsZW5kQ29sb3IzMihwYXNzLl9ibGVuZENvbG9yKTtcbiAgICAgIH1cblxuICAgICAgLy8gZGVwdGggdGVzdCAmIHdyaXRlXG4gICAgICBpZiAocGFzcy5fZGVwdGhUZXN0KSB7XG4gICAgICAgIGRldmljZS5lbmFibGVEZXB0aFRlc3QoKTtcbiAgICAgICAgZGV2aWNlLnNldERlcHRoRnVuYyhwYXNzLl9kZXB0aEZ1bmMpO1xuICAgICAgfVxuICAgICAgaWYgKHBhc3MuX2RlcHRoV3JpdGUpIHtcbiAgICAgICAgZGV2aWNlLmVuYWJsZURlcHRoV3JpdGUoKTtcbiAgICAgIH1cblxuICAgICAgLy8gc3RlbmNpbFxuICAgICAgZGV2aWNlLnNldFN0ZW5jaWxUZXN0KHBhc3MuX3N0ZW5jaWxUZXN0KTtcbiAgICAgIGlmIChwYXNzLl9zdGVuY2lsVGVzdCA9PT0gZ2Z4LlNURU5DSUxfRU5BQkxFKSB7XG4gICAgICAgIC8vIGZyb250XG4gICAgICAgIGRldmljZS5zZXRTdGVuY2lsRnVuY0Zyb250KFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGdW5jRnJvbnQsXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFJlZkZyb250LFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxNYXNrRnJvbnRcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldFN0ZW5jaWxPcEZyb250KFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGYWlsT3BGcm9udCxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsWkZhaWxPcEZyb250LFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxaUGFzc09wRnJvbnQsXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFdyaXRlTWFza0Zyb250XG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gYmFja1xuICAgICAgICBkZXZpY2Uuc2V0U3RlbmNpbEZ1bmNCYWNrKFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxGdW5jQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsUmVmQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsTWFza0JhY2tcbiAgICAgICAgKTtcbiAgICAgICAgZGV2aWNlLnNldFN0ZW5jaWxPcEJhY2soXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbEZhaWxPcEJhY2ssXG4gICAgICAgICAgcGFzcy5fc3RlbmNpbFpGYWlsT3BCYWNrLFxuICAgICAgICAgIHBhc3MuX3N0ZW5jaWxaUGFzc09wQmFjayxcbiAgICAgICAgICBwYXNzLl9zdGVuY2lsV3JpdGVNYXNrQmFja1xuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBkcmF3IHBhc3NcbiAgICAgIGRldmljZS5kcmF3KGlhLl9zdGFydCwgY291bnQpO1xuXG4gICAgICB0aGlzLl9yZXNldFRleHR1ZXJVbml0KCk7XG4gICAgfVxuICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii8ifQ==