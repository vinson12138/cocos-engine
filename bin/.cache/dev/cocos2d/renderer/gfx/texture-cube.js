
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/gfx/texture-cube.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _texture = _interopRequireDefault(require("./texture"));

var _enums = require("./enums");

var _misc = require("./misc");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

var TextureCube = /*#__PURE__*/function (_Texture) {
  _inheritsLoose(TextureCube, _Texture);

  /**
   * @constructor
   * @param {Device} device
   * @param {Object} options
   * @param {Array} options.images
   * @param {Boolean} options.genMipmaps
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {TEXTURE_FMT_*} options.format
   * @param {Number} options.anisotropy
   * @param {FILTER_*} options.minFilter
   * @param {FILTER_*} options.magFilter
   * @param {FILTER_*} options.mipFilter
   * @param {WRAP_*} options.wrapS
   * @param {WRAP_*} options.wrapT
   * @param {WRAP_*} options.wrapR
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  function TextureCube(device, options) {
    var _this;

    _this = _Texture.call(this, device) || this;
    var gl = _this._device._gl;
    _this._target = gl.TEXTURE_CUBE_MAP;
    _this._glID = gl.createTexture();

    _this.update(options);

    return _this;
  }
  /**
   * @method update
   * @param {Object} options
   * @param {Array} options.images
   * @param {Boolean} options.genMipmaps
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {TEXTURE_FMT_*} options.format
   * @param {Number} options.anisotropy
   * @param {FILTER_*} options.minFilter
   * @param {FILTER_*} options.magFilter
   * @param {FILTER_*} options.mipFilter
   * @param {WRAP_*} options.wrapS
   * @param {WRAP_*} options.wrapT
   * @param {WRAP_*} options.wrapR
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */


  var _proto = TextureCube.prototype;

  _proto.update = function update(options) {
    var gl = this._device._gl;
    var genMipmaps = this._genMipmaps;

    if (options) {
      if (options.width !== undefined) {
        this._width = options.width;
      }

      if (options.height !== undefined) {
        this._height = options.height;
      }

      if (options.anisotropy !== undefined) {
        this._anisotropy = options.anisotropy;
      }

      if (options.minFilter !== undefined) {
        this._minFilter = options.minFilter;
      }

      if (options.magFilter !== undefined) {
        this._magFilter = options.magFilter;
      }

      if (options.mipFilter !== undefined) {
        this._mipFilter = options.mipFilter;
      }

      if (options.wrapS !== undefined) {
        this._wrapS = options.wrapS;
      }

      if (options.wrapT !== undefined) {
        this._wrapT = options.wrapT;
      } // wrapR available in webgl2
      // if (options.wrapR !== undefined) {
      //   this._wrapR = options.wrapR;
      // }


      if (options.format !== undefined) {
        this._format = options.format;
        this._compressed = this._format >= _enums.enums.TEXTURE_FMT_RGB_DXT1 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1 || this._format >= _enums.enums.TEXTURE_FMT_RGB_ETC2 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_ETC2;
      } // check if generate mipmap


      if (options.genMipmaps !== undefined) {
        this._genMipmaps = options.genMipmaps;
        genMipmaps = options.genMipmaps;
      }

      if (options.images !== undefined) {
        if (options.images.length > 1) {
          genMipmaps = false;

          if (options.width !== options.height) {
            console.warn('texture-cube width and height should be identical.');
          }

          if (options.width >> options.images.length - 1 !== 1) {
            console.error('texture-cube mipmap is invalid. please set mipmap as 1x1, 2x2, 4x4 ... nxn');
          }
        }
      }
    } // NOTE: get pot after this._width, this._height has been assigned.


    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height);

    if (!pot) {
      genMipmaps = false;
    }

    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    if (options.images !== undefined && options.images.length > 0) {
      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);

      if (options.images.length > 1) this._genMipmaps = true;
    }

    if (genMipmaps) {
      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);
      gl.generateMipmap(gl.TEXTURE_CUBE_MAP);
      this._genMipmaps = true;
    }

    this._setTexInfo();

    this._device._restoreTexture(0);
  }
  /**
   * @method updateSubImage
   * @param {Object} options
   * @param {Number} options.x
   * @param {Number} options.y
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {Number} options.faceIndex
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateSubImage = function updateSubImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    this._setSubImage(glFmt, options);

    this._device._restoreTexture(0);
  }
  /**
   * @method updateImage
   * @param {Object} options
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {Number} options.faceIndex
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateImage = function updateImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_CUBE_MAP, this._glID);

    this._setImage(glFmt, options);

    this._device._restoreTexture(0);
  };

  _proto._setSubImage = function _setSubImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var faceIndex = options.faceIndex;
    var img = options.image;

    if (flipY === undefined) {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
    }

    if (premultiplyAlpha === undefined) {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
    }

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      gl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);
    } else {
      if (this._compressed) {
        gl.compressedTexSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, options.width, options.height, glFmt.format, img);
      } else {
        gl.texSubImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, options.x, options.y, options.width, options.height, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setImage = function _setImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var faceIndex = options.faceIndex;
    var img = options.image;

    if (flipY === undefined) {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
    }

    if (premultiplyAlpha === undefined) {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
    } else {
      gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
    }

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, glFmt.format, glFmt.pixelType, img);
    } else {
      if (this._compressed) {
        gl.compressedTexImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, options.width, options.height, 0, img);
      } else {
        gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + faceIndex, options.level, glFmt.internalFormat, options.width, options.height, 0, glFmt.format, glFmt.pixelType, img);
      }
    }
  } // levelImages = [imagePosX, imageNegX, imagePosY, imageNegY, imagePosZ, imageNegz]
  // images = [levelImages0, levelImages1, ...]
  ;

  _proto._setMipmap = function _setMipmap(images, flipY, premultiplyAlpha) {
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    var options = {
      width: this._width,
      height: this._height,
      faceIndex: 0,
      flipY: flipY,
      premultiplyAlpha: premultiplyAlpha,
      level: 0,
      image: null
    };

    for (var i = 0; i < images.length; ++i) {
      var levelImages = images[i];
      options.level = i;
      options.width = this._width >> i;
      options.height = this._height >> i;

      for (var face = 0; face < 6; ++face) {
        options.faceIndex = face;
        options.image = levelImages[face];

        this._setImage(glFmt, options);
      }
    }
  };

  _proto._setTexInfo = function _setTexInfo() {
    var gl = this._device._gl;
    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height); // WebGL1 doesn't support all wrap modes with NPOT textures

    if (!pot && (this._wrapS !== _enums.enums.WRAP_CLAMP || this._wrapT !== _enums.enums.WRAP_CLAMP)) {
      console.warn('WebGL1 doesn\'t support all wrap modes with NPOT textures');
      this._wrapS = _enums.enums.WRAP_CLAMP;
      this._wrapT = _enums.enums.WRAP_CLAMP;
    }

    var mipFilter = this._genMipmaps ? this._mipFilter : -1;

    if (!pot && mipFilter !== -1) {
      console.warn('NPOT textures do not support mipmap filter');
      mipFilter = -1;
    }

    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, (0, _enums.glFilter)(gl, this._minFilter, mipFilter));
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, (0, _enums.glFilter)(gl, this._magFilter, -1));
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, this._wrapS);
    gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, this._wrapT); // wrapR available in webgl2
    // gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_R, this._wrapR);

    var ext = this._device.ext('EXT_texture_filter_anisotropic');

    if (ext) {
      gl.texParameteri(gl.TEXTURE_CUBE_MAP, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);
    }
  };

  return TextureCube;
}(_texture["default"]);

exports["default"] = TextureCube;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9nZngvdGV4dHVyZS1jdWJlLmpzIl0sIm5hbWVzIjpbIlRleHR1cmVDdWJlIiwiZGV2aWNlIiwib3B0aW9ucyIsImdsIiwiX2RldmljZSIsIl9nbCIsIl90YXJnZXQiLCJURVhUVVJFX0NVQkVfTUFQIiwiX2dsSUQiLCJjcmVhdGVUZXh0dXJlIiwidXBkYXRlIiwiZ2VuTWlwbWFwcyIsIl9nZW5NaXBtYXBzIiwid2lkdGgiLCJ1bmRlZmluZWQiLCJfd2lkdGgiLCJoZWlnaHQiLCJfaGVpZ2h0IiwiYW5pc290cm9weSIsIl9hbmlzb3Ryb3B5IiwibWluRmlsdGVyIiwiX21pbkZpbHRlciIsIm1hZ0ZpbHRlciIsIl9tYWdGaWx0ZXIiLCJtaXBGaWx0ZXIiLCJfbWlwRmlsdGVyIiwid3JhcFMiLCJfd3JhcFMiLCJ3cmFwVCIsIl93cmFwVCIsImZvcm1hdCIsIl9mb3JtYXQiLCJfY29tcHJlc3NlZCIsImVudW1zIiwiVEVYVFVSRV9GTVRfUkdCX0RYVDEiLCJURVhUVVJFX0ZNVF9SR0JBX1BWUlRDXzRCUFBWMSIsIlRFWFRVUkVfRk1UX1JHQl9FVEMyIiwiVEVYVFVSRV9GTVRfUkdCQV9FVEMyIiwiaW1hZ2VzIiwibGVuZ3RoIiwiY29uc29sZSIsIndhcm4iLCJlcnJvciIsInBvdCIsImFjdGl2ZVRleHR1cmUiLCJURVhUVVJFMCIsImJpbmRUZXh0dXJlIiwiX3NldE1pcG1hcCIsImZsaXBZIiwicHJlbXVsdGlwbHlBbHBoYSIsImhpbnQiLCJHRU5FUkFURV9NSVBNQVBfSElOVCIsIk5JQ0VTVCIsImdlbmVyYXRlTWlwbWFwIiwiX3NldFRleEluZm8iLCJfcmVzdG9yZVRleHR1cmUiLCJ1cGRhdGVTdWJJbWFnZSIsImdsRm10IiwiX3NldFN1YkltYWdlIiwidXBkYXRlSW1hZ2UiLCJfc2V0SW1hZ2UiLCJmYWNlSW5kZXgiLCJpbWciLCJpbWFnZSIsInBpeGVsU3RvcmVpIiwiVU5QQUNLX0ZMSVBfWV9XRUJHTCIsIlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCIsIkFycmF5QnVmZmVyIiwiaXNWaWV3IiwidGV4U3ViSW1hZ2UyRCIsIlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCIsImxldmVsIiwieCIsInkiLCJwaXhlbFR5cGUiLCJjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCIsInRleEltYWdlMkQiLCJpbnRlcm5hbEZvcm1hdCIsImNvbXByZXNzZWRUZXhJbWFnZTJEIiwiaSIsImxldmVsSW1hZ2VzIiwiZmFjZSIsIldSQVBfQ0xBTVAiLCJ0ZXhQYXJhbWV0ZXJpIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVEVYVFVSRV9NQUdfRklMVEVSIiwiVEVYVFVSRV9XUkFQX1MiLCJURVhUVVJFX1dSQVBfVCIsImV4dCIsIlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUIiwiVGV4dHVyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOzs7Ozs7OztJQUVxQkE7OztBQUNuQjtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNFLHVCQUFZQyxNQUFaLEVBQW9CQyxPQUFwQixFQUE2QjtBQUFBOztBQUMzQixnQ0FBTUQsTUFBTjtBQUNBLFFBQUlFLEVBQUUsR0FBRyxNQUFLQyxPQUFMLENBQWFDLEdBQXRCO0FBQ0EsVUFBS0MsT0FBTCxHQUFlSCxFQUFFLENBQUNJLGdCQUFsQjtBQUNBLFVBQUtDLEtBQUwsR0FBYUwsRUFBRSxDQUFDTSxhQUFILEVBQWI7O0FBQ0EsVUFBS0MsTUFBTCxDQUFZUixPQUFaOztBQUwyQjtBQU01QjtBQUVEO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7U0FDRVEsU0FBQSxnQkFBT1IsT0FBUCxFQUFnQjtBQUNkLFFB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LEVBQUUsQ0FBQ0ksZ0JBQXBCLEVBQXNDSixFQUFFLENBQUNvRixjQUF6QyxFQUF5RCxLQUFLMUQsTUFBOUQsRUFwQlksQ0FxQlo7QUFDQTs7QUFFQSxRQUFJMkQsR0FBRyxHQUFHLEtBQUtwRixPQUFMLENBQWFvRixHQUFiLENBQWlCLGdDQUFqQixDQUFWOztBQUNBLFFBQUlBLEdBQUosRUFBUztBQUNQckYsTUFBQUEsRUFBRSxDQUFDZ0YsYUFBSCxDQUFpQmhGLEVBQUUsQ0FBQ0ksZ0JBQXBCLEVBQXNDaUYsR0FBRyxDQUFDQywwQkFBMUMsRUFBc0UsS0FBS3RFLFdBQTNFO0FBQ0Q7QUFDRjs7O0VBNVVzQ3VFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFRleHR1cmUgZnJvbSAnLi90ZXh0dXJlJztcbmltcG9ydCB7IGVudW1zLCBnbEZpbHRlciwgZ2xUZXh0dXJlRm10IH0gZnJvbSAnLi9lbnVtcyc7XG5pbXBvcnQgeyBpc1BvdzIgfSBmcm9tICcuL21pc2MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0dXJlQ3ViZSBleHRlbmRzIFRleHR1cmUge1xuICAvKipcbiAgICogQGNvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7RGV2aWNlfSBkZXZpY2VcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheX0gb3B0aW9ucy5pbWFnZXNcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLmdlbk1pcG1hcHNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuaGVpZ2h0XG4gICAqIEBwYXJhbSB7VEVYVFVSRV9GTVRfKn0gb3B0aW9ucy5mb3JtYXRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuYW5pc290cm9weVxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1pbkZpbHRlclxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1hZ0ZpbHRlclxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1pcEZpbHRlclxuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwU1xuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwVFxuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwUlxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMuZmxpcFlcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGFcbiAgICovXG4gIGNvbnN0cnVjdG9yKGRldmljZSwgb3B0aW9ucykge1xuICAgIHN1cGVyKGRldmljZSk7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICB0aGlzLl90YXJnZXQgPSBnbC5URVhUVVJFX0NVQkVfTUFQO1xuICAgIHRoaXMuX2dsSUQgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XG4gICAgdGhpcy51cGRhdGUob3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogQHBhcmFtIHtBcnJheX0gb3B0aW9ucy5pbWFnZXNcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLmdlbk1pcG1hcHNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMud2lkdGhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuaGVpZ2h0XG4gICAqIEBwYXJhbSB7VEVYVFVSRV9GTVRfKn0gb3B0aW9ucy5mb3JtYXRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuYW5pc290cm9weVxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1pbkZpbHRlclxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1hZ0ZpbHRlclxuICAgKiBAcGFyYW0ge0ZJTFRFUl8qfSBvcHRpb25zLm1pcEZpbHRlclxuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwU1xuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwVFxuICAgKiBAcGFyYW0ge1dSQVBfKn0gb3B0aW9ucy53cmFwUlxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMuZmxpcFlcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGFcbiAgICovXG4gIHVwZGF0ZShvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZ2VuTWlwbWFwcyA9IHRoaXMuX2dlbk1pcG1hcHM7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMud2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl93aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5oZWlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9hbmlzb3Ryb3B5ID0gb3B0aW9ucy5hbmlzb3Ryb3B5O1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMubWluRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fbWluRmlsdGVyID0gb3B0aW9ucy5taW5GaWx0ZXI7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5tYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9tYWdGaWx0ZXIgPSBvcHRpb25zLm1hZ0ZpbHRlcjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm1pcEZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX21pcEZpbHRlciA9IG9wdGlvbnMubWlwRmlsdGVyO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMud3JhcFMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl93cmFwUyA9IG9wdGlvbnMud3JhcFM7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy53cmFwVCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX3dyYXBUID0gb3B0aW9ucy53cmFwVDtcbiAgICAgIH1cbiAgICAgIC8vIHdyYXBSIGF2YWlsYWJsZSBpbiB3ZWJnbDJcbiAgICAgIC8vIGlmIChvcHRpb25zLndyYXBSICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vICAgdGhpcy5fd3JhcFIgPSBvcHRpb25zLndyYXBSO1xuICAgICAgLy8gfVxuICAgICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fZm9ybWF0ID0gb3B0aW9ucy5mb3JtYXQ7XG4gICAgICAgIHRoaXMuX2NvbXByZXNzZWQgPSBcbiAgICAgICAgICAodGhpcy5fZm9ybWF0ID49IGVudW1zLlRFWFRVUkVfRk1UX1JHQl9EWFQxICYmIHRoaXMuX2Zvcm1hdCA8PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JBX1BWUlRDXzRCUFBWMSkgfHwgXG4gICAgICAgICAgKHRoaXMuX2Zvcm1hdCA+PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JfRVRDMiAmJiB0aGlzLl9mb3JtYXQgPD0gZW51bXMuVEVYVFVSRV9GTVRfUkdCQV9FVEMyKVxuICAgICAgICA7XG4gICAgICB9XG5cbiAgICAgIC8vIGNoZWNrIGlmIGdlbmVyYXRlIG1pcG1hcFxuICAgICAgaWYgKG9wdGlvbnMuZ2VuTWlwbWFwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX2dlbk1pcG1hcHMgPSBvcHRpb25zLmdlbk1pcG1hcHM7XG4gICAgICAgIGdlbk1pcG1hcHMgPSBvcHRpb25zLmdlbk1pcG1hcHM7XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zLmltYWdlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChvcHRpb25zLmltYWdlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgZ2VuTWlwbWFwcyA9IGZhbHNlO1xuICAgICAgICAgIGlmIChvcHRpb25zLndpZHRoICE9PSBvcHRpb25zLmhlaWdodCkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCd0ZXh0dXJlLWN1YmUgd2lkdGggYW5kIGhlaWdodCBzaG91bGQgYmUgaWRlbnRpY2FsLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3B0aW9ucy53aWR0aCA+PiAob3B0aW9ucy5pbWFnZXMubGVuZ3RoIC0gMSkgIT09IDEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ3RleHR1cmUtY3ViZSBtaXBtYXAgaXMgaW52YWxpZC4gcGxlYXNlIHNldCBtaXBtYXAgYXMgMXgxLCAyeDIsIDR4NCAuLi4gbnhuJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTk9URTogZ2V0IHBvdCBhZnRlciB0aGlzLl93aWR0aCwgdGhpcy5faGVpZ2h0IGhhcyBiZWVuIGFzc2lnbmVkLlxuICAgIGxldCBwb3QgPSBpc1BvdzIodGhpcy5fd2lkdGgpICYmIGlzUG93Mih0aGlzLl9oZWlnaHQpO1xuICAgIGlmICghcG90KSB7XG4gICAgICBnZW5NaXBtYXBzID0gZmFsc2U7XG4gICAgfVxuXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGhpcy5fZ2xJRCk7XG4gICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQgJiYgb3B0aW9ucy5pbWFnZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5fc2V0TWlwbWFwKG9wdGlvbnMuaW1hZ2VzLCBvcHRpb25zLmZsaXBZLCBvcHRpb25zLnByZW11bHRpcGx5QWxwaGEpO1xuICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCA+IDEpIHRoaXMuX2dlbk1pcG1hcHMgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZ2VuTWlwbWFwcykge1xuICAgICAgZ2wuaGludChnbC5HRU5FUkFURV9NSVBNQVBfSElOVCwgZ2wuTklDRVNUKTtcbiAgICAgIGdsLmdlbmVyYXRlTWlwbWFwKGdsLlRFWFRVUkVfQ1VCRV9NQVApO1xuICAgICAgdGhpcy5fZ2VuTWlwbWFwcyA9IHRydWU7XG4gICAgfVxuXG4gICAgdGhpcy5fc2V0VGV4SW5mbygpO1xuXG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZVN1YkltYWdlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLnhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMueVxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy53aWR0aFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMubGV2ZWxcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMuZmFjZUluZGV4XG4gICAqIEBwYXJhbSB7SFRNTENhbnZhc0VsZW1lbnQgfCBIVE1MSW1hZ2VFbGVtZW50IHwgSFRNTFZpZGVvRWxlbWVudCB8IEFycmF5QnVmZmVyVmlld30gb3B0aW9ucy5pbWFnZVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMuZmxpcFlcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLnByZW11bHRpcGx5QWxwaGFcbiAgICovXG4gIHVwZGF0ZVN1YkltYWdlKG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBnbEZtdCA9IGdsVGV4dHVyZUZtdCh0aGlzLl9mb3JtYXQpO1xuXG4gICAgZ2wuYWN0aXZlVGV4dHVyZShnbC5URVhUVVJFMCk7XG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGhpcy5fZ2xJRCk7XG4gICAgdGhpcy5fc2V0U3ViSW1hZ2UoZ2xGbXQsIG9wdGlvbnMpO1xuXG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZUltYWdlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLndpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmhlaWdodFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5mYWNlSW5kZXhcbiAgICogQHBhcmFtIHtIVE1MQ2FudmFzRWxlbWVudCB8IEhUTUxJbWFnZUVsZW1lbnQgfCBIVE1MVmlkZW9FbGVtZW50IHwgQXJyYXlCdWZmZXJWaWV3fSBvcHRpb25zLmltYWdlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYVxuICAgKi9cbiAgdXBkYXRlSW1hZ2Uob3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGdsRm10ID0gZ2xUZXh0dXJlRm10KHRoaXMuX2Zvcm1hdCk7XG5cbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFX0NVQkVfTUFQLCB0aGlzLl9nbElEKTtcbiAgICB0aGlzLl9zZXRJbWFnZShnbEZtdCwgb3B0aW9ucyk7XG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcbiAgfVxuXG4gIF9zZXRTdWJJbWFnZShnbEZtdCwgb3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGZsaXBZID0gb3B0aW9ucy5mbGlwWTtcbiAgICBsZXQgcHJlbXVsdGlwbHlBbHBoYSA9IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYTtcbiAgICBsZXQgZmFjZUluZGV4ID0gb3B0aW9ucy5mYWNlSW5kZXg7XG4gICAgbGV0IGltZyA9IG9wdGlvbnMuaW1hZ2U7XG5cbiAgICBpZiAoZmxpcFkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmbGlwWSk7XG4gICAgfVxuXG4gICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XG4gICAgfVxuXG4gICAgaWYgKGltZyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZykgJiYgIShpbWcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcbiAgICAgIGdsLnRleFN1YkltYWdlMkQoZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgZmFjZUluZGV4LCBvcHRpb25zLmxldmVsLCBvcHRpb25zLngsIG9wdGlvbnMueSwgZ2xGbXQuZm9ybWF0LCBnbEZtdC5waXhlbFR5cGUsIGltZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XG4gICAgICAgIGdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGZhY2VJbmRleCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIG9wdGlvbnMueCxcbiAgICAgICAgICBvcHRpb25zLnksXG4gICAgICAgICAgb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC50ZXhTdWJJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGZhY2VJbmRleCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIG9wdGlvbnMueCxcbiAgICAgICAgICBvcHRpb25zLnksXG4gICAgICAgICAgb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxuICAgICAgICAgIGltZ1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9zZXRJbWFnZShnbEZtdCwgb3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGZsaXBZID0gb3B0aW9ucy5mbGlwWTtcbiAgICBsZXQgcHJlbXVsdGlwbHlBbHBoYSA9IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYTtcbiAgICBsZXQgZmFjZUluZGV4ID0gb3B0aW9ucy5mYWNlSW5kZXg7XG4gICAgbGV0IGltZyA9IG9wdGlvbnMuaW1hZ2U7XG5cbiAgICBpZiAoZmxpcFkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCBmbGlwWSk7XG4gICAgfVxuXG4gICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBmYWxzZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XG4gICAgfVxuICAgIGlmIChpbWcgJiYgIUFycmF5QnVmZmVyLmlzVmlldyhpbWcpICYmICEoaW1nIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpKSB7XG4gICAgICBnbC50ZXhJbWFnZTJEKFxuICAgICAgICBnbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBmYWNlSW5kZXgsXG4gICAgICAgIG9wdGlvbnMubGV2ZWwsXG4gICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxuICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgIGdsRm10LnBpeGVsVHlwZSxcbiAgICAgICAgaW1nXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGhpcy5fY29tcHJlc3NlZCkge1xuICAgICAgICBnbC5jb21wcmVzc2VkVGV4SW1hZ2UyRChcbiAgICAgICAgICBnbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBmYWNlSW5kZXgsXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgICBnbEZtdC5pbnRlcm5hbEZvcm1hdCxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIDAsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC50ZXhJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGZhY2VJbmRleCxcbiAgICAgICAgICBvcHRpb25zLmxldmVsLFxuICAgICAgICAgIGdsRm10LmludGVybmFsRm9ybWF0LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgMCxcbiAgICAgICAgICBnbEZtdC5mb3JtYXQsXG4gICAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxuICAgICAgICAgIGltZ1xuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIGxldmVsSW1hZ2VzID0gW2ltYWdlUG9zWCwgaW1hZ2VOZWdYLCBpbWFnZVBvc1ksIGltYWdlTmVnWSwgaW1hZ2VQb3NaLCBpbWFnZU5lZ3pdXG4gIC8vIGltYWdlcyA9IFtsZXZlbEltYWdlczAsIGxldmVsSW1hZ2VzMSwgLi4uXVxuICBfc2V0TWlwbWFwKGltYWdlcywgZmxpcFksIHByZW11bHRpcGx5QWxwaGEpIHtcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLl93aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5faGVpZ2h0LFxuICAgICAgZmFjZUluZGV4OiAwLFxuICAgICAgZmxpcFk6IGZsaXBZLFxuICAgICAgcHJlbXVsdGlwbHlBbHBoYTogcHJlbXVsdGlwbHlBbHBoYSxcbiAgICAgIGxldmVsOiAwLFxuICAgICAgaW1hZ2U6IG51bGxcbiAgICB9O1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIGxldCBsZXZlbEltYWdlcyA9IGltYWdlc1tpXTtcbiAgICAgIG9wdGlvbnMubGV2ZWwgPSBpO1xuICAgICAgb3B0aW9ucy53aWR0aCA9IHRoaXMuX3dpZHRoID4+IGk7XG4gICAgICBvcHRpb25zLmhlaWdodCA9IHRoaXMuX2hlaWdodCA+PiBpO1xuXG4gICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IDY7ICsrZmFjZSkge1xuICAgICAgICBvcHRpb25zLmZhY2VJbmRleCA9IGZhY2U7XG4gICAgICAgIG9wdGlvbnMuaW1hZ2UgPSBsZXZlbEltYWdlc1tmYWNlXTtcbiAgICAgICAgdGhpcy5fc2V0SW1hZ2UoZ2xGbXQsIG9wdGlvbnMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9zZXRUZXhJbmZvKCkge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IHBvdCA9IGlzUG93Mih0aGlzLl93aWR0aCkgJiYgaXNQb3cyKHRoaXMuX2hlaWdodCk7XG5cbiAgICAvLyBXZWJHTDEgZG9lc24ndCBzdXBwb3J0IGFsbCB3cmFwIG1vZGVzIHdpdGggTlBPVCB0ZXh0dXJlc1xuICAgIGlmICghcG90ICYmICh0aGlzLl93cmFwUyAhPT0gZW51bXMuV1JBUF9DTEFNUCB8fCB0aGlzLl93cmFwVCAhPT0gZW51bXMuV1JBUF9DTEFNUCkpIHtcbiAgICAgIGNvbnNvbGUud2FybignV2ViR0wxIGRvZXNuXFwndCBzdXBwb3J0IGFsbCB3cmFwIG1vZGVzIHdpdGggTlBPVCB0ZXh0dXJlcycpO1xuICAgICAgdGhpcy5fd3JhcFMgPSBlbnVtcy5XUkFQX0NMQU1QO1xuICAgICAgdGhpcy5fd3JhcFQgPSBlbnVtcy5XUkFQX0NMQU1QO1xuICAgIH1cblxuICAgIGxldCBtaXBGaWx0ZXIgPSB0aGlzLl9nZW5NaXBtYXBzID8gdGhpcy5fbWlwRmlsdGVyIDogLTE7XG4gICAgaWYgKCFwb3QgJiYgbWlwRmlsdGVyICE9PSAtMSkge1xuICAgICAgY29uc29sZS53YXJuKCdOUE9UIHRleHR1cmVzIGRvIG5vdCBzdXBwb3J0IG1pcG1hcCBmaWx0ZXInKTtcbiAgICAgIG1pcEZpbHRlciA9IC0xO1xuICAgIH1cblxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV9DVUJFX01BUCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWluRmlsdGVyLCBtaXBGaWx0ZXIpKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2xGaWx0ZXIoZ2wsIHRoaXMuX21hZ0ZpbHRlciwgLTEpKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfV1JBUF9TLCB0aGlzLl93cmFwUyk7XG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBnbC5URVhUVVJFX1dSQVBfVCwgdGhpcy5fd3JhcFQpO1xuICAgIC8vIHdyYXBSIGF2YWlsYWJsZSBpbiB3ZWJnbDJcbiAgICAvLyBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfV1JBUF9SLCB0aGlzLl93cmFwUik7XG5cbiAgICBsZXQgZXh0ID0gdGhpcy5fZGV2aWNlLmV4dCgnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyk7XG4gICAgaWYgKGV4dCkge1xuICAgICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFX0NVQkVfTUFQLCBleHQuVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIHRoaXMuX2FuaXNvdHJvcHkpO1xuICAgIH1cbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIvIn0=