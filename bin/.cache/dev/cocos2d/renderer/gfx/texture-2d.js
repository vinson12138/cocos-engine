
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'engine-dev/cocos2d/renderer/gfx/texture-2d.js';
                    var __require = nodeEnv ? function (request) {
                        return require(request);
                    } : function (request) {
                        return __quick_compile_engine__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_engine__.registerModule(__filename, module);}"use strict";

exports.__esModule = true;
exports["default"] = void 0;

var _texture = _interopRequireDefault(require("./texture"));

var _enums = require("./enums");

var _misc = require("./misc");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

/**
 * @typedef {HTMLImageElement | HTMLCanvasElement} HTMLImageSource
 * @typedef {HTMLImageSource | ArrayBufferView} ImageSource
 * @typedef {{width?: number, height?: number, minFilter?: number, magFilter?: number, mipFilter?: number, wrapS?: number, wrapT?: number, format?: number, genMipmaps?: boolean, images?: ImageSource[], image?: ImageSource, flipY?: boolean, premultiplyAlpha?: boolean, anisotropy?: number}} TextureUpdateOpts
 * @typedef {import("../gfx/device").default} Device
 */
var Texture2D = /*#__PURE__*/function (_Texture) {
  _inheritsLoose(Texture2D, _Texture);

  /**
   * @constructor
   * @param {Device} device
   * @param {TextureUpdateOpts} options
   */
  function Texture2D(device, options) {
    var _this;

    _this = _Texture.call(this, device) || this;
    var gl = _this._device._gl;
    _this._target = gl.TEXTURE_2D;
    _this._glID = gl.createTexture(); // always alloc texture in GPU when we create it.

    options.images = options.images || [null];

    _this.update(options);

    return _this;
  }
  /**
   * @method update
   * @param {TextureUpdateOpts} options
   */


  var _proto = Texture2D.prototype;

  _proto.update = function update(options) {
    var gl = this._device._gl;
    var genMipmaps = this._genMipmap;

    if (options) {
      if (options.width !== undefined) {
        this._width = options.width;
      }

      if (options.height !== undefined) {
        this._height = options.height;
      }

      if (options.anisotropy !== undefined) {
        this._anisotropy = options.anisotropy;
      }

      if (options.minFilter !== undefined) {
        this._minFilter = options.minFilter;
      }

      if (options.magFilter !== undefined) {
        this._magFilter = options.magFilter;
      }

      if (options.mipFilter !== undefined) {
        this._mipFilter = options.mipFilter;
      }

      if (options.wrapS !== undefined) {
        this._wrapS = options.wrapS;
      }

      if (options.wrapT !== undefined) {
        this._wrapT = options.wrapT;
      }

      if (options.format !== undefined) {
        this._format = options.format;
        this._compressed = this._format >= _enums.enums.TEXTURE_FMT_RGB_DXT1 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_PVRTC_4BPPV1 || this._format >= _enums.enums.TEXTURE_FMT_RGB_ETC2 && this._format <= _enums.enums.TEXTURE_FMT_RGBA_ETC2;
      } // check if generate mipmap


      if (options.genMipmaps !== undefined) {
        this._genMipmap = options.genMipmaps;
        genMipmaps = options.genMipmaps;
      }

      var maxSize = this._device.caps.maxTextureSize || Number.MAX_VALUE;
      var textureMaxSize = Math.max(options.width || 0, options.height || 0);
      if (maxSize < textureMaxSize) console.warn("The current texture size " + textureMaxSize + " exceeds the maximum size [" + maxSize + "] supported on the device.");

      if (options.images !== undefined) {
        if (options.images.length > 1) {
          genMipmaps = false;
          var maxLength = options.width > options.height ? options.width : options.height;

          if (maxLength >> options.images.length - 1 !== 1) {
            console.error('texture-2d mipmap is invalid, should have a 1x1 mipmap.');
          }
        }
      }
    } // NOTE: get pot after this._width, this._height has been assigned.


    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height);

    if (!pot) {
      genMipmaps = false;
    }

    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    if (options.images !== undefined && options.images.length > 0) {
      this._setMipmap(options.images, options.flipY, options.premultiplyAlpha);

      if (options.images.length > 1) this._genMipmap = true;
    }

    if (genMipmaps) {
      gl.hint(gl.GENERATE_MIPMAP_HINT, gl.NICEST);
      gl.generateMipmap(gl.TEXTURE_2D);
      this._genMipmap = true;
    }

    this._setTexInfo();

    this._device._restoreTexture(0);
  }
  /**
   * @method updateSubImage
   * @param {Object} options
   * @param {Number} options.x
   * @param {Number} options.y
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateSubImage = function updateSubImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setSubImage(glFmt, options);

    this._device._restoreTexture(0);
  }
  /**
   * @method updateImage
   * @param {Object} options
   * @param {Number} options.width
   * @param {Number} options.height
   * @param {Number} options.level
   * @param {HTMLCanvasElement | HTMLImageElement | HTMLVideoElement | ArrayBufferView} options.image
   * @param {Boolean} options.flipY
   * @param {Boolean} options.premultiplyAlpha
   */
  ;

  _proto.updateImage = function updateImage(options) {
    var gl = this._device._gl;
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    gl.activeTexture(gl.TEXTURE0);
    gl.bindTexture(gl.TEXTURE_2D, this._glID);

    this._setImage(glFmt, options);

    this._device._restoreTexture(0);
  };

  _proto._setSubImage = function _setSubImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, img);
      } else {
        gl.texSubImage2D(gl.TEXTURE_2D, options.level, options.x, options.y, options.width, options.height, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setImage = function _setImage(glFmt, options) {
    var gl = this._device._gl;
    var flipY = options.flipY;
    var premultiplyAlpha = options.premultiplyAlpha;
    var img = options.image;

    if (img && !ArrayBuffer.isView(img) && !(img instanceof ArrayBuffer)) {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, glFmt.format, glFmt.pixelType, img);
    } else {
      if (flipY === undefined) {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, flipY);
      }

      if (premultiplyAlpha === undefined) {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, false);
      } else {
        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, premultiplyAlpha);
      }

      if (this._compressed) {
        gl.compressedTexImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, img);
      } else {
        gl.texImage2D(gl.TEXTURE_2D, options.level, glFmt.internalFormat, options.width, options.height, 0, glFmt.format, glFmt.pixelType, img);
      }
    }
  };

  _proto._setMipmap = function _setMipmap(images, flipY, premultiplyAlpha) {
    var glFmt = (0, _enums.glTextureFmt)(this._format);
    var options = {
      width: this._width,
      height: this._height,
      flipY: flipY,
      premultiplyAlpha: premultiplyAlpha,
      level: 0,
      image: null
    };

    for (var i = 0; i < images.length; ++i) {
      options.level = i;
      options.width = this._width >> i;
      options.height = this._height >> i;
      options.image = images[i];

      this._setImage(glFmt, options);
    }
  };

  _proto._setTexInfo = function _setTexInfo() {
    var gl = this._device._gl;
    var pot = (0, _misc.isPow2)(this._width) && (0, _misc.isPow2)(this._height); // WebGL1 doesn't support all wrap modes with NPOT textures

    if (!pot && (this._wrapS !== _enums.enums.WRAP_CLAMP || this._wrapT !== _enums.enums.WRAP_CLAMP)) {
      console.warn('WebGL1 doesn\'t support all wrap modes with NPOT textures');
      this._wrapS = _enums.enums.WRAP_CLAMP;
      this._wrapT = _enums.enums.WRAP_CLAMP;
    }

    var mipFilter = this._genMipmap ? this._mipFilter : -1;

    if (!pot && mipFilter !== -1) {
      console.warn('NPOT textures do not support mipmap filter');
      mipFilter = -1;
    }

    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, (0, _enums.glFilter)(gl, this._minFilter, mipFilter));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, (0, _enums.glFilter)(gl, this._magFilter, -1));
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, this._wrapS);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, this._wrapT);

    var ext = this._device.ext('EXT_texture_filter_anisotropic');

    if (ext) {
      gl.texParameteri(gl.TEXTURE_2D, ext.TEXTURE_MAX_ANISOTROPY_EXT, this._anisotropy);
    }
  };

  return Texture2D;
}(_texture["default"]);

exports["default"] = Texture2D;
module.exports = exports["default"];
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_engine__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuZ2luZS1kZXYvY29jb3MyZC9yZW5kZXJlci9nZngvdGV4dHVyZS0yZC5qcyJdLCJuYW1lcyI6WyJUZXh0dXJlMkQiLCJkZXZpY2UiLCJvcHRpb25zIiwiZ2wiLCJfZGV2aWNlIiwiX2dsIiwiX3RhcmdldCIsIlRFWFRVUkVfMkQiLCJfZ2xJRCIsImNyZWF0ZVRleHR1cmUiLCJpbWFnZXMiLCJ1cGRhdGUiLCJnZW5NaXBtYXBzIiwiX2dlbk1pcG1hcCIsIndpZHRoIiwidW5kZWZpbmVkIiwiX3dpZHRoIiwiaGVpZ2h0IiwiX2hlaWdodCIsImFuaXNvdHJvcHkiLCJfYW5pc290cm9weSIsIm1pbkZpbHRlciIsIl9taW5GaWx0ZXIiLCJtYWdGaWx0ZXIiLCJfbWFnRmlsdGVyIiwibWlwRmlsdGVyIiwiX21pcEZpbHRlciIsIndyYXBTIiwiX3dyYXBTIiwid3JhcFQiLCJfd3JhcFQiLCJmb3JtYXQiLCJfZm9ybWF0IiwiX2NvbXByZXNzZWQiLCJlbnVtcyIsIlRFWFRVUkVfRk1UX1JHQl9EWFQxIiwiVEVYVFVSRV9GTVRfUkdCQV9QVlJUQ180QlBQVjEiLCJURVhUVVJFX0ZNVF9SR0JfRVRDMiIsIlRFWFRVUkVfRk1UX1JHQkFfRVRDMiIsIm1heFNpemUiLCJjYXBzIiwibWF4VGV4dHVyZVNpemUiLCJOdW1iZXIiLCJNQVhfVkFMVUUiLCJ0ZXh0dXJlTWF4U2l6ZSIsIk1hdGgiLCJtYXgiLCJjb25zb2xlIiwid2FybiIsImxlbmd0aCIsIm1heExlbmd0aCIsImVycm9yIiwicG90IiwiYWN0aXZlVGV4dHVyZSIsIlRFWFRVUkUwIiwiYmluZFRleHR1cmUiLCJfc2V0TWlwbWFwIiwiZmxpcFkiLCJwcmVtdWx0aXBseUFscGhhIiwiaGludCIsIkdFTkVSQVRFX01JUE1BUF9ISU5UIiwiTklDRVNUIiwiZ2VuZXJhdGVNaXBtYXAiLCJfc2V0VGV4SW5mbyIsIl9yZXN0b3JlVGV4dHVyZSIsInVwZGF0ZVN1YkltYWdlIiwiZ2xGbXQiLCJfc2V0U3ViSW1hZ2UiLCJ1cGRhdGVJbWFnZSIsIl9zZXRJbWFnZSIsImltZyIsImltYWdlIiwiQXJyYXlCdWZmZXIiLCJpc1ZpZXciLCJwaXhlbFN0b3JlaSIsIlVOUEFDS19GTElQX1lfV0VCR0wiLCJVTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wiLCJ0ZXhTdWJJbWFnZTJEIiwibGV2ZWwiLCJ4IiwieSIsInBpeGVsVHlwZSIsImNvbXByZXNzZWRUZXhTdWJJbWFnZTJEIiwidGV4SW1hZ2UyRCIsImludGVybmFsRm9ybWF0IiwiY29tcHJlc3NlZFRleEltYWdlMkQiLCJpIiwiV1JBUF9DTEFNUCIsInRleFBhcmFtZXRlcmkiLCJURVhUVVJFX01JTl9GSUxURVIiLCJURVhUVVJFX01BR19GSUxURVIiLCJURVhUVVJFX1dSQVBfUyIsIlRFWFRVUkVfV1JBUF9UIiwiZXh0IiwiVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQiLCJUZXh0dXJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0lBRXFCQTs7O0FBQ25CO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDRSxxQkFBWUMsTUFBWixFQUFvQkMsT0FBcEIsRUFBNkI7QUFBQTs7QUFDM0IsZ0NBQU1ELE1BQU47QUFFQSxRQUFJRSxFQUFFLEdBQUcsTUFBS0MsT0FBTCxDQUFhQyxHQUF0QjtBQUNBLFVBQUtDLE9BQUwsR0FBZUgsRUFBRSxDQUFDSSxVQUFsQjtBQUNBLFVBQUtDLEtBQUwsR0FBYUwsRUFBRSxDQUFDTSxhQUFILEVBQWIsQ0FMMkIsQ0FPM0I7O0FBQ0FQLElBQUFBLE9BQU8sQ0FBQ1EsTUFBUixHQUFpQlIsT0FBTyxDQUFDUSxNQUFSLElBQWtCLENBQUMsSUFBRCxDQUFuQzs7QUFDQSxVQUFLQyxNQUFMLENBQVlULE9BQVo7O0FBVDJCO0FBVTVCO0FBRUQ7QUFDRjtBQUNBO0FBQ0E7Ozs7O1NBQ0VTLFNBQUEsZ0JBQU9ULE9BQVAsRUFBZ0I7QUFDZCxRQUFJ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OlsiLy8gQHRzLWNoZWNrXG5pbXBvcnQgVGV4dHVyZSBmcm9tICcuL3RleHR1cmUnO1xuaW1wb3J0IHsgZW51bXMsIGdsRmlsdGVyLCBnbFRleHR1cmVGbXQgfSBmcm9tICcuL2VudW1zJztcbmltcG9ydCB7IGlzUG93MiB9IGZyb20gJy4vbWlzYyc7XG5cbi8qKlxuICogQHR5cGVkZWYge0hUTUxJbWFnZUVsZW1lbnQgfCBIVE1MQ2FudmFzRWxlbWVudH0gSFRNTEltYWdlU291cmNlXG4gKiBAdHlwZWRlZiB7SFRNTEltYWdlU291cmNlIHwgQXJyYXlCdWZmZXJWaWV3fSBJbWFnZVNvdXJjZVxuICogQHR5cGVkZWYge3t3aWR0aD86IG51bWJlciwgaGVpZ2h0PzogbnVtYmVyLCBtaW5GaWx0ZXI/OiBudW1iZXIsIG1hZ0ZpbHRlcj86IG51bWJlciwgbWlwRmlsdGVyPzogbnVtYmVyLCB3cmFwUz86IG51bWJlciwgd3JhcFQ/OiBudW1iZXIsIGZvcm1hdD86IG51bWJlciwgZ2VuTWlwbWFwcz86IGJvb2xlYW4sIGltYWdlcz86IEltYWdlU291cmNlW10sIGltYWdlPzogSW1hZ2VTb3VyY2UsIGZsaXBZPzogYm9vbGVhbiwgcHJlbXVsdGlwbHlBbHBoYT86IGJvb2xlYW4sIGFuaXNvdHJvcHk/OiBudW1iZXJ9fSBUZXh0dXJlVXBkYXRlT3B0c1xuICogQHR5cGVkZWYge2ltcG9ydChcIi4uL2dmeC9kZXZpY2VcIikuZGVmYXVsdH0gRGV2aWNlXG4gKi9cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGV4dHVyZTJEIGV4dGVuZHMgVGV4dHVyZSB7XG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQHBhcmFtIHtEZXZpY2V9IGRldmljZVxuICAgKiBAcGFyYW0ge1RleHR1cmVVcGRhdGVPcHRzfSBvcHRpb25zXG4gICAqL1xuICBjb25zdHJ1Y3RvcihkZXZpY2UsIG9wdGlvbnMpIHtcbiAgICBzdXBlcihkZXZpY2UpO1xuXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICB0aGlzLl90YXJnZXQgPSBnbC5URVhUVVJFXzJEO1xuICAgIHRoaXMuX2dsSUQgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XG5cbiAgICAvLyBhbHdheXMgYWxsb2MgdGV4dHVyZSBpbiBHUFUgd2hlbiB3ZSBjcmVhdGUgaXQuXG4gICAgb3B0aW9ucy5pbWFnZXMgPSBvcHRpb25zLmltYWdlcyB8fCBbbnVsbF07XG4gICAgdGhpcy51cGRhdGUob3B0aW9ucyk7XG4gIH1cblxuICAvKipcbiAgICogQG1ldGhvZCB1cGRhdGVcbiAgICogQHBhcmFtIHtUZXh0dXJlVXBkYXRlT3B0c30gb3B0aW9uc1xuICAgKi9cbiAgdXBkYXRlKG9wdGlvbnMpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBnZW5NaXBtYXBzID0gdGhpcy5fZ2VuTWlwbWFwO1xuXG4gICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgIGlmIChvcHRpb25zLndpZHRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fd2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMuaGVpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5faGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fYW5pc290cm9weSA9IG9wdGlvbnMuYW5pc290cm9weTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMuX21pbkZpbHRlciA9IG9wdGlvbnMubWluRmlsdGVyO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMubWFnRmlsdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fbWFnRmlsdGVyID0gb3B0aW9ucy5tYWdGaWx0ZXI7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5taXBGaWx0ZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9taXBGaWx0ZXIgPSBvcHRpb25zLm1pcEZpbHRlcjtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLndyYXBTICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fd3JhcFMgPSBvcHRpb25zLndyYXBTO1xuICAgICAgfVxuICAgICAgaWYgKG9wdGlvbnMud3JhcFQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl93cmFwVCA9IG9wdGlvbnMud3JhcFQ7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLl9mb3JtYXQgPSBvcHRpb25zLmZvcm1hdDtcbiAgICAgICAgdGhpcy5fY29tcHJlc3NlZCA9IFxuICAgICAgICAgICh0aGlzLl9mb3JtYXQgPj0gZW51bXMuVEVYVFVSRV9GTVRfUkdCX0RYVDEgJiYgdGhpcy5fZm9ybWF0IDw9IGVudW1zLlRFWFRVUkVfRk1UX1JHQkFfUFZSVENfNEJQUFYxKSB8fCBcbiAgICAgICAgICAodGhpcy5fZm9ybWF0ID49IGVudW1zLlRFWFRVUkVfRk1UX1JHQl9FVEMyICYmIHRoaXMuX2Zvcm1hdCA8PSBlbnVtcy5URVhUVVJFX0ZNVF9SR0JBX0VUQzIpXG4gICAgICAgIDtcbiAgICAgIH1cblxuICAgICAgLy8gY2hlY2sgaWYgZ2VuZXJhdGUgbWlwbWFwXG4gICAgICBpZiAob3B0aW9ucy5nZW5NaXBtYXBzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhpcy5fZ2VuTWlwbWFwID0gb3B0aW9ucy5nZW5NaXBtYXBzO1xuICAgICAgICBnZW5NaXBtYXBzID0gb3B0aW9ucy5nZW5NaXBtYXBzO1xuICAgICAgfVxuXG4gICAgICBsZXQgbWF4U2l6ZSA9IHRoaXMuX2RldmljZS5jYXBzLm1heFRleHR1cmVTaXplIHx8IE51bWJlci5NQVhfVkFMVUU7XG4gICAgICBsZXQgdGV4dHVyZU1heFNpemUgPSBNYXRoLm1heChvcHRpb25zLndpZHRoIHx8IDAsIG9wdGlvbnMuaGVpZ2h0IHx8IDApO1xuICAgICAgaWYgKG1heFNpemUgPCB0ZXh0dXJlTWF4U2l6ZSlcbiAgICAgICAgY29uc29sZS53YXJuKGBUaGUgY3VycmVudCB0ZXh0dXJlIHNpemUgJHt0ZXh0dXJlTWF4U2l6ZX0gZXhjZWVkcyB0aGUgbWF4aW11bSBzaXplIFske21heFNpemV9XSBzdXBwb3J0ZWQgb24gdGhlIGRldmljZS5gKTtcblxuICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBnZW5NaXBtYXBzID0gZmFsc2U7XG4gICAgICAgICAgbGV0IG1heExlbmd0aCA9IG9wdGlvbnMud2lkdGggPiBvcHRpb25zLmhlaWdodCA/IG9wdGlvbnMud2lkdGggOiBvcHRpb25zLmhlaWdodDtcbiAgICAgICAgICBpZiAobWF4TGVuZ3RoID4+IChvcHRpb25zLmltYWdlcy5sZW5ndGggLSAxKSAhPT0gMSkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcigndGV4dHVyZS0yZCBtaXBtYXAgaXMgaW52YWxpZCwgc2hvdWxkIGhhdmUgYSAxeDEgbWlwbWFwLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5PVEU6IGdldCBwb3QgYWZ0ZXIgdGhpcy5fd2lkdGgsIHRoaXMuX2hlaWdodCBoYXMgYmVlbiBhc3NpZ25lZC5cbiAgICBsZXQgcG90ID0gaXNQb3cyKHRoaXMuX3dpZHRoKSAmJiBpc1BvdzIodGhpcy5faGVpZ2h0KTtcbiAgICBpZiAoIXBvdCkge1xuICAgICAgZ2VuTWlwbWFwcyA9IGZhbHNlO1xuICAgIH1cblxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX2dsSUQpO1xuICAgIGlmIChvcHRpb25zLmltYWdlcyAhPT0gdW5kZWZpbmVkICYmIG9wdGlvbnMuaW1hZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuX3NldE1pcG1hcChvcHRpb25zLmltYWdlcywgb3B0aW9ucy5mbGlwWSwgb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhKTtcbiAgICAgIGlmIChvcHRpb25zLmltYWdlcy5sZW5ndGggPiAxKSB0aGlzLl9nZW5NaXBtYXAgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoZ2VuTWlwbWFwcykge1xuICAgICAgZ2wuaGludChnbC5HRU5FUkFURV9NSVBNQVBfSElOVCwgZ2wuTklDRVNUKTtcbiAgICAgIGdsLmdlbmVyYXRlTWlwbWFwKGdsLlRFWFRVUkVfMkQpO1xuICAgICAgdGhpcy5fZ2VuTWlwbWFwID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB0aGlzLl9zZXRUZXhJbmZvKCk7XG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZVN1YkltYWdlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLnhcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMueVxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy53aWR0aFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5oZWlnaHRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9wdGlvbnMubGV2ZWxcbiAgICogQHBhcmFtIHtIVE1MQ2FudmFzRWxlbWVudCB8IEhUTUxJbWFnZUVsZW1lbnQgfCBIVE1MVmlkZW9FbGVtZW50IHwgQXJyYXlCdWZmZXJWaWV3fSBvcHRpb25zLmltYWdlXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5mbGlwWVxuICAgKiBAcGFyYW0ge0Jvb2xlYW59IG9wdGlvbnMucHJlbXVsdGlwbHlBbHBoYVxuICAgKi9cbiAgdXBkYXRlU3ViSW1hZ2Uob3B0aW9ucykge1xuICAgIGxldCBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgbGV0IGdsRm10ID0gZ2xUZXh0dXJlRm10KHRoaXMuX2Zvcm1hdCk7XG5cbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCB0aGlzLl9nbElEKTtcbiAgICB0aGlzLl9zZXRTdWJJbWFnZShnbEZtdCwgb3B0aW9ucyk7XG4gICAgdGhpcy5fZGV2aWNlLl9yZXN0b3JlVGV4dHVyZSgwKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbWV0aG9kIHVwZGF0ZUltYWdlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLndpZHRoXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBvcHRpb25zLmhlaWdodFxuICAgKiBAcGFyYW0ge051bWJlcn0gb3B0aW9ucy5sZXZlbFxuICAgKiBAcGFyYW0ge0hUTUxDYW52YXNFbGVtZW50IHwgSFRNTEltYWdlRWxlbWVudCB8IEhUTUxWaWRlb0VsZW1lbnQgfCBBcnJheUJ1ZmZlclZpZXd9IG9wdGlvbnMuaW1hZ2VcbiAgICogQHBhcmFtIHtCb29sZWFufSBvcHRpb25zLmZsaXBZXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhXG4gICAqL1xuICB1cGRhdGVJbWFnZShvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcblxuICAgIGdsLmFjdGl2ZVRleHR1cmUoZ2wuVEVYVFVSRTApO1xuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRoaXMuX2dsSUQpO1xuICAgIHRoaXMuX3NldEltYWdlKGdsRm10LCBvcHRpb25zKTtcbiAgICB0aGlzLl9kZXZpY2UuX3Jlc3RvcmVUZXh0dXJlKDApO1xuICB9XG5cbiAgX3NldFN1YkltYWdlKGdsRm10LCBvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZmxpcFkgPSBvcHRpb25zLmZsaXBZO1xuICAgIGxldCBwcmVtdWx0aXBseUFscGhhID0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhO1xuICAgIGxldCBpbWcgPSBvcHRpb25zLmltYWdlO1xuXG4gICAgaWYgKGltZyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZykgJiYgIShpbWcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmxpcFkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICAgIH1cblxuICAgICAgZ2wudGV4U3ViSW1hZ2UyRChnbC5URVhUVVJFXzJELCBvcHRpb25zLmxldmVsLCBvcHRpb25zLngsIG9wdGlvbnMueSwgZ2xGbXQuZm9ybWF0LCBnbEZtdC5waXhlbFR5cGUsIGltZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XG4gICAgICAgIGdsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKGdsLlRFWFRVUkVfMkQsXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgICBvcHRpb25zLngsXG4gICAgICAgICAgb3B0aW9ucy55LFxuICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICAgICAgZ2xGbXQuZm9ybWF0LFxuICAgICAgICAgIGltZ1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wudGV4U3ViSW1hZ2UyRChcbiAgICAgICAgICBnbC5URVhUVVJFXzJELFxuICAgICAgICAgIG9wdGlvbnMubGV2ZWwsXG4gICAgICAgICAgb3B0aW9ucy54LFxuICAgICAgICAgIG9wdGlvbnMueSxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgICBnbEZtdC5waXhlbFR5cGUsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3NldEltYWdlKGdsRm10LCBvcHRpb25zKSB7XG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICBsZXQgZmxpcFkgPSBvcHRpb25zLmZsaXBZO1xuICAgIGxldCBwcmVtdWx0aXBseUFscGhhID0gb3B0aW9ucy5wcmVtdWx0aXBseUFscGhhO1xuICAgIGxldCBpbWcgPSBvcHRpb25zLmltYWdlO1xuXG4gICAgaWYgKGltZyAmJiAhQXJyYXlCdWZmZXIuaXNWaWV3KGltZykgJiYgIShpbWcgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHtcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIHRydWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZmxpcFkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJlbXVsdGlwbHlBbHBoYSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZ2wucGl4ZWxTdG9yZWkoZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBwcmVtdWx0aXBseUFscGhhKTtcbiAgICAgIH1cblxuICAgICAgZ2wudGV4SW1hZ2UyRChcbiAgICAgICAgZ2wuVEVYVFVSRV8yRCxcbiAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgZ2xGbXQuaW50ZXJuYWxGb3JtYXQsXG4gICAgICAgIGdsRm10LmZvcm1hdCxcbiAgICAgICAgZ2xGbXQucGl4ZWxUeXBlLFxuICAgICAgICBpbWdcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChmbGlwWSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19GTElQX1lfV0VCR0wsIGZsaXBZKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHByZW11bHRpcGx5QWxwaGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGdsLnBpeGVsU3RvcmVpKGdsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgcHJlbXVsdGlwbHlBbHBoYSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9jb21wcmVzc2VkKSB7XG4gICAgICAgIGdsLmNvbXByZXNzZWRUZXhJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfMkQsXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgICBnbEZtdC5pbnRlcm5hbEZvcm1hdCxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIDAsXG4gICAgICAgICAgaW1nXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBnbC50ZXhJbWFnZTJEKFxuICAgICAgICAgIGdsLlRFWFRVUkVfMkQsXG4gICAgICAgICAgb3B0aW9ucy5sZXZlbCxcbiAgICAgICAgICBnbEZtdC5pbnRlcm5hbEZvcm1hdCxcbiAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgICAgIG9wdGlvbnMuaGVpZ2h0LFxuICAgICAgICAgIDAsXG4gICAgICAgICAgZ2xGbXQuZm9ybWF0LFxuICAgICAgICAgIGdsRm10LnBpeGVsVHlwZSxcbiAgICAgICAgICBpbWdcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfc2V0TWlwbWFwKGltYWdlcywgZmxpcFksIHByZW11bHRpcGx5QWxwaGEpIHtcbiAgICBsZXQgZ2xGbXQgPSBnbFRleHR1cmVGbXQodGhpcy5fZm9ybWF0KTtcbiAgICBsZXQgb3B0aW9ucyA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLl93aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5faGVpZ2h0LFxuICAgICAgZmxpcFk6IGZsaXBZLFxuICAgICAgcHJlbXVsdGlwbHlBbHBoYTogcHJlbXVsdGlwbHlBbHBoYSxcbiAgICAgIGxldmVsOiAwLFxuICAgICAgaW1hZ2U6IG51bGxcbiAgICB9O1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIG9wdGlvbnMubGV2ZWwgPSBpO1xuICAgICAgb3B0aW9ucy53aWR0aCA9IHRoaXMuX3dpZHRoID4+IGk7XG4gICAgICBvcHRpb25zLmhlaWdodCA9IHRoaXMuX2hlaWdodCA+PiBpO1xuICAgICAgb3B0aW9ucy5pbWFnZSA9IGltYWdlc1tpXTtcbiAgICAgIHRoaXMuX3NldEltYWdlKGdsRm10LCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBfc2V0VGV4SW5mbygpIHtcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xuICAgIGxldCBwb3QgPSBpc1BvdzIodGhpcy5fd2lkdGgpICYmIGlzUG93Mih0aGlzLl9oZWlnaHQpO1xuXG4gICAgLy8gV2ViR0wxIGRvZXNuJ3Qgc3VwcG9ydCBhbGwgd3JhcCBtb2RlcyB3aXRoIE5QT1QgdGV4dHVyZXNcbiAgICBpZiAoIXBvdCAmJiAodGhpcy5fd3JhcFMgIT09IGVudW1zLldSQVBfQ0xBTVAgfHwgdGhpcy5fd3JhcFQgIT09IGVudW1zLldSQVBfQ0xBTVApKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1dlYkdMMSBkb2VzblxcJ3Qgc3VwcG9ydCBhbGwgd3JhcCBtb2RlcyB3aXRoIE5QT1QgdGV4dHVyZXMnKTtcbiAgICAgIHRoaXMuX3dyYXBTID0gZW51bXMuV1JBUF9DTEFNUDtcbiAgICAgIHRoaXMuX3dyYXBUID0gZW51bXMuV1JBUF9DTEFNUDtcbiAgICB9XG5cbiAgICBsZXQgbWlwRmlsdGVyID0gdGhpcy5fZ2VuTWlwbWFwID8gdGhpcy5fbWlwRmlsdGVyIDogLTE7XG4gICAgaWYgKCFwb3QgJiYgbWlwRmlsdGVyICE9PSAtMSkge1xuICAgICAgY29uc29sZS53YXJuKCdOUE9UIHRleHR1cmVzIGRvIG5vdCBzdXBwb3J0IG1pcG1hcCBmaWx0ZXInKTtcbiAgICAgIG1pcEZpbHRlciA9IC0xO1xuICAgIH1cblxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbEZpbHRlcihnbCwgdGhpcy5fbWluRmlsdGVyLCBtaXBGaWx0ZXIpKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2xGaWx0ZXIoZ2wsIHRoaXMuX21hZ0ZpbHRlciwgLTEpKTtcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCB0aGlzLl93cmFwUyk7XG4gICAgZ2wudGV4UGFyYW1ldGVyaShnbC5URVhUVVJFXzJELCBnbC5URVhUVVJFX1dSQVBfVCwgdGhpcy5fd3JhcFQpO1xuXG4gICAgbGV0IGV4dCA9IHRoaXMuX2RldmljZS5leHQoJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycpO1xuICAgIGlmIChleHQpIHtcbiAgICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZXh0LlRFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhULCB0aGlzLl9hbmlzb3Ryb3B5KTtcbiAgICB9XG4gIH1cbn0iXSwic291cmNlUm9vdCI6Ii8ifQ==